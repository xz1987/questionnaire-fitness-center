<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Finger Lakes Fitness Center Renovation Survey</title>
    <style>
        /* ============================================
           È¢úËâ≤ÊñπÊ°àÔºöTeal (#008B8B) Âíå Orange (#FF6B6B)
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 0;
            padding-bottom: 100px;
        }

        /* ËøõÂ∫¶Êù° */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            z-index: 1000;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #008B8B 0%, #FF6B6B 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Header Section */
        .header {
            background: white;
            text-align: center;
            padding: 40px 20px;
            border-bottom: 3px solid #008B8B;
        }

        .header h1 {
            color: #008B8B;
            font-size: 2.5em;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #008B8B;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header .tagline {
            color: #FF6B6B;
            font-size: 1em;
            font-style: italic;
        }

        /* Consent Statement */
        .consent {
            background: #f0f8f8;
            border-left: 4px solid #008B8B;
            padding: 25px;
            margin: 30px auto;
            max-width: 900px;
            border-radius: 4px;
        }

        .consent h2 {
            color: #008B8B;
            font-size: 1.2em;
            margin-bottom: 12px;
        }

        .consent p {
            color: #555;
            font-size: 0.95em;
            line-height: 1.8;
        }

        /* Section Styling */
        .section {
            background: white;
            margin: 30px auto;
            max-width: 900px;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* ÁßªÂä®ËÆæÂ§á‰ºòÂåñÔºöÂ¶ÇÊûú JavaScript Êú™ÊâßË°åÔºåËá≥Â∞ëÂÜÖÂÆπÂèØËßÅ */
        @media (max-width: 1024px) {
            .section {
                opacity: 1;
                transform: translateY(0);
            }
            
            /* ÁßªÂä®Á´ØË°®ÂçïÂÖÉÁ¥†‰ºòÂåñ */
            .radio-option,
            .checkbox-option {
                min-height: 48px;
                padding: 14px;
            }
            
            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                width: 28px;
                height: 28px;
                min-width: 28px;
                min-height: 28px;
            }
            
            .satisfaction-scale-item,
            .likert-option {
                min-height: 48px;
                min-width: 60px;
                padding: 12px;
            }
            
            .satisfaction-scale-item input[type="radio"],
            .likert-option input[type="radio"] {
                width: 24px;
                height: 24px;
                min-width: 24px;
                min-height: 24px;
            }
            
            input[type="text"],
            textarea {
                font-size: 16px; /* Èò≤Ê≠¢ iOS Ëá™Âä®Áº©Êîæ */
                min-height: 48px;
            }
            
            button,
            .submit-btn {
                min-height: 48px;
            }
        }
        
        /* Ëß¶Êë∏ËÆæÂ§áÁâπÂÆö‰ºòÂåñ */
        @media (hover: none) and (pointer: coarse) {
            .radio-option,
            .checkbox-option {
                min-height: 48px;
                padding: 14px;
            }
            
            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                width: 28px;
                height: 28px;
                min-width: 28px;
                min-height: 28px;
            }
            
            /* ÁßªÈô§ hover ÊïàÊûúÔºå‰ΩøÁî® active ‰ª£Êõø */
            .radio-option:hover,
            .checkbox-option:hover {
                border-color: #e0e0e0;
                background-color: transparent;
            }
            
            .radio-option:active,
            .checkbox-option:active {
                background-color: #e0f0f0;
                border-color: #008B8B;
            }
        }

        .section:nth-child(even) {
            background: #fafafa;
        }

        .section-title {
            color: #008B8B;
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .framing-text {
            color: #555;
            font-size: 1em;
            margin-bottom: 25px;
            line-height: 1.8;
            font-style: italic;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 30px;
        }

        .question-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .required-marker {
            color: #FF6B6B;
            margin-left: 4px;
        }

        /* Radio Groups */
        .radio-group {
            display: flex !important;
            flex-direction: column;
            gap: 12px;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 50px; /* Á°Æ‰øùÂÆπÂô®ÊúâÈ´òÂ∫¶ */
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px; /* ÁßªÂä®Á´ØÊúÄÂ∞èËß¶Êë∏Âå∫Âüü */
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            position: relative;
            z-index: 1;
        }

        .radio-option:hover {
            border-color: #008B8B;
            background-color: #f0f8f8;
        }

        .radio-option:active {
            background-color: #e0f0f0;
            transform: scale(0.98);
        }

        .radio-option:focus-within {
            border-color: #008B8B;
            box-shadow: 0 0 0 3px rgba(0, 139, 139, 0.1);
        }

        .radio-option input[type="radio"] {
            margin-right: 12px;
            width: 24px;
            height: 24px;
            min-width: 24px;
            min-height: 24px;
            cursor: pointer;
            accent-color: #008B8B;
            flex-shrink: 0;
            -webkit-appearance: radio;
            appearance: radio;
            position: relative;
            z-index: 2;
        }
        
        /* Á°Æ‰øù label ÂèØÁÇπÂáªÊï¥‰∏™Âå∫Âüü */
        .radio-option label {
            flex: 1;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            padding: 4px 0;
            min-height: 24px;
            display: flex;
            align-items: center;
        }

        /* Checkbox Groups */
        .checkbox-group {
            display: flex !important;
            flex-direction: column;
            gap: 12px;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 50px; /* Á°Æ‰øùÂÆπÂô®ÊúâÈ´òÂ∫¶ */
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px; /* ÁßªÂä®Á´ØÊúÄÂ∞èËß¶Êë∏Âå∫Âüü */
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            position: relative;
            z-index: 1;
        }

        .checkbox-option:hover {
            border-color: #008B8B;
            background-color: #f0f8f8;
        }

        .checkbox-option:active {
            background-color: #e0f0f0;
            transform: scale(0.98);
        }

        .checkbox-option:focus-within {
            border-color: #008B8B;
            box-shadow: 0 0 0 3px rgba(0, 139, 139, 0.1);
        }

        .checkbox-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 12px;
            width: 24px;
            height: 24px;
            min-width: 24px;
            min-height: 24px;
            cursor: pointer;
            accent-color: #008B8B;
            flex-shrink: 0;
            -webkit-appearance: checkbox;
            appearance: checkbox;
            position: relative;
            z-index: 2;
        }
        
        /* Á°Æ‰øù label ÂèØÁÇπÂáªÊï¥‰∏™Âå∫Âüü */
        .checkbox-option label {
            flex: 1;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            padding: 4px 0;
            min-height: 24px;
            display: flex;
            align-items: center;
        }

        .choice-limit {
            color: #FF6B6B;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 10px;
        }

        .choice-limit.error {
            color: #FF6B6B;
        }

        /* Satisfaction Grid */
        .satisfaction-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .satisfaction-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 15px;
            align-items: center;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .satisfaction-label {
            font-weight: 500;
            color: #333;
        }

        .satisfaction-scale {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .satisfaction-scale-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 50px;
            min-height: 44px;
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            position: relative;
        }

        .satisfaction-scale-item:hover {
            border-color: #008B8B;
            background-color: #f0f8f8;
        }

        .satisfaction-scale-item:active {
            background-color: #e0f0f0;
            transform: scale(0.95);
        }

        .satisfaction-scale-item input[type="radio"] {
            margin-bottom: 5px;
            accent-color: #008B8B;
            width: 20px;
            height: 20px;
            min-width: 20px;
            min-height: 20px;
        }

        .satisfaction-scale-item label {
            font-size: 0.85em;
            color: #666;
            cursor: pointer;
        }

        /* Likert Scale */
        .likert-scale {
            margin-top: 15px;
        }

        .likert-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.85em;
            color: #666;
        }

        .likert-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
            min-height: 44px;
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            position: relative;
        }

        .likert-option:hover {
            border-color: #008B8B;
            background-color: #f0f8f8;
        }

        .likert-option:active {
            background-color: #e0f0f0;
            transform: scale(0.95);
        }

        .likert-option input[type="radio"] {
            margin-bottom: 5px;
            accent-color: #008B8B;
            width: 20px;
            height: 20px;
            min-width: 20px;
            min-height: 20px;
        }

        .likert-option label {
            font-size: 0.9em;
            color: #666;
            cursor: pointer;
        }

        /* Image Display */
        .image-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
        }

        .rendering-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        .image-caption {
            color: #008B8B;
            font-weight: 600;
            margin-top: 10px;
            font-size: 1em;
        }

        .image-subcaption {
            color: #666;
            font-size: 0.85em;
            font-style: italic;
            margin-top: 5px;
        }

        /* Text Inputs */
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px; /* Èò≤Ê≠¢ iOS Ëá™Âä®Áº©Êîæ */
            font-family: inherit;
            transition: border-color 0.3s ease;
            min-height: 44px; /* ÁßªÂä®Á´ØÊúÄÂ∞èËß¶Êë∏Âå∫Âüü */
            box-sizing: border-box;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #008B8B;
            box-shadow: 0 0 0 3px rgba(0, 139, 139, 0.1);
        }
        
        /* ÊåâÈíÆÊ†∑Âºè‰ºòÂåñ */
        button,
        .submit-btn {
            min-height: 44px;
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            touch-action: manipulation; /* ‰ºòÂåñËß¶Êë∏ÂìçÂ∫î */
        }

        .other-input {
            margin-top: 10px;
        }

        /* Conditional Sections */
        .conditional-section {
            margin-top: 20px;
            padding-left: 20px;
            border-left: 3px solid #008B8B;
            display: none;
        }

        .conditional-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Error Messages */
        .error-message {
            color: #FF6B6B;
            font-size: 0.9em;
            margin-top: 8px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .question-container.error .checkbox-option,
        .question-container.error .radio-option,
        .question-container.error input,
        .question-container.error textarea {
            border-color: #FF6B6B;
        }

        /* Submit Button - Sticky */
        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }

        .submit-btn {
            background: linear-gradient(135deg, #008B8B 0%, #006666 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.2em;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            display: block;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 139, 139, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            position: relative;
        }

        /* Âä†ËΩΩÂä®Áîª */
        .submit-btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .submit-btn.loading {
            color: transparent;
        }

        /* Messages */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            display: none;
            text-align: center;
            border: 1px solid #c3e6cb;
        }

        .success-message.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .error-message-box {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            display: none;
            text-align: center;
            border: 1px solid #f5c6cb;
        }

        .error-message-box.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ranking System */
        .ranking-container {
            margin-top: 20px;
        }

        .ranked-selections {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #008B8B;
            min-height: 150px;
        }

        .ranking-instructions {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            font-style: italic;
        }

        .ranked-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .ranked-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border: 2px solid #008B8B;
            border-radius: 6px;
            cursor: move;
            transition: all 0.3s ease;
            position: relative;
        }

        .ranked-item:hover {
            box-shadow: 0 4px 12px rgba(0, 139, 139, 0.2);
            transform: translateX(5px);
        }

        .ranked-item.dragging {
            opacity: 0.6;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 139, 139, 0.4);
        }
        
        /* Ëß¶Êë∏ÂèçÈ¶à */
        .ranked-item:active {
            transform: scale(0.98);
        }
        
        @media (hover: none) and (pointer: coarse) {
            /* Ëß¶Êë∏ËÆæÂ§áÊ†∑Âºè‰ºòÂåñ */
            .ranked-item {
                -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            }
            
            .radio-option:active,
            .checkbox-option:active {
                background-color: #e0f0f0;
            }
        }

        .rank-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background: #008B8B;
            color: white;
            border-radius: 50%;
            font-weight: 600;
            font-size: 1.1em;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .ranked-item-text {
            flex: 1;
            font-weight: 500;
            color: #333;
        }

        .rank-remove-btn {
            background: #FF6B6B;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            transition: all 0.2s ease;
        }

        .rank-remove-btn:hover {
            background: #e55555;
            transform: scale(1.1);
        }

        .ranked-placeholder {
            text-align: center;
            color: #999;
            padding: 30px;
            font-style: italic;
        }

        /* Responsive Design */
        
        /* Tablet Styles (768px - 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .section {
                padding: 30px;
                margin: 25px auto;
                max-width: 95%;
            }

            .header {
                padding: 35px 20px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .question-label {
                font-size: 1.15em;
            }

            /* Larger touch targets for tablets */
            .radio-option,
            .checkbox-option {
                padding: 16px;
                min-height: 56px; /* Minimum touch target size */
            }

            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                width: 24px;
                height: 24px;
            }

            .ranked-item {
                padding: 16px;
                min-height: 56px;
            }

            .rank-remove-btn {
                width: 36px;
                height: 36px;
                font-size: 24px;
            }

            .submit-btn {
                padding: 18px 40px;
                font-size: 1.2em;
                min-height: 56px;
            }

            .rendering-image {
                max-width: 100%;
                height: auto;
            }

            .satisfaction-scale-item {
                min-width: 60px;
                padding: 12px;
            }

            .likert-option {
                min-width: 60px;
                padding: 12px;
            }
        }

        /* Mobile Styles (max-width: 768px) */
        @media (max-width: 768px) {
            .section {
                padding: 20px;
                margin: 20px 10px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .satisfaction-row {
                grid-template-columns: 1fr;
            }

            .likert-options {
                justify-content: center;
            }

            .satisfaction-scale {
                justify-content: center;
            }

            /* Larger touch targets for mobile */
            .radio-option,
            .checkbox-option {
                padding: 16px;
                min-height: 48px;
            }

            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                width: 22px;
                height: 22px;
            }

            .ranked-item {
                padding: 14px;
                min-height: 48px;
            }

            .submit-btn {
                padding: 16px 30px;
                min-height: 48px;
            }
        }
    </style>
</head>
<body>
    <!-- Ë∞ÉËØï‰ø°ÊÅØÊ°ÜÔºàÂßãÁªàÊòæÁ§∫Ôºâ -->
    <div id="debugInfo" style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; background: #ff0000 !important; color: white !important; padding: 10px !important; font-size: 14px !important; z-index: 99999 !important; border-bottom: 3px solid #000 !important; max-height: 300px !important; overflow-y: auto !important; display: block !important; visibility: visible !important; opacity: 1 !important;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
            <strong style="font-size: 16px;">üîç Ë∞ÉËØï‰ø°ÊÅØÔºàÁÇπÂáªÂÖ≥Èó≠Ôºâ</strong>
            <button onclick="document.getElementById('debugInfo').style.display='none'" style="padding: 5px 15px; background: #000; color: white; border: 2px solid white; border-radius: 4px; cursor: pointer; font-weight: bold;">‚úï ÂÖ≥Èó≠</button>
        </div>
        <div id="debugContent" style="background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; font-family: monospace; line-height: 1.6;">
            <div>‚è≥ Ê≠£Âú®Âä†ËΩΩË∞ÉËØï‰ø°ÊÅØ...</div>
            <div style="margin-top: 5px; color: yellow;">Â¶ÇÊûúËøôÈáå‰∏ÄÁõ¥ÊòæÁ§∫"Ê≠£Âú®Âä†ËΩΩ"ÔºåËØ¥Êòé JavaScript ÊâßË°åÊúâÈóÆÈ¢ò</div>
            <div id="debugSimple" style="margin-top: 10px; padding: 5px; background: #000; color: #0f0; border: 1px solid #0f0;">
                <div>ÁÆÄÂçïÊµãËØï: <span id="testTime">-</span></div>
            </div>
        </div>
        
        <!-- ÂÜÖËÅîËÑöÊú¨ÔºåÁ´ãÂç≥ÊâßË°åÔºå‰∏ç‰æùËµñÂáΩÊï∞ -->
        <script>
            (function() {
                try {
                    // Á´ãÂç≥Êõ¥Êñ∞ÁÆÄÂçïÊµãËØï
                    var testTimeEl = document.getElementById('testTime');
                    if (testTimeEl) {
                        testTimeEl.textContent = new Date().toLocaleTimeString();
                    }
                    
                    // Á´ãÂç≥Â∞ùËØïÊòæÁ§∫Ë∞ÉËØï‰ø°ÊÅØ
                    var debugContent = document.getElementById('debugContent');
                    if (debugContent) {
                        var html = '<div style="color: #0f0;">‚úÖ JavaScript Â∑≤ÊâßË°å</div>';
                        html += '<div>Êó∂Èó¥: ' + new Date().toLocaleTimeString() + '</div>';
                        html += '<div>User Agent: ' + (navigator.userAgent || 'Unknown') + '</div>';
                        html += '<div>Â±èÂπï: ' + (window.screen.width || 0) + 'x' + (window.screen.height || 0) + '</div>';
                        html += '<div>ËßÜÂè£: ' + (window.innerWidth || 0) + 'x' + (window.innerHeight || 0) + '</div>';
                        
                        // Ê£ÄÊü•ÂÖ≥ÈîÆÂÖÉÁ¥†
                        var overallGroup = document.getElementById('overall_satisfaction_group');
                        var rankedGroup = document.getElementById('ranked_factors_group');
                        
                        html += '<div style="margin-top: 10px; padding: 5px; background: ' + (overallGroup ? '#0f0' : '#f00') + ';">ÈóÆÈ¢ò1ÂÆπÂô®: ' + (overallGroup ? 'ÊâæÂà∞' : 'Êú™ÊâæÂà∞') + '</div>';
                        html += '<div style="padding: 5px; background: ' + (rankedGroup ? '#0f0' : '#f00') + ';">ÈóÆÈ¢ò2ÂÆπÂô®: ' + (rankedGroup ? 'ÊâæÂà∞' : 'Êú™ÊâæÂà∞') + '</div>';
                        
                        if (overallGroup) {
                            var children = overallGroup.children ? overallGroup.children.length : 0;
                            html += '<div>ÈóÆÈ¢ò1Â≠êÂÖÉÁ¥†: ' + children + '</div>';
                        }
                        if (rankedGroup) {
                            var children2 = rankedGroup.children ? rankedGroup.children.length : 0;
                            html += '<div>ÈóÆÈ¢ò2Â≠êÂÖÉÁ¥†: ' + children2 + '</div>';
                        }
                        
                        // Ê£ÄÊü•Ë°®ÂçïÂÖÉÁ¥†
                        var radios = document.querySelectorAll('input[type="radio"]');
                        var checkboxes = document.querySelectorAll('input[type="checkbox"]');
                        html += '<div style="margin-top: 10px; padding: 5px; background: ' + (radios.length > 0 ? '#0f0' : '#f00') + ';">Radio Êï∞Èáè: ' + radios.length + '</div>';
                        html += '<div style="padding: 5px; background: ' + (checkboxes.length > 0 ? '#0f0' : '#f00') + ';">Checkbox Êï∞Èáè: ' + checkboxes.length + '</div>';
                        
                        debugContent.innerHTML = html;
                    }
                } catch (e) {
                    var debugContent = document.getElementById('debugContent');
                    if (debugContent) {
                        debugContent.innerHTML = '<div style="color: #f00;">‚ùå ÈîôËØØ: ' + e.message + '</div>';
                    }
                }
            })();
        </script>
    </div>
    
    <!-- Ê∑ªÂä†È°∂ÈÉ®Èó¥Ë∑ùÔºåÈÅøÂÖçÂÜÖÂÆπË¢´Ë∞ÉËØïÊ°ÜÈÅÆÊå° -->
    <style>
        body {
            padding-top: 150px !important;
        }
        @media (max-width: 768px) {
            body {
                padding-top: 200px !important;
            }
        }
    </style>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Header -->
    <div class="header">
        <h1>FINGER LAKES FITNESS CENTER</h1>
        <div class="subtitle">RENOVATION SURVEY</div>
        <div class="tagline">We appreciate your help!</div>
    </div>

    <!-- Consent Statement -->
    <div class="consent">
        <h2>Consent & Clarification Statement</h2>
        <p>
            This survey is to better understand your wellness needs. Your feedback will help us enhance our facilities 
            and explore future development. By completing this survey, you confirm you've read and understood this information. 
            Participation is <strong>anonymous</strong> and <strong>voluntary</strong>; the survey takes about <strong>3-4 minutes</strong>.
        </p>
    </div>

    <form id="surveyForm">
        <!-- Section 1: Current Satisfaction Assessment -->
        <div class="section" id="section1">
            <h2 class="section-title">Section 1: Current Satisfaction Assessment</h2>
            <p class="framing-text">Understanding Your Current Experience<br>Help us understand how well we're meeting your needs today.</p>
            
            <div class="form-group question-container" data-question-id="overall_satisfaction">
                <label class="question-label">
                    How satisfied are you with Finger Lakes Fitness Center overall?
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="overall_satisfaction_group"></div>
                <div class="error-message">Please select an option</div>
            </div>

            <div class="form-group question-container" data-question-id="ranked_factors">
                <label class="question-label">
                    Please select and rank your top 3 valued factors when choosing a fitness center
                    <span class="required-marker">*</span>
                </label>
                <p class="section-subtitle" style="margin-top: -10px; margin-bottom: 15px;">
                    Drag or touch to reorder your selections (top 3 will be ranked)
                </p>
                <div class="ranking-container" id="ranked_factors_container">
                    <div class="checkbox-group" id="ranked_factors_group"></div>
                    <div class="ranked-selections" id="ranked_selections">
                        <p class="ranking-instructions">Select up to 3 factors, then drag to rank them:</p>
                        <div class="ranked-list" id="ranked_list"></div>
                    </div>
                </div>
                <div class="error-message">Please select and rank at least 3 factors</div>
            </div>
        </div>

        <!-- Section 3: Comfort Zone Concept -->
        <div class="section" id="section3">
            <h2 class="section-title">Section 2: Comfort Zone Concept</h2>
            <p class="framing-text">
                We're Refreshing the Fitness Center<br>
                We're exploring adding a dedicated comfort zone‚Äîa place to restore and recharge between workouts. 
                This space would provide a comfortable environment to relax, transition between activities, and prepare mentally for your next set.
            </p>
            
            <div class="image-section">
                <img id="renderingImage" class="rendering-image" alt="Comfort Zone Rendering" />
                <div class="image-caption">View How It Looks in Space ‚Üí</div>
                <div class="image-subcaption">Renderings are conceptual ‚Äî shown for inspiration, not final design.</div>
            </div>

            <div class="form-group question-container" data-question-id="comfort_zone_amenities_ranked">
                <label class="question-label">
                    Please select and rank your top 3 elements that would be most valuable in this comfort zone
                    <span class="required-marker">*</span>
                </label>
                <p class="section-subtitle" style="margin-top: -10px; margin-bottom: 15px;">
                    Drag or touch to reorder your selections (top 3 will be ranked)
                </p>
                <div class="ranking-container" id="comfort_zone_amenities_ranked_container">
                    <div class="checkbox-group" id="comfort_zone_amenities_ranked_group"></div>
                    <div class="ranked-selections" id="comfort_zone_amenities_ranked_selections">
                        <p class="ranking-instructions">Select up to 3 elements, then drag to rank them:</p>
                        <div class="ranked-list" id="comfort_zone_amenities_ranked_list"></div>
                    </div>
                </div>
                <div class="error-message">Please select and rank at least 3 elements</div>
            </div>

            <div class="form-group question-container" data-question-id="usage_frequency">
                <label class="question-label">
                    If this comfort zone were available with your valued elements, how often would you use this space?
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="usage_frequency_group"></div>
                <div class="error-message">Please select an option</div>
            </div>

            <div class="form-group question-container" data-question-id="membership_type">
                <label class="question-label">
                    Your Membership Type:
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="membership_type_group"></div>
                <div class="error-message">Please select an option</div>
            </div>

            <div class="conditional-section" id="membership_duration_section">
                <div class="form-group question-container" data-question-id="membership_duration">
                    <label class="question-label">
                        (If you are a member) For how long have you been a member?
                        <span class="required-marker">*</span>
                    </label>
                    <div class="radio-group" id="membership_duration_group"></div>
                    <div class="error-message">Please select an option</div>
                </div>
            </div>

            <!-- Version A: For Current Members -->
            <div class="conditional-section" id="membership_impact_renewal_section">
                <div class="form-group question-container" data-question-id="membership_impact_renewal">
                    <label class="question-label">
                        How would adding this comfort zone affect your likelihood to <strong>renew</strong> your membership?
                        <span class="required-marker">*</span>
                    </label>
                    <div class="radio-group" id="membership_impact_renewal_group"></div>
                    <div class="error-message">Please select an option</div>
                </div>
            </div>

            <!-- Version B: For Non-Members -->
            <div class="conditional-section" id="membership_impact_join_section">
                <div class="form-group question-container" data-question-id="membership_impact_join">
                    <label class="question-label">
                        How would this comfort zone affect your likelihood to <strong>join</strong> with a new membership?
                        <span class="required-marker">*</span>
                    </label>
                    <div class="radio-group" id="membership_impact_join_group"></div>
                    <div class="error-message">Please select an option</div>
                </div>
            </div>
        </div>

        <!-- Section 4: Wellness & Balance Assessment -->
        <div class="section" id="section4">
            <h2 class="section-title">Section 3: Wellness & Balance Assessment</h2>
            <p class="framing-text">Think about how each statement fits you<br>Please check the option that feels most true right now.</p>
            
            <div id="wellness_statements"></div>
        </div>

        <!-- Section 7: Demographics -->
        <div class="section" id="section7">
            <h2 class="section-title">Section 4: Demographics</h2>
            
            <div class="form-group question-container" data-question-id="age_group">
                <label class="question-label">
                    Age Group
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="age_group_group"></div>
                <div class="error-message">Please select an option</div>
            </div>

            <div class="form-group question-container" data-question-id="gender">
                <label class="question-label">
                    Gender
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="gender_group"></div>
                <div class="error-message">Please select an option</div>
            </div>
        </div>

        <!-- Submit Container -->
        <div class="submit-container">
            <button type="submit" class="submit-btn" id="submitBtn">Submit Survey</button>
            <div class="success-message" id="successMessage"></div>
            <div class="error-message-box" id="errorMessageBox"></div>
            <!-- ÁÆ°ÁêÜÂëòÂØºÂá∫ÊåâÈíÆÔºàÂèØÈÄâÔºåÂèØ‰ª•ÈÄöËøá URL ÂèÇÊï∞ ?admin=1 ÊòæÁ§∫Ôºâ -->
            <button type="button" class="submit-btn" id="exportBtn" style="display: none; margin-top: 10px; background: linear-gradient(135deg, #FF6B6B 0%, #e55555 100%);" onclick="exportToCSV()">Export Responses to CSV</button>
        </div>
    </form>

    <script>
        /**
         * ============================================
         * Google Sheets ÈÖçÁΩÆ
         * ============================================
         * Google Apps Script Web App URL
         */
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyJoQ3FQE-XzU3X-Lp3-XEBuyfj6E5GljvP_j3-geymMcxzTfTKIuLOQ-daGrQ_ub9rlw/exec';
        
        /**
         * ÊòØÂê¶ÂêØÁî® Google Sheets Êèê‰∫§
         * Â¶ÇÊûúËÆæÁΩÆ‰∏∫ falseÔºåÊï∞ÊçÆÂè™‰ºö‰øùÂ≠òÂà∞ localStorage
         */
        const ENABLE_GOOGLE_SHEETS = GOOGLE_APPS_SCRIPT_URL.length > 0;
        
        /**
         * Ë∞ÉËØïÊ®°ÂºèÔºöÂú®ÊéßÂà∂Âè∞ËæìÂá∫ËØ¶ÁªÜ‰ø°ÊÅØ
         */
        const DEBUG_MODE = true;

        /**
         * ============================================
         * ÈöèÊú∫ÂõæÁâáÈÄâÊã©ÂäüËÉΩ
         * 50/50 Ê¶ÇÁéáÈÄâÊã© comfort-zone-v1.jpg Êàñ comfort-zone-v2.jpg
         * ============================================
         */
        let selectedImageVersion = null;

        function selectRandomImage() {
            try {
                const imageElement = document.getElementById('renderingImage');
                if (!imageElement) {
                    if (DEBUG_MODE) {
                        console.error('‚ùå Image element not found!');
                    }
                    return;
                }
                
                const random = Math.random();
                // 50/50 Ê¶ÇÁéáÈÄâÊã©
                selectedImageVersion = random < 0.5 ? 'comfort-zone-v1' : 'comfort-zone-v2';
                
                // ‰ΩøÁî®Áõ∏ÂØπË∑ØÂæÑÔºàÈÄÇÁî®‰∫é GitHub PagesÔºâ
                const imagePath = `./images/${selectedImageVersion}.jpg`;
                
                if (DEBUG_MODE) {
                    console.log('üñºÔ∏è Loading image:', imagePath);
                }
                
                imageElement.src = imagePath;
                
                // Â¶ÇÊûúÂõæÁâáÂä†ËΩΩÂ§±Ë¥•ÔºåÊòæÁ§∫Âç†‰ΩçÁ¨¶
                imageElement.onerror = function() {
                    if (DEBUG_MODE) {
                        console.warn('‚ö†Ô∏è Image failed to load:', imagePath);
                    }
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2YwZjhmOCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiMwMDhCOEIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5QbGVhc2UgcGxhY2UgY29tZm9ydC16b25lIHJlbmRlcmluZyBpbWFnZSBob3JlPC90ZXh0Pjwvc3Zn+';
                    this.alt = 'Placeholder: Please add ' + selectedImageVersion + '.jpg to the images folder';
                };
                
                imageElement.onload = function() {
                    if (DEBUG_MODE) {
                        console.log('‚úÖ Image loaded successfully:', imagePath);
                    }
                };
            } catch (error) {
                console.error('‚ùå Error in selectRandomImage:', error);
            }
        }

        /**
         * ============================================
         * Ë∞ÉÊü•ÈóÆÈ¢òÈÖçÁΩÆ
         * ============================================
         */
        const surveyConfig = {
            overallSatisfaction: [
                'Very Dissatisfied',
                'Dissatisfied',
                'Neutral',
                'Satisfied',
                'Very Satisfied'
            ],
            amenities: [
                'Equipment quality and variety',
                'Cleanliness and maintenance',
                'Locker rooms and shower facilities',
                'Class offerings and personal training',
                'Social spaces and common areas',
                'Staff and trainers',
                'Overall atmosphere and environment'
            ],
            topValuedFactors: [
                'Availability of personal trainers or classes',
                'Ventilation, lighting, and air conditioning',
                'Locker rooms and shower facilities',
                'Variety and quality of equipment',
                'Availability of seating area',
                'Cleanliness and maintenance',
                'Commuting convenience',
                'Other'
            ],
            comfortZoneAmenities: [
                'Comfortable seating (e.g., couches and lounge chairs)',
                'Vending machine',
                'Information / achievement board',
                'Interaction & networking opportunities',
                'Books / magazines',
                'Charging ports',
                'Plants and natural elements',
                'Places to hang coats and change shoes',
                'Other'
            ],
            usageFrequency: [
                'Rarely (once a month or less)',
                'Sometimes (2-3 times per month)',
                'Often (1-2 times per week)'
            ],
            wellnessStatements: [
                'I have balanced exercise, nutrition, and rest patterns',
                'I maintain regular practices that help me stay centered and connected',
                'I actively engage in learning to keep my mind focused and alert',
                'I have consistent, genuine connections with others that make me feel supported',
                'I am aware of my feelings and reflect on my emotions as part of staying balanced',
                'My current work environment aligns with my skills and values'
            ],
            membershipTypes: [
                "I'm not a member yet",
                'Pay-per-use / Day rate',
                'Monthly',
                '6 Month',
                'Annual',
                'Other (Please specify)'
            ],
            membershipDurations: [
                'Less than 6 months',
                '6 Months to 1 Year',
                '1-3 Years',
                '3-5 Years',
                '5+ Years'
            ],
            membershipImpactRenewal: [
                'Much less likely to renew',
                'Somewhat less likely to renew',
                'No impact on my decision',
                'Somewhat more likely to renew',
                'Much more likely to renew'
            ],
            membershipImpactJoin: [
                'Much less likely to join',
                'Somewhat less likely to join',
                'No impact on my decision',
                'Somewhat more likely to join',
                'Much more likely to join'
            ],
            ageGroups: [
                '18-24',
                '25-34',
                '35-45',
                '45-54',
                '55-64',
                '65-74',
                '75+'
            ],
            genderOptions: [
                'M',
                'F',
                'Transgender',
                'Prefer not to respond',
                'Prefer to self-describe'
            ]
        };

        /**
         * Ê∏≤ÊüìÂçïÈÄâÊåâÈíÆÁªÑÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
         */
        function renderRadioGroup(groupId, options) {
            try {
                const container = document.getElementById(groupId);
                if (!container) {
                    console.error('‚ùå Container not found:', groupId);
                    return;
                }
                
                if (!options || !Array.isArray(options) || options.length === 0) {
                    console.warn('‚ö†Ô∏è No options provided for:', groupId);
                    return;
                }
                
                // Âº∫Âà∂ÊòæÁ§∫ÂÆπÂô®
                container.style.display = 'flex';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                
                container.innerHTML = '';
                
                console.log('üìù Rendering radio group:', groupId, 'with', options.length, 'options');

                options.forEach((option, index) => {
                    const radioDiv = document.createElement('div');
                    radioDiv.className = 'radio-option';

                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.id = `${groupId}_${index}`;
                    radio.name = groupId.replace('_group', '');
                    radio.value = option;
                    radio.setAttribute('aria-label', option); // Êó†ÈöúÁ¢çÊîØÊåÅ

                    const label = document.createElement('label');
                    label.htmlFor = `${groupId}_${index}`;
                    label.textContent = option;
                    label.setAttribute('aria-label', option);

                    // Á°Æ‰øùÊï¥‰∏™ div ÂèØÁÇπÂáª
                    radioDiv.addEventListener('click', function(e) {
                        if (e.target !== radio) {
                            radio.click();
                        }
                    });

                    radioDiv.appendChild(radio);
                    radioDiv.appendChild(label);

                    // Â§ÑÁêÜ "Other" Êàñ "self-describe" ÈÄâÈ°π
                    if (option === 'Other' || option.includes('Other') || option.includes('self-describe')) {
                        const otherInput = document.createElement('input');
                        otherInput.type = 'text';
                        otherInput.id = `${groupId}_other`;
                        otherInput.name = `${groupId.replace('_group', '')}_other`;
                        otherInput.className = 'other-input';
                        otherInput.placeholder = 'Please specify...';
                        otherInput.style.display = 'none';
                        radioDiv.appendChild(otherInput);

                        radio.addEventListener('change', function() {
                            otherInput.style.display = this.checked ? 'block' : 'none';
                        });
                    }

                    container.appendChild(radioDiv);
                });
                
                if (DEBUG_MODE) {
                    console.log('‚úÖ Rendered radio group:', groupId, 'with', options.length, 'options');
                }
            } catch (error) {
                console.error('‚ùå Error rendering radio group:', groupId, error);
            }
        }

        /**
         * Ê∏≤ÊüìÂ§çÈÄâÊ°ÜÁªÑÔºàÂ∏¶ÈôêÂà∂ÔºåÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
         */
        function renderCheckboxGroup(groupId, options, maxSelections) {
            try {
                const container = document.getElementById(groupId);
                if (!container) {
                    console.error('‚ùå Container not found:', groupId);
                    return;
                }
                
                if (!options || !Array.isArray(options) || options.length === 0) {
                    console.warn('‚ö†Ô∏è No options provided for:', groupId);
                    return;
                }
                
                // Âº∫Âà∂ÊòæÁ§∫ÂÆπÂô®
                container.style.display = 'flex';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                
                container.innerHTML = '';
                
                console.log('üìù Rendering checkbox group:', groupId, 'with', options.length, 'options');

                options.forEach((option, index) => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'checkbox-option';
                    checkboxDiv.setAttribute('data-value', option);

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `${groupId}_${index}`;
                    checkbox.name = groupId.replace('_group', '');
                    checkbox.value = option;
                    checkbox.setAttribute('aria-label', option); // Êó†ÈöúÁ¢çÊîØÊåÅ
                    checkbox.addEventListener('change', function() {
                        enforceCheckboxLimit(groupId, maxSelections);
                    });

                    const label = document.createElement('label');
                    label.htmlFor = `${groupId}_${index}`;
                    label.textContent = option;
                    label.setAttribute('aria-label', option);

                    // Á°Æ‰øùÊï¥‰∏™ div ÂèØÁÇπÂáª
                    checkboxDiv.addEventListener('click', function(e) {
                        if (e.target !== checkbox) {
                            checkbox.click();
                        }
                    });

                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);

                    // Â§ÑÁêÜ "Other" ÈÄâÈ°π
                    if (option === 'Other' || option.includes('Other')) {
                        const otherInput = document.createElement('input');
                        otherInput.type = 'text';
                        otherInput.id = `${groupId}_other`;
                        otherInput.name = `${groupId.replace('_group', '')}_other`;
                        otherInput.className = 'other-input';
                        otherInput.placeholder = 'Please specify...';
                        otherInput.style.display = 'none';
                        checkboxDiv.appendChild(otherInput);

                        checkbox.addEventListener('change', function() {
                            otherInput.style.display = this.checked ? 'block' : 'none';
                        });
                    }

                    container.appendChild(checkboxDiv);
                });

                updateChoiceLimit(groupId.replace('_group', '_limit'), groupId, maxSelections);
                
                if (DEBUG_MODE) {
                    console.log('‚úÖ Rendered checkbox group:', groupId, 'with', options.length, 'options');
                }
            } catch (error) {
                console.error('‚ùå Error rendering checkbox group:', groupId, error);
            }
        }

        /**
         * Âº∫Âà∂ÊâßË°åÂ§çÈÄâÊ°ÜÈôêÂà∂
         */
        function enforceCheckboxLimit(groupId, maxSelections) {
            const checkboxes = document.querySelectorAll(`#${groupId} input[type="checkbox"]:checked`);
            const allCheckboxes = document.querySelectorAll(`#${groupId} input[type="checkbox"]`);

            if (checkboxes.length >= maxSelections) {
                allCheckboxes.forEach(cb => {
                    if (!cb.checked) {
                        cb.closest('.checkbox-option').classList.add('disabled');
                    }
                });
            } else {
                allCheckboxes.forEach(cb => {
                    cb.closest('.checkbox-option').classList.remove('disabled');
                });
            }

            updateChoiceLimit(groupId.replace('_group', '_limit'), groupId, maxSelections);
        }

        /**
         * Êõ¥Êñ∞ÈÄâÊã©ÈôêÂà∂ÊèêÁ§∫
         */
        function updateChoiceLimit(limitId, groupId, maxSelections) {
            const limitElement = document.getElementById(limitId);
            const checkedCount = document.querySelectorAll(`#${groupId} input[type="checkbox"]:checked`).length;

            if (checkedCount > 0) {
                limitElement.textContent = `${checkedCount}/${maxSelections} selected`;
                if (checkedCount > maxSelections) {
                    limitElement.classList.add('error');
                    limitElement.textContent = `Please select only up to ${maxSelections} options`;
                } else {
                    limitElement.classList.remove('error');
                }
            } else {
                limitElement.textContent = '';
            }
        }

        /**
         * Ê∏≤ÊüìÊª°ÊÑèÂ∫¶ËØÑÂàÜÁΩëÊ†º
         */
        function renderSatisfactionGrid() {
            const container = document.getElementById('amenity_satisfaction_grid');
            container.innerHTML = '';

            surveyConfig.amenities.forEach((amenity, amenityIndex) => {
                const row = document.createElement('div');
                row.className = 'satisfaction-row';

                const label = document.createElement('div');
                label.className = 'satisfaction-label';
                label.textContent = amenity;
                row.appendChild(label);

                const scaleContainer = document.createElement('div');
                scaleContainer.className = 'satisfaction-scale';

                for (let i = 1; i <= 5; i++) {
                    const scaleItem = document.createElement('div');
                    scaleItem.className = 'satisfaction-scale-item';

                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.id = `amenity_${amenityIndex}_${i}`;
                    radio.name = `amenity_${amenityIndex}`;
                    radio.value = i;
                    radio.required = true;

                    const label = document.createElement('label');
                    label.htmlFor = `amenity_${amenityIndex}_${i}`;
                    label.textContent = i;

                    scaleItem.appendChild(radio);
                    scaleItem.appendChild(label);
                    scaleContainer.appendChild(scaleItem);
                }

                row.appendChild(scaleContainer);
                container.appendChild(row);
            });
        }

        /**
         * Ê∏≤ÊüìLikertÈáèË°®
         */
        function renderLikertScale(statementId, statementText) {
            const container = document.getElementById('wellness_statements');
            const statementDiv = document.createElement('div');
            statementDiv.className = 'form-group question-container';
            statementDiv.setAttribute('data-question-id', statementId);

            const label = document.createElement('label');
            label.className = 'question-label';
            label.textContent = statementText;
            const requiredMarker = document.createElement('span');
            requiredMarker.className = 'required-marker';
            requiredMarker.textContent = '*';
            label.appendChild(requiredMarker);
            statementDiv.appendChild(label);

            const likertContainer = document.createElement('div');
            likertContainer.className = 'likert-scale';

            const labelsDiv = document.createElement('div');
            labelsDiv.className = 'likert-labels';
            labelsDiv.innerHTML = '<span>Disagree</span><span>Agree</span>';
            likertContainer.appendChild(labelsDiv);

            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'likert-options';

            const scaleLabels = ['1', '2', '3', '4', '5'];
            scaleLabels.forEach((value, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'likert-option';

                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.id = `${statementId}_${index}`;
                radio.name = statementId;
                radio.value = value;

                const label = document.createElement('label');
                label.htmlFor = `${statementId}_${index}`;
                label.textContent = value;

                optionDiv.appendChild(radio);
                optionDiv.appendChild(label);
                optionsDiv.appendChild(optionDiv);
            });

            likertContainer.appendChild(optionsDiv);
            statementDiv.appendChild(likertContainer);

            const errorMsg = document.createElement('div');
            errorMsg.className = 'error-message';
            errorMsg.textContent = 'Please select an option';
            statementDiv.appendChild(errorMsg);

            container.appendChild(statementDiv);
        }

        /**
         * ÊòæÁ§∫/ÈöêËóèÊù°‰ª∂ÊÄßÈóÆÈ¢ò
         */
        function showHideConditional() {
            // Q5.2: Membership Duration - Âè™Âú®Èùû‰ºöÂëòÊó∂ÊòæÁ§∫
            const membershipType = document.querySelector('input[name="membership_type"]:checked');
            const membershipDurationSection = document.getElementById('membership_duration_section');
            
            if (membershipType && membershipType.value !== "I'm not a member yet") {
                membershipDurationSection.classList.add('show');
            } else {
                membershipDurationSection.classList.remove('show');
                document.querySelectorAll('input[name="membership_duration"]').forEach(r => r.checked = false);
            }

            // Section 6: Ê†πÊçÆ‰ºöÂëòÁ±ªÂûãÊòæÁ§∫‰∏çÂêåÁâàÊú¨
            const membershipImpactRenewalSection = document.getElementById('membership_impact_renewal_section');
            const membershipImpactJoinSection = document.getElementById('membership_impact_join_section');
            
            if (membershipType) {
                if (membershipType.value === "I'm not a member yet") {
                    membershipImpactJoinSection.classList.add('show');
                    membershipImpactRenewalSection.classList.remove('show');
                    document.querySelectorAll('input[name="membership_impact_renewal"]').forEach(r => r.checked = false);
                } else {
                    membershipImpactRenewalSection.classList.add('show');
                    membershipImpactJoinSection.classList.remove('show');
                    document.querySelectorAll('input[name="membership_impact_join"]').forEach(r => r.checked = false);
                }
            } else {
                membershipImpactRenewalSection.classList.remove('show');
                membershipImpactJoinSection.classList.remove('show');
            }
        }

        /**
         * ÊéíÂêçÂäüËÉΩÂÖ®Â±ÄÂèòÈáè
         */
        let rankedFactors = [];
        let rankedComfortZoneAmenities = [];
        let draggedElement = null;

        /**
         * Ê∏≤ÊüìÊéíÂêçÂ§çÈÄâÊ°ÜÁªÑÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
         */
        function renderRankingCheckboxGroup(groupId, options, maxSelections) {
            try {
                const container = document.getElementById(groupId);
                if (!container) {
                    console.error('‚ùå Container not found:', groupId);
                    return;
                }
                
                if (!options || !Array.isArray(options) || options.length === 0) {
                    console.warn('‚ö†Ô∏è No options provided for:', groupId);
                    return;
                }
                
                // Âº∫Âà∂ÊòæÁ§∫ÂÆπÂô®
                container.style.display = 'flex';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                
                container.innerHTML = '';
                
                console.log('üìù Rendering ranking checkbox group:', groupId, 'with', options.length, 'options');

                options.forEach((option, index) => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'checkbox-option';
                    checkboxDiv.setAttribute('data-value', option);

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `${groupId}_${index}`;
                    checkbox.name = 'ranked_factors';
                    checkbox.value = option;
                    checkbox.setAttribute('aria-label', option);
                    checkbox.addEventListener('change', function() {
                        handleRankingChange(option, this.checked);
                    });

                    const label = document.createElement('label');
                    label.htmlFor = `${groupId}_${index}`;
                    label.textContent = option;
                    label.setAttribute('aria-label', option);

                    // Á°Æ‰øùÊï¥‰∏™ div ÂèØÁÇπÂáª
                    checkboxDiv.addEventListener('click', function(e) {
                        if (e.target !== checkbox) {
                            checkbox.click();
                        }
                    });

                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);

                    // Â§ÑÁêÜ "Other" ÈÄâÈ°π
                    if (option === 'Other' || option.includes('Other')) {
                        const otherInput = document.createElement('input');
                        otherInput.type = 'text';
                        otherInput.id = `${groupId}_other`;
                        otherInput.name = 'ranked_factors_other';
                        otherInput.className = 'other-input';
                        otherInput.placeholder = 'Please specify...';
                        otherInput.style.display = 'none';
                        checkboxDiv.appendChild(otherInput);

                        checkbox.addEventListener('change', function() {
                            otherInput.style.display = this.checked ? 'block' : 'none';
                        });
                    }

                    container.appendChild(checkboxDiv);
                });

                updateRankedList();
                
                if (DEBUG_MODE) {
                    console.log('‚úÖ Rendered ranking checkbox group:', groupId, 'with', options.length, 'options');
                }
            } catch (error) {
                console.error('‚ùå Error rendering ranking checkbox group:', groupId, error);
            }
        }

        /**
         * Â§ÑÁêÜÊéíÂêçÂèòÂåñ
         */
        function handleRankingChange(factor, isChecked) {
            if (isChecked) {
                if (rankedFactors.length >= 3) {
                    // Â¶ÇÊûúÂ∑≤ÁªèÊúâ3‰∏™ÔºåÁßªÈô§ÊúÄÂêé‰∏Ä‰∏™
                    const lastFactor = rankedFactors.pop();
                    const checkbox = Array.from(document.querySelectorAll('input[name="ranked_factors"]'))
                        .find(cb => cb.value === lastFactor);
                    if (checkbox) checkbox.checked = false;
                }
                rankedFactors.push(factor);
            } else {
                rankedFactors = rankedFactors.filter(f => f !== factor);
            }
            updateRankedList();
            enforceRankingLimits();
        }

        /**
         * Êõ¥Êñ∞ÊéíÂêçÂàóË°®ÊòæÁ§∫
         */
        function updateRankedList() {
            const rankedList = document.getElementById('ranked_list');
            rankedList.innerHTML = '';

            if (rankedFactors.length === 0) {
                rankedList.innerHTML = '<div class="ranked-placeholder">Select factors above to rank them</div>';
                return;
            }

            rankedFactors.forEach((factor, index) => {
                const rankedItem = document.createElement('div');
                rankedItem.className = 'ranked-item';
                rankedItem.draggable = true;
                rankedItem.dataset.factor = factor;
                rankedItem.dataset.index = index;

                const rankNumber = document.createElement('div');
                rankNumber.className = 'rank-number';
                rankNumber.textContent = index + 1;

                const itemText = document.createElement('div');
                itemText.className = 'ranked-item-text';
                itemText.textContent = factor;

                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.className = 'rank-remove-btn';
                removeBtn.innerHTML = '√ó';
                removeBtn.addEventListener('click', () => {
                    removeFromRanking(factor);
                });

                rankedItem.appendChild(rankNumber);
                rankedItem.appendChild(itemText);
                rankedItem.appendChild(removeBtn);

                // ÊãñÊãΩ‰∫ã‰ª∂ÔºàÊîØÊåÅÈº†Ê†áÂíåËß¶Êë∏Ôºâ
                rankedItem.addEventListener('dragstart', handleDragStart);
                rankedItem.addEventListener('dragover', handleDragOver);
                rankedItem.addEventListener('drop', handleDrop);
                rankedItem.addEventListener('dragend', handleDragEnd);
                
                // Ëß¶Êë∏‰∫ã‰ª∂ÊîØÊåÅÔºàÂπ≥ÊùøÂíåÁßªÂä®ËÆæÂ§áÔºâ
                let touchStartY = 0;
                let touchStartElement = null;
                
                rankedItem.addEventListener('touchstart', function(e) {
                    touchStartY = e.touches[0].clientY;
                    touchStartElement = this;
                    this.classList.add('dragging');
                    e.preventDefault();
                }, { passive: false });
                
                rankedItem.addEventListener('touchmove', function(e) {
                    if (!touchStartElement) return;
                    e.preventDefault();
                    
                    const touchY = e.touches[0].clientY;
                    const allItems = Array.from(document.querySelectorAll('.ranked-item'));
                    const currentIndex = allItems.indexOf(this);
                    
                    // ÊâæÂà∞Ëß¶Êë∏ÁÇπ‰∏ãÊñπÁöÑÂÖÉÁ¥†
                    let targetElement = null;
                    for (let item of allItems) {
                        const rect = item.getBoundingClientRect();
                        if (touchY >= rect.top && touchY <= rect.bottom && item !== this) {
                            targetElement = item;
                            break;
                        }
                    }
                    
                    if (targetElement && targetElement !== touchStartElement) {
                        const targetIndex = allItems.indexOf(targetElement);
                        const startIndex = allItems.indexOf(touchStartElement);
                        
                        if (startIndex < targetIndex) {
                            targetElement.parentNode.insertBefore(touchStartElement, targetElement.nextSibling);
                        } else {
                            targetElement.parentNode.insertBefore(touchStartElement, targetElement);
                        }
                    }
                }, { passive: false });
                
                rankedItem.addEventListener('touchend', function(e) {
                    if (touchStartElement) {
                        touchStartElement.classList.remove('dragging');
                        
                        // Êõ¥Êñ∞ÊéíÂêçÊï∞ÁªÑ
                        const rankedItems = Array.from(document.querySelectorAll('.ranked-item'));
                        rankedFactors = rankedItems.map(item => item.dataset.factor);
                        updateRankNumbers();
                        
                        touchStartElement = null;
                    }
                });

                rankedList.appendChild(rankedItem);
            });

            // Êõ¥Êñ∞ÊéíÂêçÊï∞Â≠ó
            updateRankNumbers();
        }

        /**
         * ÊãñÊãΩÂºÄÂßã
         */
        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        /**
         * ÊãñÊãΩÊÇ¨ÂÅú
         */
        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            if (this !== draggedElement) {
                const allItems = Array.from(document.querySelectorAll('.ranked-item'));
                const draggedIndex = allItems.indexOf(draggedElement);
                const targetIndex = allItems.indexOf(this);

                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(draggedElement, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedElement, this);
                }
            }
            return false;
        }

        /**
         * ÊãñÊãΩÊîæÁΩÆ
         */
        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            return false;
        }

        /**
         * ÊãñÊãΩÁªìÊùü
         */
        function handleDragEnd(e) {
            this.classList.remove('dragging');
            
            // Êõ¥Êñ∞ÊéíÂêçÊï∞ÁªÑ
            const rankedItems = Array.from(document.querySelectorAll('.ranked-item'));
            rankedFactors = rankedItems.map(item => item.dataset.factor);
            
            updateRankNumbers();
        }

        /**
         * Êõ¥Êñ∞ÊéíÂêçÊï∞Â≠ó
         */
        function updateRankNumbers() {
            const rankedItems = document.querySelectorAll('.ranked-item');
            rankedItems.forEach((item, index) => {
                const rankNumber = item.querySelector('.rank-number');
                if (rankNumber) {
                    rankNumber.textContent = index + 1;
                }
            });
        }

        /**
         * ‰ªéÊéíÂêç‰∏≠ÁßªÈô§
         */
        function removeFromRanking(factor) {
            rankedFactors = rankedFactors.filter(f => f !== factor);
            const checkbox = Array.from(document.querySelectorAll('input[name="ranked_factors"]'))
                .find(cb => cb.value === factor);
            if (checkbox) checkbox.checked = false;
            updateRankedList();
            enforceRankingLimits();
        }

        /**
         * Âº∫Âà∂ÊâßË°åÊéíÂêçÈôêÂà∂
         */
        function enforceRankingLimits() {
            const checkboxes = document.querySelectorAll('input[name="ranked_factors"]');
            const checkedCount = rankedFactors.length;

            checkboxes.forEach(cb => {
                const optionDiv = cb.closest('.checkbox-option');
                if (checkedCount >= 3 && !cb.checked) {
                    optionDiv.classList.add('disabled');
                } else {
                    optionDiv.classList.remove('disabled');
                }
            });
        }

        /**
         * Ê∏≤ÊüìËàíÈÄÇÂå∫ËÆæÊñΩÊéíÂêçÂ§çÈÄâÊ°ÜÁªÑÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
         */
        function renderComfortZoneRankingCheckboxGroup(groupId, options, maxSelections, listId, containerId) {
            try {
                const container = document.getElementById(groupId);
                if (!container) {
                    if (DEBUG_MODE) {
                        console.error('‚ùå Container not found:', groupId);
                    }
                    return;
                }
                
                if (!options || !Array.isArray(options) || options.length === 0) {
                    if (DEBUG_MODE) {
                        console.warn('‚ö†Ô∏è No options provided for:', groupId);
                    }
                    return;
                }
                
                container.innerHTML = '';

                options.forEach((option, index) => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'checkbox-option';
                    checkboxDiv.setAttribute('data-value', option);

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `${groupId}_${index}`;
                    checkbox.name = 'comfort_zone_amenities_ranked';
                    checkbox.value = option;
                    checkbox.setAttribute('aria-label', option);
                    checkbox.addEventListener('change', function() {
                        handleComfortZoneRankingChange(option, this.checked, listId, containerId);
                    });

                    const label = document.createElement('label');
                    label.htmlFor = `${groupId}_${index}`;
                    label.textContent = option;
                    label.setAttribute('aria-label', option);

                    // Á°Æ‰øùÊï¥‰∏™ div ÂèØÁÇπÂáª
                    checkboxDiv.addEventListener('click', function(e) {
                        if (e.target !== checkbox) {
                            checkbox.click();
                        }
                    });

                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);

                    // Â§ÑÁêÜ "Other" ÈÄâÈ°π
                    if (option === 'Other' || option.includes('Other')) {
                        const otherInput = document.createElement('input');
                        otherInput.type = 'text';
                        otherInput.id = `${groupId}_other`;
                        otherInput.name = 'comfort_zone_amenities_ranked_other';
                        otherInput.className = 'other-input';
                        otherInput.placeholder = 'Please specify...';
                        otherInput.style.display = 'none';
                        checkboxDiv.appendChild(otherInput);

                        checkbox.addEventListener('change', function() {
                            otherInput.style.display = this.checked ? 'block' : 'none';
                        });
                    }

                    container.appendChild(checkboxDiv);
                });

                updateComfortZoneRankedList(listId);
                
                if (DEBUG_MODE) {
                    console.log('‚úÖ Rendered comfort zone ranking checkbox group:', groupId, 'with', options.length, 'options');
                }
            } catch (error) {
                console.error('‚ùå Error rendering comfort zone ranking checkbox group:', groupId, error);
            }
        }

        /**
         * Â§ÑÁêÜËàíÈÄÇÂå∫ËÆæÊñΩÊéíÂêçÂèòÂåñ
         */
        function handleComfortZoneRankingChange(amenity, isChecked, listId, containerId) {
            if (isChecked) {
                if (rankedComfortZoneAmenities.length >= 3) {
                    const lastAmenity = rankedComfortZoneAmenities.pop();
                    const checkbox = Array.from(document.querySelectorAll('input[name="comfort_zone_amenities_ranked"]'))
                        .find(cb => cb.value === lastAmenity);
                    if (checkbox) checkbox.checked = false;
                }
                rankedComfortZoneAmenities.push(amenity);
            } else {
                rankedComfortZoneAmenities = rankedComfortZoneAmenities.filter(a => a !== amenity);
            }
            updateComfortZoneRankedList(listId);
            enforceComfortZoneRankingLimits(containerId);
        }

        /**
         * Êõ¥Êñ∞ËàíÈÄÇÂå∫ËÆæÊñΩÊéíÂêçÂàóË°®ÊòæÁ§∫
         */
        function updateComfortZoneRankedList(listId) {
            const rankedList = document.getElementById(listId);
            if (!rankedList) return;
            
            rankedList.innerHTML = '';

            if (rankedComfortZoneAmenities.length === 0) {
                rankedList.innerHTML = '<div class="ranked-placeholder">Select elements above to rank them</div>';
                return;
            }

            rankedComfortZoneAmenities.forEach((amenity, index) => {
                const rankedItem = document.createElement('div');
                rankedItem.className = 'ranked-item';
                rankedItem.draggable = true;
                rankedItem.dataset.amenity = amenity;
                rankedItem.dataset.index = index;

                const rankNumber = document.createElement('div');
                rankNumber.className = 'rank-number';
                rankNumber.textContent = index + 1;

                const itemText = document.createElement('div');
                itemText.className = 'ranked-item-text';
                itemText.textContent = amenity;

                const removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.className = 'rank-remove-btn';
                removeBtn.innerHTML = '√ó';
                removeBtn.addEventListener('click', () => {
                    removeFromComfortZoneRanking(amenity, listId);
                });

                rankedItem.appendChild(rankNumber);
                rankedItem.appendChild(itemText);
                rankedItem.appendChild(removeBtn);

                // ÊãñÊãΩ‰∫ã‰ª∂ÔºàÊîØÊåÅÈº†Ê†áÂíåËß¶Êë∏Ôºâ
                rankedItem.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.innerHTML);
                });

                rankedItem.addEventListener('dragover', function(e) {
                    if (e.preventDefault) e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    if (this !== draggedElement) {
                        const allItems = Array.from(document.querySelectorAll(`#${listId} .ranked-item`));
                        const draggedIndex = allItems.indexOf(draggedElement);
                        const targetIndex = allItems.indexOf(this);
                        if (draggedIndex < targetIndex) {
                            this.parentNode.insertBefore(draggedElement, this.nextSibling);
                        } else {
                            this.parentNode.insertBefore(draggedElement, this);
                        }
                    }
                    return false;
                });

                rankedItem.addEventListener('drop', function(e) {
                    if (e.stopPropagation) e.stopPropagation();
                    return false;
                });

                rankedItem.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    const rankedItems = Array.from(document.querySelectorAll(`#${listId} .ranked-item`));
                    rankedComfortZoneAmenities = rankedItems.map(item => item.dataset.amenity);
                    updateComfortZoneRankNumbers(listId);
                });
                
                // Ëß¶Êë∏‰∫ã‰ª∂ÊîØÊåÅÔºàÂπ≥ÊùøÂíåÁßªÂä®ËÆæÂ§áÔºâ
                let touchStartY = 0;
                let touchStartElement = null;
                
                rankedItem.addEventListener('touchstart', function(e) {
                    touchStartY = e.touches[0].clientY;
                    touchStartElement = this;
                    this.classList.add('dragging');
                    e.preventDefault();
                }, { passive: false });
                
                rankedItem.addEventListener('touchmove', function(e) {
                    if (!touchStartElement) return;
                    e.preventDefault();
                    
                    const touchY = e.touches[0].clientY;
                    const allItems = Array.from(document.querySelectorAll(`#${listId} .ranked-item`));
                    const currentIndex = allItems.indexOf(this);
                    
                    // ÊâæÂà∞Ëß¶Êë∏ÁÇπ‰∏ãÊñπÁöÑÂÖÉÁ¥†
                    let targetElement = null;
                    for (let item of allItems) {
                        const rect = item.getBoundingClientRect();
                        if (touchY >= rect.top && touchY <= rect.bottom && item !== this) {
                            targetElement = item;
                            break;
                        }
                    }
                    
                    if (targetElement && targetElement !== touchStartElement) {
                        const targetIndex = allItems.indexOf(targetElement);
                        const startIndex = allItems.indexOf(touchStartElement);
                        
                        if (startIndex < targetIndex) {
                            targetElement.parentNode.insertBefore(touchStartElement, targetElement.nextSibling);
                        } else {
                            targetElement.parentNode.insertBefore(touchStartElement, targetElement);
                        }
                    }
                }, { passive: false });
                
                rankedItem.addEventListener('touchend', function(e) {
                    if (touchStartElement) {
                        touchStartElement.classList.remove('dragging');
                        
                        // Êõ¥Êñ∞ÊéíÂêçÊï∞ÁªÑ
                        const rankedItems = Array.from(document.querySelectorAll(`#${listId} .ranked-item`));
                        rankedComfortZoneAmenities = rankedItems.map(item => item.dataset.amenity);
                        updateComfortZoneRankNumbers(listId);
                        
                        touchStartElement = null;
                    }
                });

                rankedList.appendChild(rankedItem);
            });

            updateComfortZoneRankNumbers(listId);
        }

        /**
         * Êõ¥Êñ∞ËàíÈÄÇÂå∫ËÆæÊñΩÊéíÂêçÊï∞Â≠ó
         */
        function updateComfortZoneRankNumbers(listId) {
            const rankedItems = document.querySelectorAll(`#${listId} .ranked-item`);
            rankedItems.forEach((item, index) => {
                const rankNumber = item.querySelector('.rank-number');
                if (rankNumber) {
                    rankNumber.textContent = index + 1;
                }
            });
        }

        /**
         * ‰ªéËàíÈÄÇÂå∫ËÆæÊñΩÊéíÂêç‰∏≠ÁßªÈô§
         */
        function removeFromComfortZoneRanking(amenity, listId) {
            rankedComfortZoneAmenities = rankedComfortZoneAmenities.filter(a => a !== amenity);
            const checkbox = Array.from(document.querySelectorAll('input[name="comfort_zone_amenities_ranked"]'))
                .find(cb => cb.value === amenity);
            if (checkbox) checkbox.checked = false;
            updateComfortZoneRankedList(listId);
            enforceComfortZoneRankingLimits(listId.replace('_list', '_container'));
        }

        /**
         * Âº∫Âà∂ÊâßË°åËàíÈÄÇÂå∫ËÆæÊñΩÊéíÂêçÈôêÂà∂
         */
        function enforceComfortZoneRankingLimits(containerId) {
            const checkboxes = document.querySelectorAll('input[name="comfort_zone_amenities_ranked"]');
            const checkedCount = rankedComfortZoneAmenities.length;

            checkboxes.forEach(cb => {
                const optionDiv = cb.closest('.checkbox-option');
                if (checkedCount >= 3 && !cb.checked) {
                    optionDiv.classList.add('disabled');
                } else {
                    optionDiv.classList.remove('disabled');
                }
            });
        }

        /**
         * Ê∏≤ÊüìÊâÄÊúâÈóÆÈ¢òÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
         */
        function renderAllQuestions() {
            try {
                if (DEBUG_MODE) {
                    console.log('üìù Starting to render questions...');
                }
                
                // Section 1
                renderRadioGroup('overall_satisfaction_group', surveyConfig.overallSatisfaction);
                renderRankingCheckboxGroup('ranked_factors_group', surveyConfig.topValuedFactors, 3);

                // Section 3
                renderComfortZoneRankingCheckboxGroup('comfort_zone_amenities_ranked_group', surveyConfig.comfortZoneAmenities, 3, 'comfort_zone_amenities_ranked_list', 'comfort_zone_amenities_ranked_container');
                renderRadioGroup('usage_frequency_group', surveyConfig.usageFrequency);
                renderRadioGroup('membership_type_group', surveyConfig.membershipTypes);
                renderRadioGroup('membership_duration_group', surveyConfig.membershipDurations);
                renderRadioGroup('membership_impact_renewal_group', surveyConfig.membershipImpactRenewal);
                renderRadioGroup('membership_impact_join_group', surveyConfig.membershipImpactJoin);

                // Section 4
                surveyConfig.wellnessStatements.forEach((statement, index) => {
                    renderLikertScale(`wellness_q${index + 1}`, statement);
                });

                // Section 5 (ÈáçÂ§çÔºåÂèØËÉΩÊòØÈîôËØØÔºå‰ΩÜ‰øùÁïô‰ª•‰øùÊåÅÂÖºÂÆπÊÄß)
                renderRadioGroup('membership_type_group', surveyConfig.membershipTypes);
                renderRadioGroup('membership_duration_group', surveyConfig.membershipDurations);

                // Section 6 (ÈáçÂ§çÔºåÂèØËÉΩÊòØÈîôËØØÔºå‰ΩÜ‰øùÁïô‰ª•‰øùÊåÅÂÖºÂÆπÊÄß)
                renderRadioGroup('membership_impact_renewal_group', surveyConfig.membershipImpactRenewal);
                renderRadioGroup('membership_impact_join_group', surveyConfig.membershipImpactJoin);

                // Section 7
                renderRadioGroup('age_group_group', surveyConfig.ageGroups);
                renderRadioGroup('gender_group', surveyConfig.genderOptions);

                // ÁõëÂê¨ÂèòÂåñ‰ª•Êõ¥Êñ∞Êù°‰ª∂ÊÄßÈóÆÈ¢ò
                const membershipTypeRadios = document.querySelectorAll('input[name="membership_type"]');
                if (membershipTypeRadios.length > 0) {
                    membershipTypeRadios.forEach(radio => {
                        radio.addEventListener('change', showHideConditional);
                    });
                } else {
                    if (DEBUG_MODE) {
                        console.warn('‚ö†Ô∏è No membership_type radio buttons found');
                    }
                }
                
                if (DEBUG_MODE) {
                    console.log('‚úÖ All questions rendered successfully');
                }
            } catch (error) {
                console.error('‚ùå Error rendering questions:', error);
                // Âç≥‰ΩøÂá∫ÈîôÔºå‰πüÂ∞ùËØïÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
                const sections = document.querySelectorAll('.section');
                sections.forEach(section => {
                    const errorDiv = document.createElement('div');
                    errorDiv.style.cssText = 'background: #f8d7da; color: #721c24; padding: 15px; margin: 10px; border-radius: 4px;';
                    errorDiv.textContent = 'Error loading questions. Please refresh the page.';
                    section.appendChild(errorDiv);
                });
            }
        }

        /**
         * ËÆ°ÁÆóËøõÂ∫¶
         */
        function calculateProgress() {
            const totalQuestions = document.querySelectorAll('.question-container').length;
            let answeredQuestions = 0;

            document.querySelectorAll('.question-container').forEach(container => {
                const questionId = container.getAttribute('data-question-id');
                let isAnswered = false;

                if (questionId === 'ranked_factors') {
                    // Ê£ÄÊü•ÊéíÂêçÔºöÂøÖÈ°ªÊ≠£Â•ΩÊúâ3‰∏™
                    isAnswered = rankedFactors.length === 3;
                } else if (questionId === 'comfort_zone_amenities_ranked') {
                    // È™åËØÅÊéíÂêçÔºöÂøÖÈ°ªÊ≠£Â•ΩÊúâ3‰∏™ÊéíÂêçËÆæÊñΩ
                    isAnswered = rankedComfortZoneAmenities.length === 3;
                }

                // Êù°‰ª∂ÊÄßÈóÆÈ¢òÂè™ÊúâÂú®ÊòæÁ§∫Êó∂ÊâçËÆ°ÁÆó
                if (container.closest('.conditional-section')) {
                    if (container.closest('.conditional-section').classList.contains('show')) {
                        if (isAnswered) answeredQuestions++;
                    }
                } else {
                    if (isAnswered) answeredQuestions++;
                }
            });

            const progress = Math.round((answeredQuestions / totalQuestions) * 100);
            document.getElementById('progressBar').style.width = progress + '%';
            return progress;
        }

        /**
         * ÊªöÂä®Âä®ÁîªÔºàÂ∏¶ÈôçÁ∫ßÊñπÊ°àÔºâ
         */
        function setupScrollAnimation() {
            const sections = document.querySelectorAll('.section');
            
            // Ê£ÄÊü• IntersectionObserver ÊòØÂê¶ÊîØÊåÅ
            if ('IntersectionObserver' in window) {
                try {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('visible');
                            }
                        });
                    }, {
                        threshold: 0.1
                    });

                    sections.forEach(section => {
                        observer.observe(section);
                    });
                    
                    if (DEBUG_MODE) {
                        console.log('‚úÖ IntersectionObserver initialized');
                    }
                } catch (error) {
                    if (DEBUG_MODE) {
                        console.warn('‚ö†Ô∏è IntersectionObserver error, using fallback:', error);
                    }
                    // ÈôçÁ∫ßÔºöÁõ¥Êé•ÊòæÁ§∫ÊâÄÊúâÂÜÖÂÆπ
                    sections.forEach(section => {
                        section.classList.add('visible');
                    });
                }
            } else {
                // ÈôçÁ∫ßÔºöÊµèËßàÂô®‰∏çÊîØÊåÅ IntersectionObserverÔºåÁõ¥Êé•ÊòæÁ§∫ÊâÄÊúâÂÜÖÂÆπ
                if (DEBUG_MODE) {
                    console.warn('‚ö†Ô∏è IntersectionObserver not supported, showing all sections immediately');
                }
                sections.forEach(section => {
                    section.classList.add('visible');
                });
            }
            
            // ÁßªÂä®ËÆæÂ§á‰ºòÂåñÔºöÂª∂ËøüÂêéÁ°Æ‰øùÊâÄÊúâÂÜÖÂÆπÂèØËßÅ
            // Êüê‰∫õÁßªÂä®ÊµèËßàÂô®ÂèØËÉΩÈúÄË¶ÅÈ¢ùÂ§ñÊó∂Èó¥
            setTimeout(() => {
                sections.forEach(section => {
                    if (!section.classList.contains('visible')) {
                        section.classList.add('visible');
                    }
                });
            }, 500);
        }

        /**
         * È™åËØÅË°®Âçï
         */
        function validateForm() {
            let isValid = true;
            const questions = document.querySelectorAll('.question-container');

            questions.forEach(questionDiv => {
                const questionId = questionDiv.getAttribute('data-question-id');
                const errorMsg = questionDiv.querySelector('.error-message');
                let isFieldValid = false;

                // Ë∑≥ËøáÈöêËóèÁöÑÊù°‰ª∂ÊÄßÈóÆÈ¢ò
                if (questionDiv.closest('.conditional-section') && 
                    !questionDiv.closest('.conditional-section').classList.contains('show')) {
                    return;
                }

                if (questionId === 'ranked_factors') {
                    // È™åËØÅÊéíÂêçÔºöÂøÖÈ°ªÊ≠£Â•ΩÊúâ3‰∏™ÊéíÂêçÂõ†Á¥†
                    isFieldValid = rankedFactors.length === 3;
                } else if (questionId === 'comfort_zone_amenities_ranked') {
                    // È™åËØÅÊéíÂêçÔºöÂøÖÈ°ªÊ≠£Â•ΩÊúâ3‰∏™ÊéíÂêçËÆæÊñΩ
                    isFieldValid = rankedComfortZoneAmenities.length === 3;
                } else if (questionId.startsWith('wellness_')) {
                    const checked = questionDiv.querySelector(`input[name="${questionId}"]:checked`);
                    isFieldValid = checked !== null;
                } else {
                    const checked = questionDiv.querySelector(`input[name="${questionId}"]:checked`);
                    isFieldValid = checked !== null;
                }

                if (!isFieldValid) {
                    questionDiv.classList.add('error');
                    if (errorMsg) errorMsg.classList.add('show');
                    isValid = false;
                } else {
                    questionDiv.classList.remove('error');
                    if (errorMsg) errorMsg.classList.remove('show');
                }
            });

            return isValid;
        }

        /**
         * Êî∂ÈõÜË°®ÂçïÊï∞ÊçÆ
         */
        function collectFormData() {
            const responses = {};
            const timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19);

            // ÂõæÁâáÁâàÊú¨
            responses['image_version_shown'] = selectedImageVersion || 'unknown';

            // Section 1: Satisfaction
            const overallSatisfaction = document.querySelector('input[name="overall_satisfaction"]:checked');
            responses['overall_satisfaction'] = overallSatisfaction ? overallSatisfaction.value : '';

            // Section 1: Ranked Factors (ÊéíÂêçÂâç3ÁöÑÂõ†Á¥†)
            responses['ranked_factor_1'] = rankedFactors[0] || '';
            responses['ranked_factor_2'] = rankedFactors[1] || '';
            responses['ranked_factor_3'] = rankedFactors[2] || '';
            const rankedOther = document.querySelector('input[name="ranked_factors_other"]')?.value || '';
            if (rankedOther) responses['ranked_factors_other'] = rankedOther;

            // Section 3: Comfort Zone (ÊéíÂêçÂâç3ÁöÑËÆæÊñΩ)
            responses['comfort_zone_amenity_1'] = rankedComfortZoneAmenities[0] || '';
            responses['comfort_zone_amenity_2'] = rankedComfortZoneAmenities[1] || '';
            responses['comfort_zone_amenity_3'] = rankedComfortZoneAmenities[2] || '';
            const comfortZoneOther = document.querySelector('input[name="comfort_zone_amenities_ranked_other"]')?.value || '';
            if (comfortZoneOther) responses['comfort_zone_other'] = comfortZoneOther;

            const usageFrequency = document.querySelector('input[name="usage_frequency"]:checked');
            responses['usage_frequency'] = usageFrequency ? usageFrequency.value : '';

            // Section 3: Membership (ÁßªÂà∞Section 3)
            const membershipType = document.querySelector('input[name="membership_type"]:checked');
            responses['membership_type'] = membershipType ? membershipType.value : '';
            const membershipTypeOther = document.querySelector('input[name="membership_type_other"]')?.value || '';
            if (membershipTypeOther) responses['membership_type_other'] = membershipTypeOther;

            const membershipDuration = document.querySelector('input[name="membership_duration"]:checked');
            responses['membership_duration'] = membershipDuration ? membershipDuration.value : '';

            // Section 3: Membership Impact (ÁßªÂà∞Section 3)
            const membershipImpactRenewal = document.querySelector('input[name="membership_impact_renewal"]:checked');
            responses['membership_impact_renewal'] = membershipImpactRenewal ? membershipImpactRenewal.value : '';

            const membershipImpactJoin = document.querySelector('input[name="membership_impact_join"]:checked');
            responses['membership_impact_join'] = membershipImpactJoin ? membershipImpactJoin.value : '';

            // Section 4: Wellness
            surveyConfig.wellnessStatements.forEach((_, index) => {
                const checked = document.querySelector(`input[name="wellness_q${index + 1}"]:checked`);
                responses[`wellness_q${index + 1}`] = checked ? checked.value : '';
            });

            // Section 5: Demographics
            const ageGroup = document.querySelector('input[name="age_group"]:checked');
            responses['age_group'] = ageGroup ? ageGroup.value : '';

            const gender = document.querySelector('input[name="gender"]:checked');
            responses['gender'] = gender ? gender.value : '';
            const genderSelfDescribe = document.querySelector('input[name="gender_other"]')?.value || '';
            if (genderSelfDescribe) responses['gender_self_describe'] = genderSelfDescribe;

            return { responses, timestamp };
        }

        /**
         * ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
         */
        function showSuccess(message) {
            const successMsg = document.getElementById('successMessage');
            successMsg.textContent = message;
            successMsg.classList.add('show');
            
            setTimeout(() => {
                successMsg.classList.remove('show');
            }, 5000);
        }

        /**
         * ÊòæÁ§∫ÈîôËØØÊ∂àÊÅØ
         */
        function showError(message) {
            const errorMsg = document.getElementById('errorMessageBox');
            errorMsg.textContent = message;
            errorMsg.classList.add('show');
            
            setTimeout(() => {
                errorMsg.classList.remove('show');
            }, 5000);
        }

        /**
         * CSVÂàóÂÆö‰πâÔºà‰∏éÊúçÂä°Âô®Á´Ø‰øùÊåÅ‰∏ÄËá¥Ôºâ
         */
        const CSV_COLUMNS = [
            'Timestamp',
            'Overall_Satisfaction',
            'Ranked_Factor_1',
            'Ranked_Factor_2',
            'Ranked_Factor_3',
            'Ranked_Factors_Other',
            'Image_Version_Shown',
            'Comfort_Zone_Amenity_1',
            'Comfort_Zone_Amenity_2',
            'Comfort_Zone_Amenity_3',
            'Comfort_Zone_Other',
            'Usage_Frequency',
            'Membership_Type',
            'Membership_Type_Other',
            'Membership_Duration',
            'Membership_Impact_Renewal',
            'Membership_Impact_Join',
            'Wellness_Q1',
            'Wellness_Q2',
            'Wellness_Q3',
            'Wellness_Q4',
            'Wellness_Q5',
            'Wellness_Q6',
            'Age_Group',
            'Gender',
            'Gender_Self_Describe'
        ];

        /**
         * ËΩ¨‰πâCSVÂ≠óÊÆµ‰∏≠ÁöÑÁâπÊÆäÂ≠óÁ¨¶
         */
        function escapeCSVField(field) {
            if (field === null || field === undefined || field === '') {
                return '';
            }
            const stringField = String(field);
            if (stringField.includes(',') || stringField.includes('"') || stringField.includes('\n')) {
                return '"' + stringField.replace(/"/g, '""') + '"';
            }
            return stringField;
        }

        /**
         * Â∞ÜÂìçÂ∫îËΩ¨Êç¢‰∏∫CSVË°å
         */
        function convertToCSVRow(responses, timestamp) {
            const row = [];
            
            CSV_COLUMNS.forEach(column => {
                let value = '';
                
                switch (column) {
                    case 'Timestamp':
                        value = timestamp || new Date().toISOString().replace('T', ' ').substring(0, 19);
                        break;
                    case 'Overall_Satisfaction':
                        value = responses.overall_satisfaction || '';
                        break;
                    case 'Ranked_Factor_1':
                        value = responses.ranked_factor_1 || '';
                        break;
                    case 'Ranked_Factor_2':
                        value = responses.ranked_factor_2 || '';
                        break;
                    case 'Ranked_Factor_3':
                        value = responses.ranked_factor_3 || '';
                        break;
                    case 'Ranked_Factors_Other':
                        value = responses.ranked_factors_other || '';
                        break;
                    case 'Image_Version_Shown':
                        value = responses.image_version_shown || '';
                        break;
                    case 'Comfort_Zone_Amenity_1':
                        value = responses.comfort_zone_amenity_1 || '';
                        break;
                    case 'Comfort_Zone_Amenity_2':
                        value = responses.comfort_zone_amenity_2 || '';
                        break;
                    case 'Comfort_Zone_Amenity_3':
                        value = responses.comfort_zone_amenity_3 || '';
                        break;
                    case 'Comfort_Zone_Other':
                        value = responses.comfort_zone_other || '';
                        break;
                    case 'Usage_Frequency':
                        value = responses.usage_frequency || '';
                        break;
                    case 'Membership_Type':
                        value = responses.membership_type || '';
                        break;
                    case 'Membership_Type_Other':
                        value = responses.membership_type_other || '';
                        break;
                    case 'Membership_Duration':
                        value = responses.membership_duration || '';
                        break;
                    case 'Membership_Impact_Renewal':
                        value = responses.membership_impact_renewal || '';
                        break;
                    case 'Membership_Impact_Join':
                        value = responses.membership_impact_join || '';
                        break;
                    case 'Wellness_Q1':
                    case 'Wellness_Q2':
                    case 'Wellness_Q3':
                    case 'Wellness_Q4':
                    case 'Wellness_Q5':
                    case 'Wellness_Q6':
                        const wellnessNum = column.match(/\d+/)[0];
                        value = responses[`wellness_q${wellnessNum}`] || '';
                        break;
                    case 'Age_Group':
                        value = responses.age_group || '';
                        break;
                    case 'Gender':
                        value = responses.gender || '';
                        break;
                    case 'Gender_Self_Describe':
                        value = responses.gender_self_describe || '';
                        break;
                    default:
                        value = '';
                }
                
                row.push(escapeCSVField(value));
            });
            
            return row.join(',');
        }

        /**
         * ‰øùÂ≠òÂìçÂ∫îÂà∞ localStorage
         */
        function saveResponseToLocalStorage(responses, timestamp) {
            try {
                const storageKey = 'survey_responses';
                let allResponses = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                const responseData = {
                    timestamp: timestamp || new Date().toISOString().replace('T', ' ').substring(0, 19),
                    responses: responses
                };
                
                allResponses.push(responseData);
                localStorage.setItem(storageKey, JSON.stringify(allResponses));
                
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                return false;
            }
        }

        /**
         * ÂØºÂá∫ÊâÄÊúâÂìçÂ∫î‰∏∫ CSV
         */
        function exportToCSV() {
            try {
                const storageKey = 'survey_responses';
                const allResponses = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                if (allResponses.length === 0) {
                    alert('No responses to export.');
                    return;
                }
                
                // ÂàõÂª∫ CSV ÂÜÖÂÆπ
                let csvContent = CSV_COLUMNS.join(',') + '\n';
                
                allResponses.forEach(responseData => {
                    const csvRow = convertToCSVRow(responseData.responses, responseData.timestamp);
                    csvContent += csvRow + '\n';
                });
                
                // ÂàõÂª∫‰∏ãËΩΩÈìæÊé•
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `survey_responses_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('Error exporting CSV:', error);
                alert('Error exporting CSV. Please try again.');
            }
        }

        /**
         * Êèê‰∫§Êï∞ÊçÆÂà∞ Google Sheets
         * ‰ΩøÁî® no-cors Ê®°ÂºèÈÅøÂÖç CORS È¢ÑÊ£ÄËØ∑Ê±ÇÈóÆÈ¢ò
         * @param {Object} data - Ë¶ÅÊèê‰∫§ÁöÑÊï∞ÊçÆÂØπË±°
         * @returns {Promise<Object>} - ËøîÂõûÊèê‰∫§ÁªìÊûú
         */
        async function submitToGoogleSheets(data) {
            if (!ENABLE_GOOGLE_SHEETS || !GOOGLE_APPS_SCRIPT_URL) {
                throw new Error('Google Sheets integration is not configured');
            }

            if (DEBUG_MODE) {
                console.log('üì§ Submitting to Google Sheets:', {
                    url: GOOGLE_APPS_SCRIPT_URL,
                    data: data,
                    timestamp: new Date().toISOString()
                });
            }

            try {
                // È™åËØÅ URL Ê†ºÂºè
                if (!GOOGLE_APPS_SCRIPT_URL.startsWith('https://script.google.com/')) {
                    throw new Error('Invalid Google Apps Script URL format');
                }

                // ‰ΩøÁî® no-cors Ê®°ÂºèÈÅøÂÖç CORS È¢ÑÊ£ÄËØ∑Ê±ÇÔºàOPTIONSÔºâÈóÆÈ¢ò
                // Ê≥®ÊÑèÔºöno-cors Ê®°Âºè‰∏ãÊó†Ê≥ïËØªÂèñÂìçÂ∫îÔºå‰ΩÜËØ∑Ê±Ç‰ºöÊàêÂäüÂèëÈÄÅ
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // ‰ΩøÁî® no-cors ÈÅøÂÖç CORS È¢ÑÊ£ÄËØ∑Ê±Ç
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (DEBUG_MODE) {
                    console.log('üì• Request sent (no-cors mode, cannot read response):', {
                        type: response.type,
                        url: response.url || GOOGLE_APPS_SCRIPT_URL
                    });
                }

                // Âú® no-cors Ê®°Âºè‰∏ãÔºåÊàë‰ª¨Êó†Ê≥ïËØªÂèñÂìçÂ∫î
                // ‰ΩÜÂ¶ÇÊûúÊ≤°ÊúâÊäõÂá∫ÈîôËØØÔºåËØ¥ÊòéËØ∑Ê±ÇÂ∑≤ÁªèÂèëÈÄÅ
                // ÂÅáËÆæÊèê‰∫§ÊàêÂäüÔºàÂ¶ÇÊûú Google Apps Script ÈÖçÁΩÆÊ≠£Á°ÆÔºåÊï∞ÊçÆÂ∫îËØ•Â∑≤ÁªèÂÜôÂÖ•Ôºâ
                return {
                    success: true,
                    message: 'Data submitted successfully (no-cors mode - response not readable)',
                    note: 'Request sent. Please verify data in Google Sheets.'
                };
            } catch (error) {
                if (DEBUG_MODE) {
                    console.error('‚ùå Google Sheets submission error:', error);
                    console.error('Error details:', {
                        name: error.name,
                        message: error.message,
                        stack: error.stack,
                        url: GOOGLE_APPS_SCRIPT_URL
                    });
                }

                // Êèê‰æõÊõ¥ËØ¶ÁªÜÁöÑÈîôËØØ‰ø°ÊÅØ
                let errorMessage = 'Failed to submit to Google Sheets';
                if (error.message.includes('404')) {
                    errorMessage += ': URL not found (404). Please check if the Google Apps Script Web App is deployed correctly.';
                } else if (error.message.includes('Failed to fetch') || error.message.includes('Load failed')) {
                    errorMessage += ': Network error or CORS issue. Please check: 1) Your internet connection, 2) The Google Apps Script URL is correct, 3) The Web App is deployed with "Who has access: Anyone".';
                } else {
                    errorMessage += ': ' + error.message;
                }

                throw new Error(errorMessage);
            }
        }

        /**
         * Êèê‰∫§Ë°®ÂçïÔºàÊîØÊåÅ Google Sheets Âíå localStorageÔºâ
         */
        async function submitForm(event) {
            event.preventDefault();

            if (!validateForm()) {
                showError('Please complete all required fields');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            // ËÆæÁΩÆÂä†ËΩΩÁä∂ÊÄÅ
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Submitting...';

            try {
                const { responses, timestamp } = collectFormData();
                
                if (DEBUG_MODE) {
                    console.log('üìã Form data collected:', { responses, timestamp });
                }
                
                // ÂáÜÂ§áÊèê‰∫§Êï∞ÊçÆ
                const submitData = {
                    timestamp: timestamp,
                    ...responses
                };

                let googleSheetsSuccess = false;
                let localStorageSuccess = false;
                let googleSheetsError = null;

                // Â¶ÇÊûúÂêØÁî®‰∫Ü Google SheetsÔºåÂÖàÊèê‰∫§Âà∞ Google Sheets
                if (ENABLE_GOOGLE_SHEETS) {
                    try {
                        if (DEBUG_MODE) {
                            console.log('üîÑ Attempting to submit to Google Sheets...');
                            console.log('üìç URL:', GOOGLE_APPS_SCRIPT_URL);
                        }
                        const result = await submitToGoogleSheets(submitData);
                        // Âè™ÊúâÁúüÊ≠£ÊàêÂäüÊó∂ÊâçËÆæÁΩÆ‰∏∫ true
                        googleSheetsSuccess = result && result.success === true;
                        if (DEBUG_MODE) {
                            if (googleSheetsSuccess) {
                                console.log('‚úÖ Successfully submitted to Google Sheets:', result);
                            } else {
                                console.warn('‚ö†Ô∏è Google Sheets submission returned unsuccessful result:', result);
                            }
                        }
                    } catch (error) {
                        googleSheetsError = error;
                        googleSheetsSuccess = false;
                        if (DEBUG_MODE) {
                            console.error('‚ùå Google Sheets submission failed:', error);
                            console.error('Error details:', {
                                message: error.message,
                                name: error.name,
                                stack: error.stack
                            });
                        }
                        // Âç≥‰Ωø Google Sheets Â§±Ë¥•Ôºå‰πüÁªßÁª≠‰øùÂ≠òÂà∞ localStorage
                    }
                }

                // ‰øùÂ≠òÂà∞ localStorageÔºà‰Ωú‰∏∫Â§á‰ªΩÔºâ
                try {
                    if (DEBUG_MODE) {
                        console.log('üíæ Saving to localStorage...');
                    }
                    localStorageSuccess = saveResponseToLocalStorage(responses, timestamp);
                    if (DEBUG_MODE && localStorageSuccess) {
                        console.log('‚úÖ Successfully saved to localStorage');
                    }
                } catch (error) {
                    if (DEBUG_MODE) {
                        console.error('‚ùå localStorage save failed:', error);
                    }
                }

                // ÊòæÁ§∫ÁªìÊûúÊ∂àÊÅØÔºàÂü∫‰∫éÁúüÂÆûÁöÑÊèê‰∫§ÁªìÊûúÔºâ
                if (googleSheetsSuccess) {
                    // Google Sheets Êèê‰∫§ÊàêÂäüÔºàËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅÔºå‰ΩÜÈúÄË¶ÅÈ™åËØÅÊï∞ÊçÆÊòØÂê¶ÂÜôÂÖ•Ôºâ
                    showSuccess('Thank you! Your response has been submitted. Please verify the data appears in your Google Sheets.');
                    
                    if (DEBUG_MODE) {
                        console.log('‚úÖ Request sent successfully. Please check Google Sheets to verify data was written.');
                    }
                    
                    // ÈáçÁΩÆË°®Âçï
                    document.getElementById('surveyForm').reset();
                    rankedFactors = [];
                    rankedComfortZoneAmenities = [];
                    updateRankedList();
                    updateComfortZoneRankedList('comfort_zone_amenities_ranked_list');
                    enforceRankingLimits();
                    enforceComfortZoneRankingLimits('comfort_zone_amenities_ranked_container');
                    selectRandomImage();
                    showHideConditional();
                    calculateProgress();
                } else if (localStorageSuccess) {
                    // Âè™Êúâ localStorage ÊàêÂäüÔºàGoogle Sheets Â§±Ë¥•Ôºâ
                    let errorMessage = 'Your response has been saved locally, but failed to submit to Google Sheets. ';
                    if (googleSheetsError) {
                        errorMessage += 'Error: ' + googleSheetsError.message;
                    } else {
                        errorMessage += 'Please check your Google Apps Script configuration.';
                    }
                    showError(errorMessage);
                    
                    if (DEBUG_MODE) {
                        console.warn('‚ö†Ô∏è Data saved locally but Google Sheets submission failed');
                        if (googleSheetsError) {
                            console.warn('‚ö†Ô∏è Google Sheets error:', googleSheetsError.message);
                        }
                    }
                } else {
                    // ÂÆåÂÖ®Â§±Ë¥•
                    showError('Failed to save response. Please check the console for details and try again.');
                    if (DEBUG_MODE) {
                        console.error('‚ùå Both Google Sheets and localStorage save failed');
                    }
                }
            } catch (error) {
                if (DEBUG_MODE) {
                    console.error('‚ùå Submission error:', error);
                    console.error('Error stack:', error.stack);
                }
                showError('An error occurred. Please try again. Check the console for details.');
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                submitBtn.textContent = originalText;
            }
        }

        /**
         * ÊòæÁ§∫Ë∞ÉËØï‰ø°ÊÅØÔºàÂÖºÂÆπ Android 7.0Ôºâ
         */
        function showDebugInfo() {
            var debugInfo, debugContent, errorMsg = '';
            
            try {
                debugInfo = document.getElementById('debugInfo');
                debugContent = document.getElementById('debugContent');
                
                if (!debugInfo) {
                    errorMsg = 'Debug info element not found';
                    console.error('‚ùå ' + errorMsg);
                    return;
                }
                
                if (!debugContent) {
                    errorMsg = 'Debug content element not found';
                    console.error('‚ùå ' + errorMsg);
                    return;
                }
                
                // Âº∫Âà∂ÊòæÁ§∫Ë∞ÉËØï‰ø°ÊÅØÊ°Ü
                debugInfo.style.display = 'block';
                debugInfo.style.visibility = 'visible';
                debugInfo.style.opacity = '1';
                debugInfo.style.zIndex = '99999';
                
                // Ëé∑ÂèñÂü∫Êú¨‰ø°ÊÅØÔºà‰ΩøÁî®ÂÖºÂÆπÊÄßÊõ¥Â•ΩÁöÑÊñπÊ≥ïÔºâ
                var isTouchDevice = false;
                try {
                    isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                } catch (e) {
                    isTouchDevice = false;
                }
                
                var screenWidth = window.screen.width || window.innerWidth || 0;
                var screenHeight = window.screen.height || window.innerHeight || 0;
                var viewportWidth = window.innerWidth || 0;
                var viewportHeight = window.innerHeight || 0;
                var userAgent = navigator.userAgent || 'Unknown';
                var platform = navigator.platform || 'Unknown';
                
                // Ê£ÄÊµãÊµèËßàÂô®ÔºàÂÖºÂÆπÊóßÁâà AndroidÔºâ
                var browser = 'Unknown';
                if (userAgent.indexOf('Chrome') > -1) {
                    browser = 'Chrome';
                } else if (userAgent.indexOf('Safari') > -1) {
                    browser = 'Safari';
                } else if (userAgent.indexOf('Firefox') > -1) {
                    browser = 'Firefox';
                } else if (userAgent.indexOf('Edge') > -1) {
                    browser = 'Edge';
                }
                
                // Ê£ÄÊµãËÆæÂ§áÁ±ªÂûã
                var deviceType = 'Desktop';
                if (isTouchDevice) {
                    if (screenWidth < 768) {
                        deviceType = 'Mobile';
                    } else {
                        deviceType = 'Tablet';
                    }
                }
                
                // Ê£ÄÊü•ÂÖ≥ÈîÆÂÖÉÁ¥†Ôºà‰ΩøÁî®ÂÖºÂÆπÊÄßÊõ¥Â•ΩÁöÑÊñπÊ≥ïÔºâ
                var overallSatisfactionGroup = null;
                var rankedFactorsGroup = null;
                var radioCount = 0;
                var checkboxCount = 0;
                var radioGroups = [];
                var checkboxGroups = [];
                
                try {
                    overallSatisfactionGroup = document.getElementById('overall_satisfaction_group');
                    rankedFactorsGroup = document.getElementById('ranked_factors_group');
                    radioCount = document.querySelectorAll('input[type="radio"]').length;
                    checkboxCount = document.querySelectorAll('input[type="checkbox"]').length;
                    radioGroups = document.querySelectorAll('.radio-group');
                    checkboxGroups = document.querySelectorAll('.checkbox-group');
                } catch (e) {
                    errorMsg = 'Error querying elements: ' + e.message;
                    console.error('‚ùå ' + errorMsg);
                }
                
                // Ê£ÄÊü•ÂÆπÂô®Áä∂ÊÄÅ
                var overallStatus = 'NOT FOUND';
                var rankedStatus = 'NOT FOUND';
                
                if (overallSatisfactionGroup) {
                    try {
                        var computedStyle = window.getComputedStyle(overallSatisfactionGroup);
                        var childrenCount = overallSatisfactionGroup.children ? overallSatisfactionGroup.children.length : 0;
                        overallStatus = 'Found | Display: ' + computedStyle.display + ' | Visibility: ' + computedStyle.visibility + ' | Opacity: ' + computedStyle.opacity + ' | Children: ' + childrenCount;
                    } catch (e) {
                        overallStatus = 'Found but error reading style: ' + e.message;
                    }
                }
                
                if (rankedFactorsGroup) {
                    try {
                        var computedStyle2 = window.getComputedStyle(rankedFactorsGroup);
                        var childrenCount2 = rankedFactorsGroup.children ? rankedFactorsGroup.children.length : 0;
                        rankedStatus = 'Found | Display: ' + computedStyle2.display + ' | Visibility: ' + computedStyle2.visibility + ' | Opacity: ' + computedStyle2.opacity + ' | Children: ' + childrenCount2;
                    } catch (e) {
                        rankedStatus = 'Found but error reading style: ' + e.message;
                    }
                }
                
                // Ê£ÄÊü• surveyConfig
                var configLoaded = false;
                try {
                    configLoaded = (typeof surveyConfig !== 'undefined');
                } catch (e) {
                    configLoaded = false;
                }
                
                // ÊûÑÂª∫ HTML ÂÜÖÂÆπÔºà‰ΩøÁî®Â≠óÁ¨¶‰∏≤ÊãºÊé•ÔºåÈÅøÂÖçÊ®°ÊùøÂ≠óÁ¨¶‰∏≤ÂÖºÂÆπÊÄßÈóÆÈ¢òÔºâ
                var html = '';
                html += '<div style="margin-bottom: 8px;"><strong>üåê ÊµèËßàÂô®:</strong> ' + browser + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>üíª Âπ≥Âè∞:</strong> ' + platform + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>üì± ËÆæÂ§áÁ±ªÂûã:</strong> ' + deviceType + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>üëÜ Ëß¶Êë∏ËÆæÂ§á:</strong> ' + (isTouchDevice ? '‚úÖ ÊòØ' : '‚ùå Âê¶') + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>üìê Â±èÂπïÂ∞∫ÂØ∏:</strong> ' + screenWidth + ' x ' + screenHeight + 'px</div>';
                html += '<div style="margin-bottom: 8px;"><strong>üëÅÔ∏è ËßÜÂè£Â∞∫ÂØ∏:</strong> ' + viewportWidth + ' x ' + viewportHeight + 'px</div>';
                
                var pixelRatio = 1;
                try {
                    pixelRatio = window.devicePixelRatio || 1;
                } catch (e) {
                    pixelRatio = 1;
                }
                html += '<div style="margin-bottom: 8px;"><strong>üîç ËÆæÂ§áÂÉèÁ¥†ÊØî:</strong> ' + pixelRatio + '</div>';
                
                var radioBg = radioCount > 0 ? '#0f0' : '#f00';
                html += '<div style="margin-bottom: 8px; padding: 5px; background: ' + radioBg + '; border-radius: 3px;"><strong>üìä Ë°®ÂçïÂÖÉÁ¥†Êï∞Èáè:</strong> Radio: ' + radioCount + ', Checkbox: ' + checkboxCount + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>üì¶ ÈÄâÈ°πÂÆπÂô®:</strong> Radio Groups: ' + radioGroups.length + ', Checkbox Groups: ' + checkboxGroups.length + '</div>';
                
                var overallBg = (overallSatisfactionGroup && overallSatisfactionGroup.children && overallSatisfactionGroup.children.length > 0) ? '#0f0' : '#f00';
                html += '<div style="margin-bottom: 8px; padding: 5px; background: ' + overallBg + '; border-radius: 3px;"><strong>‚ùì ÈóÆÈ¢ò1ÂÆπÂô®:</strong> ' + overallStatus + '</div>';
                
                var rankedBg = (rankedFactorsGroup && rankedFactorsGroup.children && rankedFactorsGroup.children.length > 0) ? '#0f0' : '#f00';
                html += '<div style="margin-bottom: 8px; padding: 5px; background: ' + rankedBg + '; border-radius: 3px;"><strong>‚ùì ÈóÆÈ¢ò2ÂÆπÂô®:</strong> ' + rankedStatus + '</div>';
                
                var configBg = configLoaded ? '#0f0' : '#f00';
                html += '<div style="margin-bottom: 8px; padding: 5px; background: ' + configBg + '; border-radius: 3px;"><strong>‚öôÔ∏è Survey Config:</strong> ' + (configLoaded ? '‚úÖ Loaded' : '‚ùå NOT LOADED') + '</div>';
                
                if (errorMsg) {
                    html += '<div style="margin-top: 10px; padding: 5px; background: #f00; border-radius: 3px; color: yellow;"><strong>‚ö†Ô∏è ÈîôËØØ:</strong> ' + errorMsg + '</div>';
                }
                
                debugContent.innerHTML = html;
                
                console.log('‚úÖ Debug info displayed');
            } catch (error) {
                console.error('Error showing debug info:', error);
                if (debugContent) {
                    debugContent.innerHTML = '<div style="color: yellow; padding: 10px; background: #f00; border-radius: 3px;"><strong>‚ùå ÈîôËØØ:</strong> ' + error.message + '</div>';
                }
            }
        }

        // ÂàùÂßãÂåñÔºàÂ∏¶ÈîôËØØÂ§ÑÁêÜÔºâ
        function initializeApp() {
            try {
                if (DEBUG_MODE) {
                    console.log('üöÄ Initializing application...');
                    console.log('üìç Document ready state:', document.readyState);
                    console.log('üìç User agent:', navigator.userAgent);
                }
                
                // ÊòæÁ§∫Ë∞ÉËØï‰ø°ÊÅØ
                showDebugInfo();
                
                // Ê£ÄÊü•ÂøÖË¶ÅÁöÑÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
                const form = document.getElementById('surveyForm');
                if (!form) {
                    console.error('‚ùå Form element not found!');
                    return;
                }
                
                // ÈÄâÊã©ÈöèÊú∫ÂõæÁâá
                if (DEBUG_MODE) {
                    console.log('üñºÔ∏è Selecting random image...');
                }
                selectRandomImage();
                
                // Ê∏≤ÊüìÊâÄÊúâÈóÆÈ¢ò
                console.log('üìù Rendering questions...');
                console.log('üìç Survey config available:', typeof surveyConfig !== 'undefined');
                
                if (typeof surveyConfig === 'undefined') {
                    console.error('‚ùå Survey config is not defined!');
                    alert('Error: Survey configuration not loaded. Please refresh the page.');
                    return;
                }
                
                renderAllQuestions();
                
                // È™åËØÅÊ∏≤ÊüìÁªìÊûú
                setTimeout(() => {
                    const firstRadioGroup = document.getElementById('overall_satisfaction_group');
                    const firstCheckboxGroup = document.getElementById('ranked_factors_group');
                    
                    if (firstRadioGroup) {
                        const options = firstRadioGroup.querySelectorAll('.radio-option');
                        console.log('‚úÖ First radio group rendered with', options.length, 'options');
                        if (options.length === 0) {
                            console.error('‚ùå Radio group is empty!');
                            // Âº∫Âà∂ÊòæÁ§∫ÂÆπÂô®
                            firstRadioGroup.style.display = 'flex';
                            firstRadioGroup.style.visibility = 'visible';
                            firstRadioGroup.style.opacity = '1';
                            firstRadioGroup.style.border = '2px solid red'; // Ë∞ÉËØïÁî®
                        }
                    } else {
                        console.error('‚ùå First radio group not found after rendering!');
                    }
                    
                    if (firstCheckboxGroup) {
                        const options = firstCheckboxGroup.querySelectorAll('.checkbox-option');
                        console.log('‚úÖ First checkbox group rendered with', options.length, 'options');
                        if (options.length === 0) {
                            console.error('‚ùå Checkbox group is empty!');
                            // Âº∫Âà∂ÊòæÁ§∫ÂÆπÂô®
                            firstCheckboxGroup.style.display = 'flex';
                            firstCheckboxGroup.style.visibility = 'visible';
                            firstCheckboxGroup.style.opacity = '1';
                            firstCheckboxGroup.style.border = '2px solid red'; // Ë∞ÉËØïÁî®
                        }
                    } else {
                        console.error('‚ùå First checkbox group not found after rendering!');
                    }
                    
                    // Êõ¥Êñ∞Ë∞ÉËØï‰ø°ÊÅØ
                    showDebugInfo();
                }, 500);
                
                // ËÆæÁΩÆÊªöÂä®Âä®Áîª
                setupScrollAnimation();
                
                // ÊòæÁ§∫/ÈöêËóèÊù°‰ª∂ÊÄßÈóÆÈ¢ò
                showHideConditional();
                
                // ËÆ°ÁÆóËøõÂ∫¶
                calculateProgress();

                // ÁõëÂê¨ËæìÂÖ•ÂèòÂåñ‰ª•Êõ¥Êñ∞ËøõÂ∫¶
                document.addEventListener('change', () => {
                    calculateProgress();
                });

                // ÁªëÂÆöË°®ÂçïÊèê‰∫§‰∫ã‰ª∂
                if (form) {
                    form.addEventListener('submit', submitForm);
                    if (DEBUG_MODE) {
                        console.log('‚úÖ Form submit event listener attached');
                    }
                } else {
                    console.error('‚ùå Form element not found!');
                }
                
                // Ê£ÄÊü• URL ÂèÇÊï∞ÔºåÂ¶ÇÊûúÊòØÁÆ°ÁêÜÂëòÊ®°ÂºèÔºåÊòæÁ§∫ÂØºÂá∫ÊåâÈíÆ
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('admin') === '1') {
                    const exportBtn = document.getElementById('exportBtn');
                    if (exportBtn) {
                        exportBtn.style.display = 'block';
                    }
                }
                
                // Á°Æ‰øùÊâÄÊúâ section Âú®ÁßªÂä®ËÆæÂ§á‰∏äÂèØËßÅÔºàÈ¢ùÂ§ñ‰øùÈô©Ôºâ
                setTimeout(() => {
                    const sections = document.querySelectorAll('.section');
                    sections.forEach(section => {
                        section.classList.add('visible');
                    });
                    if (DEBUG_MODE) {
                        console.log('‚úÖ All sections made visible (backup)');
                    }
                }, 1000);
                
                if (DEBUG_MODE) {
                    console.log('‚úÖ Application initialized successfully');
                }
            } catch (error) {
                console.error('‚ùå Initialization error:', error);
                console.error('Error stack:', error.stack);
                // Âç≥‰ΩøÂá∫ÈîôÔºå‰πüÂ∞ùËØïÊòæÁ§∫ÂÜÖÂÆπ
                const sections = document.querySelectorAll('.section');
                sections.forEach(section => {
                    section.classList.add('visible');
                });
            }
        }

        // Á´ãÂç≥ÊòæÁ§∫Ë∞ÉËØï‰ø°ÊÅØÔºà‰∏çÁ≠âÂæÖÈ°µÈù¢Âä†ËΩΩÔºåÂÖºÂÆπ Android 7.0Ôºâ
        (function() {
            try {
                // Á≠âÂæÖ DOM ÂÖÉÁ¥†Â≠òÂú®
                function tryShowDebug() {
                    var debugInfo = document.getElementById('debugInfo');
                    if (debugInfo) {
                        // Á´ãÂç≥Ë∞ÉÁî®‰∏ÄÊ¨°
                        if (typeof showDebugInfo === 'function') {
                            showDebugInfo();
                            // ÊØè2ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Ë∞ÉËØï‰ø°ÊÅØ
                            setInterval(showDebugInfo, 2000);
                        } else {
                            // Â¶ÇÊûúÂáΩÊï∞‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®ÁÆÄÂçïÁâàÊú¨
                            var debugContent = document.getElementById('debugContent');
                            if (debugContent) {
                                debugContent.innerHTML = '<div style="color: #f00;">‚ùå showDebugInfo ÂáΩÊï∞Êú™ÂÆö‰πâ</div>';
                            }
                        }
                    } else {
                        // Â¶ÇÊûúÂÖÉÁ¥†Ëøò‰∏çÂ≠òÂú®Ôºå100ms ÂêéÂÜçËØï
                        setTimeout(tryShowDebug, 100);
                    }
                }
                tryShowDebug();
            } catch (e) {
                console.error('Error in immediate debug info:', e);
                var debugContent = document.getElementById('debugContent');
                if (debugContent) {
                    debugContent.innerHTML = '<div style="color: #f00;">‚ùå ÂàùÂßãÂåñÈîôËØØ: ' + e.message + '</div>';
                }
            }
        })();

        // ‰ΩøÁî®Â§öÁßçÊñπÂºèÁ°Æ‰øùÂàùÂßãÂåñ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initializeApp();
                showDebugInfo();
            });
        } else {
            // DOM Â∑≤ÁªèÂä†ËΩΩÂÆåÊàê
            initializeApp();
            showDebugInfo();
        }
        
        // È¢ùÂ§ñÁöÑ‰øùÈô©ÔºöÂ¶ÇÊûú‰∏äÈù¢ÁöÑÈÉΩÊ≤°ÊâßË°åÔºåÂú® window.onload Êó∂ÂÜçËØï‰∏ÄÊ¨°
        window.addEventListener('load', () => {
            const sections = document.querySelectorAll('.section');
            if (sections.length > 0 && !sections[0].classList.contains('visible')) {
                if (DEBUG_MODE) {
                    console.warn('‚ö†Ô∏è Sections not visible on load, forcing visibility');
                }
                sections.forEach(section => {
                    section.classList.add('visible');
                });
            }
            showDebugInfo();
        });
    </script>
</body>
</html>
