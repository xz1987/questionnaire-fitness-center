<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Finger Lakes Fitness Center Renovation Survey</title>
    <style>
        /* ============================================
           é¢œè‰²æ–¹æ¡ˆï¼šTeal (#008B8B) å’Œ Orange (#FF6B6B)
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 0;
            padding-bottom: 100px;
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            z-index: 1000;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #008B8B 0%, #FF6B6B 100%);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Header Section */
        .header {
            background: white;
            text-align: center;
            padding: 40px 20px;
            border-bottom: 3px solid #008B8B;
        }

        .header h1 {
            color: #008B8B;
            font-size: 2.5em;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #008B8B;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header .tagline {
            color: #FF6B6B;
            font-size: 1em;
            font-style: italic;
        }

        /* Consent Statement */
        .consent {
            background: #f0f8f8;
            border-left: 4px solid #008B8B;
            padding: 25px;
            margin: 30px auto;
            max-width: 900px;
            border-radius: 4px;
        }

        .consent h2 {
            color: #008B8B;
            font-size: 1.2em;
            margin-bottom: 12px;
        }

        .consent p {
            color: #555;
            font-size: 0.95em;
            line-height: 1.8;
        }

        /* Section Styling */
        .section {
            background: white;
            margin: 30px auto;
            max-width: 900px;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            opacity: 1 !important; /* å¼ºåˆ¶æ˜¾ç¤ºï¼Œä¸ä¾èµ– JavaScript */
            transform: translateY(0) !important;
            transition: opacity 0.5s ease, transform 0.5s ease;
            display: block !important;
            visibility: visible !important;
        }

        .section.visible {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }
        
        /* ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–ï¼šå¦‚æœ JavaScript æœªæ‰§è¡Œï¼Œè‡³å°‘å†…å®¹å¯è§ */
        @media (max-width: 1024px) {
            .section {
                opacity: 1 !important;
                transform: translateY(0) !important;
                display: block !important;
                visibility: visible !important;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨å•å…ƒç´ ä¼˜åŒ– */
            .radio-option,
            .checkbox-option {
                min-height: 48px;
                padding: 14px;
            }
            
            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                width: 28px;
                height: 28px;
                min-width: 28px;
                min-height: 28px;
            }
            
            .satisfaction-scale-item,
            .likert-option {
                min-height: 48px;
                min-width: 60px;
                padding: 12px;
            }
            
            .satisfaction-scale-item input[type="radio"],
            .likert-option input[type="radio"] {
                width: 24px;
                height: 24px;
                min-width: 24px;
                min-height: 24px;
            }
            
            input[type="text"],
            textarea {
                font-size: 16px; /* é˜²æ­¢ iOS è‡ªåŠ¨ç¼©æ”¾ */
                min-height: 48px;
            }
            
            button,
            .submit-btn {
                min-height: 48px;
            }
        }
        
        /* è§¦æ‘¸è®¾å¤‡ç‰¹å®šä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .radio-option,
            .checkbox-option {
                min-height: 48px;
                padding: 14px;
            }
            
            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                width: 28px;
                height: 28px;
                min-width: 28px;
                min-height: 28px;
            }
            
            /* ç§»é™¤ hover æ•ˆæœï¼Œä½¿ç”¨ active ä»£æ›¿ */
            .radio-option:hover,
            .checkbox-option:hover {
                border-color: #e0e0e0;
                background-color: transparent;
            }
            
            .radio-option:active,
            .checkbox-option:active {
                background-color: #e0f0f0;
                border-color: #008B8B;
            }
        }

        .section:nth-child(even) {
            background: #fafafa;
        }

        .section-title {
            color: #008B8B;
            font-size: 1.8em;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .framing-text {
            color: #555;
            font-size: 1em;
            margin-bottom: 25px;
            line-height: 1.8;
            font-style: italic;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 30px;
        }

        .question-label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .required-marker {
            color: #FF6B6B;
            margin-left: 4px;
        }

        /* Radio Groups */
        .radio-group {
            display: -webkit-box !important;
            display: -webkit-flex !important;
            display: -ms-flexbox !important;
            display: flex !important;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -ms-flex-direction: column;
            flex-direction: column;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 50px; /* ç¡®ä¿å®¹å™¨æœ‰é«˜åº¦ */
        }

        .radio-group > * {
            margin-bottom: 12px;
        }

        .radio-group > *:last-child {
            margin-bottom: 0;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px; /* ç§»åŠ¨ç«¯æœ€å°è§¦æ‘¸åŒºåŸŸ */
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            position: relative;
            z-index: 1;
        }

        .radio-option:hover {
            border-color: #008B8B;
            background-color: #f0f8f8;
        }

        .radio-option:active {
            background-color: #e0f0f0;
            transform: scale(0.98);
        }

        .radio-option:focus-within {
            border-color: #008B8B;
            box-shadow: 0 0 0 3px rgba(0, 139, 139, 0.1);
        }

        .radio-option input[type="radio"] {
            margin-right: 12px;
            width: 24px;
            height: 24px;
            min-width: 24px;
            min-height: 24px;
            cursor: pointer;
            accent-color: #008B8B;
            flex-shrink: 0;
            -webkit-appearance: radio;
            appearance: radio;
            position: relative;
            z-index: 2;
        }
        
        /* ç¡®ä¿ label å¯ç‚¹å‡»æ•´ä¸ªåŒºåŸŸ */
        .radio-option label {
            flex: 1;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            padding: 4px 0;
            min-height: 24px;
            display: flex;
            align-items: center;
        }

        /* Checkbox Groups */
        .checkbox-group {
            display: -webkit-box !important;
            display: -webkit-flex !important;
            display: -ms-flexbox !important;
            display: flex !important;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -ms-flex-direction: column;
            flex-direction: column;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 50px; /* ç¡®ä¿å®¹å™¨æœ‰é«˜åº¦ */
        }

        .checkbox-group > * {
            margin-bottom: 12px;
        }

        .checkbox-group > *:last-child {
            margin-bottom: 0;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 44px; /* ç§»åŠ¨ç«¯æœ€å°è§¦æ‘¸åŒºåŸŸ */
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            position: relative;
            z-index: 1;
        }

        .checkbox-option:hover {
            border-color: #008B8B;
            background-color: #f0f8f8;
        }

        .checkbox-option:active {
            background-color: #e0f0f0;
            transform: scale(0.98);
        }

        .checkbox-option:focus-within {
            border-color: #008B8B;
            box-shadow: 0 0 0 3px rgba(0, 139, 139, 0.1);
        }

        .checkbox-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 12px;
            width: 24px;
            height: 24px;
            min-width: 24px;
            min-height: 24px;
            cursor: pointer;
            accent-color: #008B8B;
            flex-shrink: 0;
            -webkit-appearance: checkbox;
            appearance: checkbox;
            position: relative;
            z-index: 2;
        }
        
        /* ç¡®ä¿ label å¯ç‚¹å‡»æ•´ä¸ªåŒºåŸŸ */
        .checkbox-option label {
            flex: 1;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            padding: 4px 0;
            min-height: 24px;
            display: flex;
            align-items: center;
        }

        .choice-limit {
            color: #FF6B6B;
            font-size: 0.9em;
            font-weight: 600;
            margin-top: 10px;
        }

        .choice-limit.error {
            color: #FF6B6B;
        }

        /* Satisfaction Grid - Using Flexbox for compatibility */
        .satisfaction-grid {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -ms-flex-direction: column;
            flex-direction: column;
            margin-top: 15px;
        }

        .satisfaction-grid > * {
            margin-bottom: 15px;
        }

        .satisfaction-grid > *:last-child {
            margin-bottom: 0;
        }

        .satisfaction-row {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }

        .satisfaction-label {
            -webkit-box-flex: 0;
            -webkit-flex: 0 0 200px;
            -ms-flex: 0 0 200px;
            flex: 0 0 200px;
            min-width: 200px;
            font-weight: 500;
            color: #333;
        }

        .satisfaction-scale {
            -webkit-box-flex: 1;
            -webkit-flex: 1;
            -ms-flex: 1;
            flex: 1;
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
        }

        .satisfaction-scale > * {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .satisfaction-scale > *:last-child {
            margin-right: 0;
        }

        .satisfaction-scale-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 50px;
            min-height: 44px;
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            position: relative;
        }

        .satisfaction-scale-item:hover {
            border-color: #008B8B;
            background-color: #f0f8f8;
        }

        .satisfaction-scale-item:active {
            background-color: #e0f0f0;
            transform: scale(0.95);
        }

        .satisfaction-scale-item input[type="radio"] {
            margin-bottom: 5px;
            accent-color: #008B8B;
            width: 20px;
            height: 20px;
            min-width: 20px;
            min-height: 20px;
        }

        .satisfaction-scale-item label {
            font-size: 0.85em;
            color: #666;
            cursor: pointer;
        }

        /* Likert Scale */
        .likert-scale {
            margin-top: 15px;
        }

        .likert-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.85em;
            color: #666;
        }

        .likert-options {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-flex-wrap: wrap;
            -ms-flex-wrap: wrap;
            flex-wrap: wrap;
        }

        .likert-options > * {
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .likert-options > *:last-child {
            margin-right: 0;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
            min-height: 44px;
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            position: relative;
        }

        .likert-option:hover {
            border-color: #008B8B;
            background-color: #f0f8f8;
        }

        .likert-option:active {
            background-color: #e0f0f0;
            transform: scale(0.95);
        }

        .likert-option input[type="radio"] {
            margin-bottom: 5px;
            accent-color: #008B8B;
            width: 20px;
            height: 20px;
            min-width: 20px;
            min-height: 20px;
        }

        .likert-option label {
            font-size: 0.9em;
            color: #666;
            cursor: pointer;
        }

        /* Image Display */
        .image-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #fafafa;
            border-radius: 8px;
        }

        .rendering-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        .image-caption {
            color: #008B8B;
            font-weight: 600;
            margin-top: 10px;
            font-size: 1em;
        }

        .image-subcaption {
            color: #666;
            font-size: 0.85em;
            font-style: italic;
            margin-top: 5px;
        }

        /* Text Inputs */
        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px; /* é˜²æ­¢ iOS è‡ªåŠ¨ç¼©æ”¾ */
            font-family: inherit;
            transition: border-color 0.3s ease;
            min-height: 44px; /* ç§»åŠ¨ç«¯æœ€å°è§¦æ‘¸åŒºåŸŸ */
            box-sizing: border-box;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="text"]:focus,
        textarea:focus {
            outline: none;
            border-color: #008B8B;
            box-shadow: 0 0 0 3px rgba(0, 139, 139, 0.1);
        }
        
        /* æŒ‰é’®æ ·å¼ä¼˜åŒ– */
        button,
        .submit-btn {
            min-height: 44px;
            -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            touch-action: manipulation; /* ä¼˜åŒ–è§¦æ‘¸å“åº” */
        }

        .other-input {
            margin-top: 10px;
        }

        /* Conditional Sections */
        .conditional-section {
            margin-top: 20px;
            padding-left: 20px;
            border-left: 3px solid #008B8B;
            display: none;
        }

        .conditional-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Error Messages */
        .error-message {
            color: #FF6B6B;
            font-size: 0.9em;
            margin-top: 8px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .question-container.error .checkbox-option,
        .question-container.error .radio-option,
        .question-container.error input,
        .question-container.error textarea {
            border-color: #FF6B6B;
        }

        /* Submit Button - Sticky */
        .submit-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }

        .submit-btn {
            background: linear-gradient(135deg, #008B8B 0%, #006666 100%);
            color: white;
            border: none;
            padding: 18px 50px;
            font-size: 1.2em;
            font-weight: 600;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            display: block;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 139, 139, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            position: relative;
        }

        /* åŠ è½½åŠ¨ç”» */
        .submit-btn.loading::after {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .submit-btn.loading {
            color: transparent;
        }

        /* Messages */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            display: none;
            text-align: center;
            border: 1px solid #c3e6cb;
        }

        .success-message.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .error-message-box {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            display: none;
            text-align: center;
            border: 1px solid #f5c6cb;
        }

        .error-message-box.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ranking System */
        .ranking-container {
            margin-top: 20px;
        }

        .ranked-selections {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #008B8B;
            min-height: 150px;
        }

        .ranking-instructions {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            font-style: italic;
        }

        .ranked-list {
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-orient: vertical;
            -webkit-box-direction: normal;
            -webkit-flex-direction: column;
            -ms-flex-direction: column;
            flex-direction: column;
        }

        .ranked-list > * {
            margin-bottom: 10px;
        }

        .ranked-list > *:last-child {
            margin-bottom: 0;
        }

        .ranked-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border: 2px solid #008B8B;
            border-radius: 6px;
            cursor: move;
            transition: all 0.3s ease;
            position: relative;
        }

        .ranked-item:hover {
            box-shadow: 0 4px 12px rgba(0, 139, 139, 0.2);
            transform: translateX(5px);
        }

        .ranked-item.dragging {
            opacity: 0.6;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 139, 139, 0.4);
        }
        
        /* è§¦æ‘¸åé¦ˆ */
        .ranked-item:active {
            transform: scale(0.98);
        }
        
        @media (hover: none) and (pointer: coarse) {
            /* è§¦æ‘¸è®¾å¤‡æ ·å¼ä¼˜åŒ– */
            .ranked-item {
                -webkit-tap-highlight-color: rgba(0, 139, 139, 0.2);
            }
            
            .radio-option:active,
            .checkbox-option:active {
                background-color: #e0f0f0;
            }
        }

        .rank-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background: #008B8B;
            color: white;
            border-radius: 50%;
            font-weight: 600;
            font-size: 1.1em;
            margin-right: 15px;
            flex-shrink: 0;
        }

        .ranked-item-text {
            flex: 1;
            font-weight: 500;
            color: #333;
        }

        .rank-remove-btn {
            background: #FF6B6B;
            color: white;
            border: none;
            min-width: 44px;
            min-height: 44px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: -webkit-box;
            display: -webkit-flex;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-align: center;
            -webkit-align-items: center;
            -ms-flex-align: center;
            align-items: center;
            -webkit-box-pack: center;
            -webkit-justify-content: center;
            -ms-flex-pack: center;
            justify-content: center;
            margin-left: 10px;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: rgba(255, 107, 107, 0.3);
            touch-action: manipulation;
        }

        .rank-remove-btn:hover {
            background: #e55555;
            transform: scale(1.1);
        }

        .ranked-placeholder {
            text-align: center;
            color: #999;
            padding: 30px;
            font-style: italic;
        }

        /* Responsive Design */
        
        /* Tabvar Styles (768px - 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .section {
                padding: 30px;
                margin: 25px auto;
                max-width: 95%;
            }

            .header {
                padding: 35px 20px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .question-label {
                font-size: 1.15em;
            }

            /* Larger touch targets for tablets */
            .radio-option,
            .checkbox-option {
                padding: 16px;
                min-height: 56px; /* Minimum touch target size */
            }

            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                width: 24px;
                height: 24px;
            }

            .ranked-item {
                padding: 16px;
                min-height: 56px;
            }

            .rank-remove-btn {
                width: 36px;
                height: 36px;
                font-size: 24px;
            }

            .submit-btn {
                padding: 18px 40px;
                font-size: 1.2em;
                min-height: 56px;
            }

            .rendering-image {
                max-width: 100%;
                height: auto;
            }

            .satisfaction-scale-item {
                min-width: 60px;
                padding: 12px;
            }

            .likert-option {
                min-width: 60px;
                padding: 12px;
            }
        }

        /* Large Phone (414px - 767px) */
        @media (min-width: 414px) and (max-width: 767px) {
            .section {
                padding: 25px;
                margin: 20px 10px;
            }

            .header h1 {
                font-size: 1.9em;
            }
        }

        /* Small Phone and Mobile Styles (max-width: 768px) */
        @media (max-width: 768px) {
            .section {
                padding: 20px;
                margin: 20px 10px;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .satisfaction-row {
                -webkit-box-orient: vertical;
                -webkit-box-direction: normal;
                -webkit-flex-direction: column;
                -ms-flex-direction: column;
                flex-direction: column;
            }

            .satisfaction-label {
                -webkit-box-flex: 0;
                -webkit-flex: 0 0 auto;
                -ms-flex: 0 0 auto;
                flex: 0 0 auto;
                min-width: auto;
                margin-bottom: 10px;
            }

            .likert-options {
                justify-content: center;
            }

            .satisfaction-scale {
                justify-content: center;
            }

            /* Larger touch targets for mobile */
            .radio-option,
            .checkbox-option {
                padding: 16px;
                min-height: 48px;
            }

            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                width: 22px;
                height: 22px;
            }

            .ranked-item {
                padding: 14px;
                min-height: 48px;
            }

            .submit-btn {
                padding: 16px 30px;
                min-height: 48px;
            }
        }
    </style>
</head>
<body>
    <!-- è°ƒè¯•ä¿¡æ¯æ¡†ï¼ˆå·²éšè—ï¼‰ -->
    <div id="debugInfo" style="position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; background: #ff0000 !important; color: white !important; padding: 10px !important; font-size: 14px !important; z-index: 99999 !important; border-bottom: 3px solid #000 !important; max-height: 300px !important; overflow-y: auto !important; display: none !important; visibility: hidden !important; opacity: 0 !important;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
            <strong style="font-size: 16px;">ğŸ” è°ƒè¯•ä¿¡æ¯ï¼ˆç‚¹å‡»å…³é—­ï¼‰</strong>
            <button onclick="document.getElementById('debugInfo').style.display='none'" style="padding: 5px 15px; background: #000; color: white; border: 2px solid white; border-radius: 4px; cursor: pointer; font-weight: bold;">âœ• å…³é—­</button>
        </div>
        <div id="debugContent" style="background: rgba(0,0,0,0.3); padding: 8px; border-radius: 4px; font-family: monospace; line-height: 1.6;">
            <div>â³ æ­£åœ¨åŠ è½½è°ƒè¯•ä¿¡æ¯...</div>
            <div style="margin-top: 5px; color: yellow;">å¦‚æœè¿™é‡Œä¸€ç›´æ˜¾ç¤º"æ­£åœ¨åŠ è½½"ï¼Œè¯´æ˜ JavaScript æ‰§è¡Œæœ‰é—®é¢˜</div>
            <div id="debugSimple" style="margin-top: 10px; padding: 5px; background: #000; color: #0f0; border: 1px solid #0f0;">
                <div>ç®€å•æµ‹è¯•: <span id="testTime">-</span></div>
            </div>
        </div>
        
        <!-- å†…è”è„šæœ¬ï¼Œå»¶è¿Ÿæ‰§è¡Œï¼Œç­‰å¾… DOM åŠ è½½ -->
        <script>
            // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿ DOM å®Œå…¨åŠ è½½
            function updateDebugInfo() {
                try {
                    // ç«‹å³æ›´æ–°ç®€å•æµ‹è¯•
                    var testTimeEl = document.getElementById('testTime');
                    if (testTimeEl) {
                        testTimeEl.textContent = new Date().toLocaleTimeString();
                    }
                    
                    // ç«‹å³å°è¯•æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
                    var debugContent = document.getElementById('debugContent');
                    if (debugContent) {
                        var html = '<div style="color: #0f0;">âœ… JavaScript å·²æ‰§è¡Œ</div>';
                        html += '<div>æ—¶é—´: ' + new Date().toLocaleTimeString() + '</div>';
                        html += '<div>User Agent: ' + (navigator.userAgent || 'Unknown') + '</div>';
                        html += '<div>å±å¹•: ' + (window.screen.width || 0) + 'x' + (window.screen.height || 0) + '</div>';
                        html += '<div>è§†å£: ' + (window.innerWidth || 0) + 'x' + (window.innerHeight || 0) + '</div>';
                        html += '<div>DOM Ready: ' + (document.readyState || 'unknown') + '</div>';
                        
                        // æ£€æŸ¥æ‰€æœ‰å¯èƒ½çš„å…ƒç´ 
                        var allElements = document.querySelectorAll('*');
                        html += '<div>é¡µé¢å…ƒç´ æ€»æ•°: ' + allElements.length + '</div>';
                        
                        // æ£€æŸ¥ form å…ƒç´ 
                        var form = document.getElementById('surveyForm');
                        html += '<div style="padding: 5px; background: ' + (form ? '#0f0' : '#f00') + ';">è¡¨å•: ' + (form ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°') + '</div>';
                        
                        // æ£€æŸ¥ section å…ƒç´ 
                        var sections = document.querySelectorAll('.section');
                        html += '<div>Section æ•°é‡: ' + sections.length + '</div>';
                        
                        // æ£€æŸ¥å…³é”®å…ƒç´ ï¼ˆå¤šæ¬¡å°è¯•ï¼Œå› ä¸ºå¯èƒ½è¿˜æ²¡åŠ è½½ï¼‰
                        var overallGroup = document.getElementById('overall_satisfaction_group');
                        var rankedGroup = document.getElementById('ranked_factors_group');
                        
                        html += '<div style="margin-top: 10px; padding: 5px; background: ' + (overallGroup ? '#0f0' : '#f00') + ';">é—®é¢˜1å®¹å™¨: ' + (overallGroup ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°') + '</div>';
                        html += '<div style="padding: 5px; background: ' + (rankedGroup ? '#0f0' : '#f00') + ';">é—®é¢˜2å®¹å™¨: ' + (rankedGroup ? 'æ‰¾åˆ°' : 'æœªæ‰¾åˆ°') + '</div>';
                        
                        if (overallGroup) {
                            var children = overallGroup.children ? overallGroup.children.length : 0;
                            var style = window.getComputedStyle(overallGroup);
                            html += '<div>é—®é¢˜1å­å…ƒç´ : ' + children + ' | Display: ' + style.display + ' | Visibility: ' + style.visibility + '</div>';
                        }
                        if (rankedGroup) {
                            var children2 = rankedGroup.children ? rankedGroup.children.length : 0;
                            var style2 = window.getComputedStyle(rankedGroup);
                            html += '<div>é—®é¢˜2å­å…ƒç´ : ' + children2 + ' | Display: ' + style2.display + ' | Visibility: ' + style2.visibility + '</div>';
                        }
                        
                        // æ£€æŸ¥è¡¨å•å…ƒç´ 
                        var radios = document.querySelectorAll('input[type="radio"]');
                        var checkboxes = document.querySelectorAll('input[type="checkbox"]');
                        html += '<div style="margin-top: 10px; padding: 5px; background: ' + (radios.length > 0 ? '#0f0' : '#f00') + ';">Radio æ•°é‡: ' + radios.length + '</div>';
                        html += '<div style="padding: 5px; background: ' + (checkboxes.length > 0 ? '#0f0' : '#f00') + ';">Checkbox æ•°é‡: ' + checkboxes.length + '</div>';
                        
                        // æ£€æŸ¥ radio-group å’Œ checkbox-group
                        var radioGroups = document.querySelectorAll('.radio-group');
                        var checkboxGroups = document.querySelectorAll('.checkbox-group');
                        html += '<div>Radio Groups: ' + radioGroups.length + ' | Checkbox Groups: ' + checkboxGroups.length + '</div>';
                        
                        debugContent.innerHTML = html;
                    }
                } catch (e) {
                    var debugContent = document.getElementById('debugContent');
                    if (debugContent) {
                        debugContent.innerHTML = '<div style="color: #f00;">âŒ é”™è¯¯: ' + e.message + '</div><div>Stack: ' + (e.stack || 'N/A') + '</div>';
                    }
                }
            }
            
            // ç«‹å³æ‰§è¡Œä¸€æ¬¡
            updateDebugInfo();
            
            // DOM åŠ è½½å®Œæˆåå†æ¬¡æ‰§è¡Œ
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    setTimeout(updateDebugInfo, 100);
                    setTimeout(updateDebugInfo, 500);
                    setTimeout(updateDebugInfo, 1000);
                });
            } else {
                setTimeout(updateDebugInfo, 100);
                setTimeout(updateDebugInfo, 500);
                setTimeout(updateDebugInfo, 1000);
            }
            
            // window.onload æ—¶å†æ‰§è¡Œä¸€æ¬¡
            window.addEventListener('load', function() {
                setTimeout(updateDebugInfo, 100);
                setTimeout(updateDebugInfo, 500);
            });
        </script>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Header -->
    <div class="header">
        <h1>FINGER LAKES FITNESS CENTER</h1>
        <div class="subtitle">RENOVATION SURVEY</div>
        <div class="tagline">We appreciate your help!</div>
    </div>

    <!-- Consent Statement -->
    <div class="consent">
        <h2>Consent & Clarification Statement</h2>
        <p>
            This survey is to better understand your wellness needs. Your feedback will help us enhance our facilities 
            and explore future development. By completing this survey, you confirm you've read and understood this information. 
            Participation is <strong>anonymous</strong> and <strong>voluntary</strong>; the survey takes about <strong>3-4 minutes</strong>.
        </p>
    </div>

    <form id="surveyForm">
        <!-- Section 1: Current Satisfaction Assessment -->
        <div class="section" id="section1">
            <h2 class="section-title">Section 1: Current Satisfaction Assessment</h2>
            <p class="framing-text">Understanding Your Current Experience<br>Help us understand how well we're meeting your needs today.</p>
            
            <div class="form-group question-container" data-question-id="overall_satisfaction">
                <label class="question-label">
                    How satisfied are you with Finger Lakes Fitness Center overall?
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="overall_satisfaction_group"></div>
                <div class="error-message">Please select an option</div>
            </div>

            <div class="form-group question-container" data-question-id="ranked_factors">
                <label class="question-label">
                    Please select and rank your top 3 valued factors when choosing a fitness center
                    <span class="required-marker">*</span>
                </label>
                <p class="section-subtitle" style="margin-top: -10px; margin-bottom: 15px;">
                    Drag or touch to reorder your selections (top 3 will be ranked)
                </p>
                <div class="ranking-container" id="ranked_factors_container">
                    <div class="checkbox-group" id="ranked_factors_group"></div>
                    <div class="ranked-selections" id="ranked_selections">
                        <p class="ranking-instructions">Select up to 3 factors, then drag to rank them:</p>
                        <div class="ranked-list" id="ranked_list"></div>
                    </div>
                </div>
                <div class="error-message">Please select and rank at least 3 factors</div>
            </div>
        </div>

        <!-- Section 3: Comfort Zone Concept -->
        <div class="section" id="section3">
            <h2 class="section-title">Section 2: Comfort Zone Concept</h2>
            <p class="framing-text">
                We're Refreshing the Fitness Center<br>
                We're exploring adding a dedicated comfort zoneâ€”a place to restore and recharge between workouts. 
                This space would provide a comfortable environment to relax, transition between activities, and prepare mentally for your next set.
            </p>
            
            <div class="image-section">
                <img id="renderingImage" class="rendering-image" alt="Comfort Zone Rendering" />
                <div class="image-caption">View How It Looks in Space â†’</div>
                <div class="image-subcaption">Renderings are conceptual â€” shown for inspiration, not final design.</div>
            </div>

            <div class="form-group question-container" data-question-id="comfort_zone_amenities_ranked">
                <label class="question-label">
                    Please select and rank your top 3 elements that would be most valuable in this comfort zone
                    <span class="required-marker">*</span>
                </label>
                <p class="section-subtitle" style="margin-top: -10px; margin-bottom: 15px;">
                    Drag or touch to reorder your selections (top 3 will be ranked)
                </p>
                <div class="ranking-container" id="comfort_zone_amenities_ranked_container">
                    <div class="checkbox-group" id="comfort_zone_amenities_ranked_group"></div>
                    <div class="ranked-selections" id="comfort_zone_amenities_ranked_selections">
                        <p class="ranking-instructions">Select up to 3 elements, then drag to rank them:</p>
                        <div class="ranked-list" id="comfort_zone_amenities_ranked_list"></div>
                    </div>
                </div>
                <div class="error-message">Please select and rank at least 3 elements</div>
            </div>

            <div class="form-group question-container" data-question-id="usage_frequency">
                <label class="question-label">
                    If this comfort zone were available with your valued elements, how often would you use this space?
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="usage_frequency_group"></div>
                <div class="error-message">Please select an option</div>
            </div>

            <div class="form-group question-container" data-question-id="membership_type">
                <label class="question-label">
                    Your Membership Type:
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="membership_type_group"></div>
                <div class="error-message">Please select an option</div>
            </div>

            <div class="conditional-section" id="membership_duration_section">
                <div class="form-group question-container" data-question-id="membership_duration">
                    <label class="question-label">
                        (If you are a member) For how long have you been a member?
                        <span class="required-marker">*</span>
                    </label>
                    <div class="radio-group" id="membership_duration_group"></div>
                    <div class="error-message">Please select an option</div>
                </div>
            </div>

            <!-- Version A: For Current Members -->
            <div class="conditional-section" id="membership_impact_renewal_section">
                <div class="form-group question-container" data-question-id="membership_impact_renewal">
                    <label class="question-label">
                        How would adding this comfort zone affect your likelihood to <strong>renew</strong> your membership?
                        <span class="required-marker">*</span>
                    </label>
                    <div class="radio-group" id="membership_impact_renewal_group"></div>
                    <div class="error-message">Please select an option</div>
                </div>
            </div>

            <!-- Version B: For Non-Members -->
            <div class="conditional-section" id="membership_impact_join_section">
                <div class="form-group question-container" data-question-id="membership_impact_join">
                    <label class="question-label">
                        How would this comfort zone affect your likelihood to <strong>join</strong> with a new membership?
                        <span class="required-marker">*</span>
                    </label>
                    <div class="radio-group" id="membership_impact_join_group"></div>
                    <div class="error-message">Please select an option</div>
                </div>
            </div>
        </div>

        <!-- Section 4: Wellness & Balance Assessment -->
        <div class="section" id="section4">
            <h2 class="section-title">Section 3: Wellness & Balance Assessment</h2>
            <p class="framing-text">Think about how each statement fits you<br>Please check the option that feels most true right now.</p>
            
            <div id="wellness_statements"></div>
        </div>

        <!-- Section 7: Demographics -->
        <div class="section" id="section7">
            <h2 class="section-title">Section 4: Demographics</h2>
            
            <div class="form-group question-container" data-question-id="age_group">
                <label class="question-label">
                    Age Group
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="age_group_group"></div>
                <div class="error-message">Please select an option</div>
            </div>

            <div class="form-group question-container" data-question-id="gender">
                <label class="question-label">
                    Gender
                    <span class="required-marker">*</span>
                </label>
                <div class="radio-group" id="gender_group"></div>
                <div class="error-message">Please select an option</div>
            </div>
        </div>

        <!-- Submit Container -->
        <div class="submit-container">
            <button type="submit" class="submit-btn" id="submitBtn">Submit Survey</button>
            <div class="success-message" id="successMessage"></div>
            <div class="error-message-box" id="errorMessageBox"></div>
            <!-- ç®¡ç†å‘˜å¯¼å‡ºæŒ‰é’®ï¼ˆå¯é€‰ï¼Œå¯ä»¥é€šè¿‡ URL å‚æ•° ?admin=1 æ˜¾ç¤ºï¼‰ -->
            <button type="button" class="submit-btn" id="exportBtn" style="display: none; margin-top: 10px; background: linear-gradient(135deg, #FF6B6B 0%, #e55555 100%);" onclick="exportToCSV()">Export Responses to CSV</button>
        </div>
    </form>

    <script>
        /**
         * ============================================
         * ES5 Polyfills for Older Tablets (iOS 10+, Android 5.0+)
         * ============================================
         */
        
        // Promise Polyfill (for older browsers)
        if (typeof Promise === 'undefined') {
            (function() {
                function Promise(executor) {
                    var self = this;
                    self.state = 'pending';
                    self.value = undefined;
                    self.handlers = [];
                    
                    function resolve(result) {
                        if (self.state === 'pending') {
                            self.state = 'fulfilled';
                            self.value = result;
                            self.handlers.forEach(handle);
                            self.handlers = null;
                        }
                    }
                    
                    function reject(error) {
                        if (self.state === 'pending') {
                            self.state = 'rejected';
                            self.value = error;
                            self.handlers.forEach(handle);
                            self.handlers = null;
                        }
                    }
                    
                    function handle(handler) {
                        if (self.state === 'pending') {
                            self.handlers.push(handler);
                        } else {
                            if (self.state === 'fulfilled' && typeof handler.onFulfilled === 'function') {
                                handler.onFulfilled(self.value);
                            }
                            if (self.state === 'rejected' && typeof handler.onRejected === 'function') {
                                handler.onRejected(self.value);
                            }
                        }
                    }
                    
                    self.then = function(onFulfilled, onRejected) {
                        return new Promise(function(resolve, reject) {
                            handle({
                                onFulfilled: function(result) {
                                    try {
                                        resolve(onFulfilled ? onFulfilled(result) : result);
                                    } catch (ex) {
                                        reject(ex);
                                    }
                                },
                                onRejected: function(error) {
                                    try {
                                        resolve(onRejected ? onRejected(error) : error);
                                    } catch (ex) {
                                        reject(ex);
                                    }
                                }
                            });
                        });
                    };
                    
                    try {
                        executor(resolve, reject);
                    } catch (ex) {
                        reject(ex);
                    }
                }
                window.Promise = Promise;
            })();
        }
        
        // Array.from Polyfill
        if (!Array.from) {
            Array.from = function(arrayLike, mapFn, thisArg) {
                var C = this;
                var items = Object(arrayLike);
                if (items == null) {
                    throw new TypeError('Array.from requires an array-like object - not null or undefined');
                }
                var mapFunction = mapFn === undefined ? undefined : mapFn;
                var T;
                if (typeof mapFunction !== 'undefined') {
                    if (typeof mapFunction !== 'function') {
                        throw new TypeError('Array.from: when provided, the second argument must be a function');
                    }
                    if (arguments.length > 2) {
                        T = thisArg;
                    }
                }
                var len = parseInt(items.length) || 0;
                var A = typeof C === 'function' ? Object(new C(len)) : new Array(len);
                var k = 0;
                var kValue;
                while (k < len) {
                    kValue = items[k];
                    if (mapFunction) {
                        A[k] = typeof T === 'undefined' ? mapFunction(kValue, k) : mapFunction.call(T, kValue, k);
                    } else {
                        A[k] = kValue;
                    }
                    k += 1;
                }
                A.length = len;
                return A;
            };
        }
        
        // Object.assign Polyfill
        if (typeof Object.assign !== 'function') {
            Object.assign = function(target) {
                if (target == null) {
                    throw new TypeError('Cannot convert undefined or null to object');
                }
                var to = Object(target);
                for (var index = 1; index < arguments.length; index++) {
                    var nextSource = arguments[index];
                    if (nextSource != null) {
                        for (var nextKey in nextSource) {
                            if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                                to[nextKey] = nextSource[nextKey];
                            }
                        }
                    }
                }
                return to;
            };
        }
        
        // Fetch API Polyfill (simplified version for basic POST requests)
        if (typeof window.fetch === 'undefined') {
            window.fetch = function(url, options) {
                options = options || {};
                var method = (options.method || 'GET').toUpperCase();
                var headers = options.headers || {};
                var body = options.body;
                
                return new Promise(function(resolve, reject) {
                    var xhr = new XMLHttpRequest();
                    xhr.open(method, url, true);
                    
                    // Set headers
                    for (var header in headers) {
                        if (headers.hasOwnProperty(header)) {
                            xhr.setRequestHeader(header, headers[header]);
                        }
                    }
                    
                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === 4) {
                            if (xhr.status >= 200 && xhr.status < 300) {
                                var response = {
                                    ok: true,
                                    status: xhr.status,
                                    statusText: xhr.statusText,
                                    url: url,
                                    type: 'basic',
                                    text: function() {
                                        return Promise.resolve(xhr.responseText);
                                    },
                                    json: function() {
                                        try {
                                            return Promise.resolve(JSON.parse(xhr.responseText));
                                        } catch (e) {
                                            return Promise.reject(e);
                                        }
                                    }
                                };
                                resolve(response);
                            } else {
                                reject(new Error('Network request failed with status ' + xhr.status));
                            }
                        }
                    };
                    
                    xhr.onerror = function() {
                        reject(new Error('Network request failed'));
                    };
                    
                    if (body) {
                        xhr.send(body);
                    } else {
                        xhr.send();
                    }
                });
            };
        }
        
        /**
         * ============================================
         * è§¦æ‘¸äº‹ä»¶ä¼˜åŒ– - é˜²æ­¢åŒå‡»å’Œæ„å¤–è§¦å‘
         * ============================================
         */
        var lastTouchTime = 0;
        var touchDelay = 300; // 300ms å»¶è¿Ÿé˜²æ­¢åŒå‡»
        
        function preventDoubleTap(element) {
            if (!element) return;
            
            var lastClickTime = 0;
            var clickDelay = 300;
            
            element.addEventListener('click', function(e) {
                var currentTime = new Date().getTime();
                if (currentTime - lastClickTime < clickDelay) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
                lastClickTime = currentTime;
            }, false);
            
            // è§¦æ‘¸è®¾å¤‡ä¼˜åŒ–
            if ('ontouchstart' in window) {
                var lastTouchStart = 0;
                element.addEventListener('touchstart', function(e) {
                    var currentTime = new Date().getTime();
                    if (currentTime - lastTouchStart < touchDelay) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                    lastTouchStart = currentTime;
                }, false);
            }
        }
        
        /**
         * ============================================
         * Google Sheets é…ç½®
         * ============================================
         * Google Apps Script Web App URL
         */
        var GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyJoQ3FQE-XzU3X-Lp3-XEBuyfj6E5GljvP_j3-geymMcxzTfTKIuLOQ-daGrQ_ub9rlw/exec';
        
        /**
         * æ˜¯å¦å¯ç”¨ Google Sheets æäº¤
         * å¦‚æœè®¾ç½®ä¸º falseï¼Œæ•°æ®åªä¼šä¿å­˜åˆ° localStorage
         */
        var ENABLE_GOOGLE_SHEETS = GOOGLE_APPS_SCRIPT_URL.length > 0;
        
        /**
         * è°ƒè¯•æ¨¡å¼ï¼šåœ¨æ§åˆ¶å°è¾“å‡ºè¯¦ç»†ä¿¡æ¯
         */
        var DEBUG_MODE = true;

        /**
         * ============================================
         * éšæœºå›¾ç‰‡é€‰æ‹©åŠŸèƒ½
         * 50/50 æ¦‚ç‡é€‰æ‹© comfort-zone-v1.jpg æˆ– comfort-zone-v2.jpg
         * ============================================
         */
        var selectedImageVersion = null;

        function selectRandomImage() {
            try {
                var imageElement = document.getElementById('renderingImage');
                if (!imageElement) {
                    if (DEBUG_MODE) {
                        console.error('âŒ Image element not found!');
                    }
                    return;
                }
                
                var random = Math.random();
                // 50/50 æ¦‚ç‡é€‰æ‹©
                selectedImageVersion = random < 0.5 ? 'comfort-zone-v1' : 'comfort-zone-v2';
                
                // ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆé€‚ç”¨äº GitHub Pagesï¼‰
                var imagePath = './images/' + selectedImageVersion + '.jpg';
                
                if (DEBUG_MODE) {
                    console.log('ğŸ–¼ï¸ Loading image:', imagePath);
                }
                
                imageElement.src = imagePath;
                
                // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºå ä½ç¬¦
                imageElement.onerror = function() {
                    if (DEBUG_MODE) {
                        console.warn('âš ï¸ Image failed to load:', imagePath);
                    }
                    this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNjAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2YwZjhmOCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiMwMDhCOEIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5QbGVhc2UgcGxhY2UgY29tZm9ydC16b25lIHJlbmRlcmluZyBpbWFnZSBob3JlPC90ZXh0Pjwvc3Zn+';
                    this.alt = 'Placeholder: Please add ' + selectedImageVersion + '.jpg to the images folder';
                };
                
                imageElement.onload = function() {
                    if (DEBUG_MODE) {
                        console.log('âœ… Image loaded successfully:', imagePath);
                    }
                };
            } catch (error) {
                console.error('âŒ Error in selectRandomImage:', error);
            }
        }

        /**
         * ============================================
         * è°ƒæŸ¥é—®é¢˜é…ç½®
         * ============================================
         */
        var surveyConfig = {
            overallSatisfaction: [
                'Very Dissatisfied',
                'Dissatisfied',
                'Neutral',
                'Satisfied',
                'Very Satisfied'
            ],
            amenities: [
                'Equipment quality and variety',
                'Cleanliness and maintenance',
                'Locker rooms and shower facilities',
                'Class offerings and personal training',
                'Social spaces and common areas',
                'Staff and trainers',
                'Overall atmosphere and environment'
            ],
            topValuedFactors: [
                'Availability of personal trainers or classes',
                'Ventilation, lighting, and air conditioning',
                'Locker rooms and shower facilities',
                'Variety and quality of equipment',
                'Availability of seating area',
                'Cleanliness and maintenance',
                'Commuting convenience',
                'Other'
            ],
            comfortZoneAmenities: [
                'Comfortable seating (e.g., couches and lounge chairs)',
                'Vending machine',
                'Information / achievement board',
                'Interaction & networking opportunities',
                'Books / magazines',
                'Charging ports',
                'Plants and natural elements',
                'Places to hang coats and change shoes',
                'Other'
            ],
            usageFrequency: [
                'Rarely (once a month or less)',
                'Sometimes (2-3 times per month)',
                'Often (1-2 times per week)'
            ],
            wellnessStatements: [
                'I have balanced exercise, nutrition, and rest patterns',
                'I maintain regular practices that help me stay centered and connected',
                'I actively engage in learning to keep my mind focused and alert',
                'I have consistent, genuine connections with others that make me feel supported',
                'I am aware of my feelings and reflect on my emotions as part of staying balanced',
                'My current work environment aligns with my skills and values'
            ],
            membershipTypes: [
                "I'm not a member yet",
                'Pay-per-use / Day rate',
                'Monthly',
                '6 Month',
                'Annual',
                'Other (Please specify)'
            ],
            membershipDurations: [
                'Less than 6 months',
                '6 Months to 1 Year',
                '1-3 Years',
                '3-5 Years',
                '5+ Years'
            ],
            membershipImpactRenewal: [
                'Much less likely to renew',
                'Somewhat less likely to renew',
                'No impact on my decision',
                'Somewhat more likely to renew',
                'Much more likely to renew'
            ],
            membershipImpactJoin: [
                'Much less likely to join',
                'Somewhat less likely to join',
                'No impact on my decision',
                'Somewhat more likely to join',
                'Much more likely to join'
            ],
            ageGroups: [
                '18-24',
                '25-34',
                '35-45',
                '45-54',
                '55-64',
                '65-74',
                '75+'
            ],
            genderOptions: [
                'M',
                'F',
                'Transgender',
                'Prefer not to respond',
                'Prefer to self-describe'
            ]
        };

        /**
         * æ¸²æŸ“å•é€‰æŒ‰é’®ç»„ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
         */
        function renderRadioGroup(groupId, options) {
            try {
                var container = document.getElementById(groupId);
                if (!container) {
                    console.error('âŒ Container not found:', groupId);
                    return;
                }
                
                if (!options || !Array.isArray(options) || options.length === 0) {
                    console.warn('âš ï¸ No options provided for:', groupId);
                    return;
                }
                
                // å¼ºåˆ¶æ˜¾ç¤ºå®¹å™¨
                container.style.display = 'flex';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                
                container.innerHTML = '';
                
                console.log('ğŸ“ Rendering radio group:', groupId, 'with', options.length, 'options');

                options.forEach((option, index) => {
                    var radioDiv = document.createElement('div');
                    radioDiv.className = 'radio-option';

                    var radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.id = groupId + '_' + index;
                    radio.name = groupId.replace('_group', '');
                    radio.value = option;
                    radio.setAttribute('aria-label', option); // æ— éšœç¢æ”¯æŒ

                    var label = document.createElement('label');
                    label.htmlFor = groupId + '_' + index;
                    label.textContent = option;
                    label.setAttribute('aria-label', option);

                    // ç¡®ä¿æ•´ä¸ª div å¯ç‚¹å‡»
                    radioDiv.addEventListener('click', function(e) {
                        if (e.target !== radio) {
                            radio.click();
                        }
                    });

                    radioDiv.appendChild(radio);
                    radioDiv.appendChild(label);

                    // å¤„ç† "Other" æˆ– "self-describe" é€‰é¡¹
                    if (option === 'Other' || option.includes('Other') || option.includes('self-describe')) {
                        var otherInput = document.createElement('input');
                        otherInput.type = 'text';
                        otherInput.id = groupId + '_other';
                        otherInput.name = groupId.replace('_group', '') + '_other';
                        otherInput.className = 'other-input';
                        otherInput.placeholder = 'Please specify...';
                        otherInput.style.display = 'none';
                        radioDiv.appendChild(otherInput);

                        radio.addEventListener('change', function() {
                            otherInput.style.display = this.checked ? 'block' : 'none';
                        });
                    }

                    container.appendChild(radioDiv);
                });
                
                if (DEBUG_MODE) {
                    console.log('âœ… Rendered radio group:', groupId, 'with', options.length, 'options');
                }
            } catch (error) {
                console.error('âŒ Error rendering radio group:', groupId, error);
            }
        }

        /**
         * æ¸²æŸ“å¤é€‰æ¡†ç»„ï¼ˆå¸¦é™åˆ¶ï¼Œå¸¦é”™è¯¯å¤„ç†ï¼‰
         */
        function renderCheckboxGroup(groupId, options, maxSelections) {
            try {
                var container = document.getElementById(groupId);
                if (!container) {
                    console.error('âŒ Container not found:', groupId);
                    return;
                }
                
                if (!options || !Array.isArray(options) || options.length === 0) {
                    console.warn('âš ï¸ No options provided for:', groupId);
                    return;
                }
                
                // å¼ºåˆ¶æ˜¾ç¤ºå®¹å™¨
                container.style.display = 'flex';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                
                container.innerHTML = '';
                
                console.log('ğŸ“ Rendering checkbox group:', groupId, 'with', options.length, 'options');

                options.forEach((option, index) => {
                    var checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'checkbox-option';
                    checkboxDiv.setAttribute('data-value', option);

                    var checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = groupId + '_' + index;
                    checkbox.name = groupId.replace('_group', '');
                    checkbox.value = option;
                    checkbox.setAttribute('aria-label', option); // æ— éšœç¢æ”¯æŒ
                    checkbox.addEventListener('change', function() {
                        enforceCheckboxLimit(groupId, maxSelections);
                    });

                    var label = document.createElement('label');
                    label.htmlFor = groupId + '_' + index;
                    label.textContent = option;
                    label.setAttribute('aria-label', option);

                    // ç¡®ä¿æ•´ä¸ª div å¯ç‚¹å‡»
                    checkboxDiv.addEventListener('click', function(e) {
                        if (e.target !== checkbox) {
                            checkbox.click();
                        }
                    });

                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);

                    // å¤„ç† "Other" é€‰é¡¹
                    if (option === 'Other' || option.includes('Other')) {
                        var otherInput = document.createElement('input');
                        otherInput.type = 'text';
                        otherInput.id = groupId + '_other';
                        otherInput.name = groupId.replace('_group', '') + '_other';
                        otherInput.className = 'other-input';
                        otherInput.placeholder = 'Please specify...';
                        otherInput.style.display = 'none';
                        checkboxDiv.appendChild(otherInput);

                        checkbox.addEventListener('change', function() {
                            otherInput.style.display = this.checked ? 'block' : 'none';
                        });
                    }

                    container.appendChild(checkboxDiv);
                });

                updateChoiceLimit(groupId.replace('_group', '_limit'), groupId, maxSelections);
                
                if (DEBUG_MODE) {
                    console.log('âœ… Rendered checkbox group:', groupId, 'with', options.length, 'options');
                }
            } catch (error) {
                console.error('âŒ Error rendering checkbox group:', groupId, error);
            }
        }

        /**
         * å¼ºåˆ¶æ‰§è¡Œå¤é€‰æ¡†é™åˆ¶
         */
        function enforceCheckboxLimit(groupId, maxSelections) {
            var checkboxes = document.querySelectorAll('#' + groupId + ' input[type="checkbox"]:checked');
            var allCheckboxes = document.querySelectorAll('#' + groupId + ' input[type="checkbox"]');

            if (checkboxes.length >= maxSelections) {
                allCheckboxes.forEach(cb => {
                    if (!cb.checked) {
                        cb.closest('.checkbox-option').classList.add('disabled');
                    }
                });
            } else {
                allCheckboxes.forEach(cb => {
                    cb.closest('.checkbox-option').classList.remove('disabled');
                });
            }

            updateChoiceLimit(groupId.replace('_group', '_limit'), groupId, maxSelections);
        }

        /**
         * æ›´æ–°é€‰æ‹©é™åˆ¶æç¤º
         */
        function updateChoiceLimit(limitId, groupId, maxSelections) {
            var limitElement = document.getElementById(limitId);
            var checkedCount = document.querySelectorAll('#' + groupId + ' input[type="checkbox"]:checked').length;

            if (checkedCount > 0) {
                limitElement.textContent = checkedCount + '/' + maxSelections + ' selected';
                if (checkedCount > maxSelections) {
                    limitElement.classList.add('error');
                    limitElement.textContent = 'Please select only up to ' + maxSelections + ' options';
                } else {
                    limitElement.classList.remove('error');
                }
            } else {
                limitElement.textContent = '';
            }
        }

        /**
         * æ¸²æŸ“æ»¡æ„åº¦è¯„åˆ†ç½‘æ ¼
         */
        function renderSatisfactionGrid() {
            var container = document.getElementById('amenity_satisfaction_grid');
            container.innerHTML = '';

            surveyConfig.amenities.forEach((amenity, amenityIndex) => {
                var row = document.createElement('div');
                row.className = 'satisfaction-row';

                var label = document.createElement('div');
                label.className = 'satisfaction-label';
                label.textContent = amenity;
                row.appendChild(label);

                var scaleContainer = document.createElement('div');
                scaleContainer.className = 'satisfaction-scale';

                for (var i = 1; i <= 5; i++) {
                    var scaleItem = document.createElement('div');
                    scaleItem.className = 'satisfaction-scale-item';

                    var radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.id = 'amenity_' + amenityIndex + '_' + i;
                    radio.name = 'amenity_' + amenityIndex;
                    radio.value = i;
                    radio.required = true;

                    var label = document.createElement('label');
                    label.htmlFor = 'amenity_' + amenityIndex + '_' + i;
                    label.textContent = i;

                    scaleItem.appendChild(radio);
                    scaleItem.appendChild(label);
                    scaleContainer.appendChild(scaleItem);
                }

                row.appendChild(scaleContainer);
                container.appendChild(row);
            });
        }

        /**
         * æ¸²æŸ“Likerté‡è¡¨
         */
        function renderLikertScale(statementId, statementText) {
            var container = document.getElementById('wellness_statements');
            var statementDiv = document.createElement('div');
            statementDiv.className = 'form-group question-container';
            statementDiv.setAttribute('data-question-id', statementId);

            var label = document.createElement('label');
            label.className = 'question-label';
            label.textContent = statementText;
            var requiredMarker = document.createElement('span');
            requiredMarker.className = 'required-marker';
            requiredMarker.textContent = '*';
            label.appendChild(requiredMarker);
            statementDiv.appendChild(label);

            var likertContainer = document.createElement('div');
            likertContainer.className = 'likert-scale';

            var labelsDiv = document.createElement('div');
            labelsDiv.className = 'likert-labels';
            labelsDiv.innerHTML = '<span>Disagree</span><span>Agree</span>';
            likertContainer.appendChild(labelsDiv);

            var optionsDiv = document.createElement('div');
            optionsDiv.className = 'likert-options';

            var scaleLabels = ['1', '2', '3', '4', '5'];
            scaleLabels.forEach((value, index) => {
                var optionDiv = document.createElement('div');
                optionDiv.className = 'likert-option';

                var radio = document.createElement('input');
                radio.type = 'radio';
                radio.id = statementId + '_' + index;
                radio.name = statementId;
                radio.value = value;

                var label = document.createElement('label');
                label.htmlFor = statementId + '_' + index;
                label.textContent = value;

                optionDiv.appendChild(radio);
                optionDiv.appendChild(label);
                optionsDiv.appendChild(optionDiv);
            });

            likertContainer.appendChild(optionsDiv);
            statementDiv.appendChild(likertContainer);

            var errorMsg = document.createElement('div');
            errorMsg.className = 'error-message';
            errorMsg.textContent = 'Please select an option';
            statementDiv.appendChild(errorMsg);

            container.appendChild(statementDiv);
        }

        /**
         * æ˜¾ç¤º/éšè—æ¡ä»¶æ€§é—®é¢˜
         */
        function showHideConditional() {
            // Q5.2: Membership Duration - åªåœ¨éä¼šå‘˜æ—¶æ˜¾ç¤º
            var membershipType = document.querySelector('input[name="membership_type"]:checked');
            var membershipDurationSection = document.getElementById('membership_duration_section');
            
            if (membershipType && membershipType.value !== "I'm not a member yet") {
                membershipDurationSection.classList.add('show');
            } else {
                membershipDurationSection.classList.remove('show');
                document.querySelectorAll('input[name="membership_duration"]').forEach(r => r.checked = false);
            }

            // Section 6: æ ¹æ®ä¼šå‘˜ç±»å‹æ˜¾ç¤ºä¸åŒç‰ˆæœ¬
            var membershipImpactRenewalSection = document.getElementById('membership_impact_renewal_section');
            var membershipImpactJoinSection = document.getElementById('membership_impact_join_section');
            
            if (membershipType) {
                if (membershipType.value === "I'm not a member yet") {
                    membershipImpactJoinSection.classList.add('show');
                    membershipImpactRenewalSection.classList.remove('show');
                    document.querySelectorAll('input[name="membership_impact_renewal"]').forEach(r => r.checked = false);
                } else {
                    membershipImpactRenewalSection.classList.add('show');
                    membershipImpactJoinSection.classList.remove('show');
                    document.querySelectorAll('input[name="membership_impact_join"]').forEach(r => r.checked = false);
                }
            } else {
                membershipImpactRenewalSection.classList.remove('show');
                membershipImpactJoinSection.classList.remove('show');
            }
        }

        /**
         * æ’ååŠŸèƒ½å…¨å±€å˜é‡
         */
        var rankedFactors = [];
        var rankedComfortZoneAmenities = [];
        var draggedElement = null;

        /**
         * æ¸²æŸ“æ’åå¤é€‰æ¡†ç»„ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
         */
        function renderRankingCheckboxGroup(groupId, options, maxSelections) {
            try {
                var container = document.getElementById(groupId);
                if (!container) {
                    console.error('âŒ Container not found:', groupId);
                    return;
                }
                
                if (!options || !Array.isArray(options) || options.length === 0) {
                    console.warn('âš ï¸ No options provided for:', groupId);
                    return;
                }
                
                // å¼ºåˆ¶æ˜¾ç¤ºå®¹å™¨
                container.style.display = 'flex';
                container.style.visibility = 'visible';
                container.style.opacity = '1';
                
                container.innerHTML = '';
                
                console.log('ğŸ“ Rendering ranking checkbox group:', groupId, 'with', options.length, 'options');

                options.forEach((option, index) => {
                    var checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'checkbox-option';
                    checkboxDiv.setAttribute('data-value', option);

                    var checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = groupId + '_' + index;
                    checkbox.name = 'ranked_factors';
                    checkbox.value = option;
                    checkbox.setAttribute('aria-label', option);
                    checkbox.addEventListener('change', function() {
                        handleRankingChange(option, this.checked);
                    });

                    var label = document.createElement('label');
                    label.htmlFor = groupId + '_' + index;
                    label.textContent = option;
                    label.setAttribute('aria-label', option);

                    // ç¡®ä¿æ•´ä¸ª div å¯ç‚¹å‡»
                    checkboxDiv.addEventListener('click', function(e) {
                        if (e.target !== checkbox) {
                            checkbox.click();
                        }
                    });

                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);

                    // å¤„ç† "Other" é€‰é¡¹
                    if (option === 'Other' || option.includes('Other')) {
                        var otherInput = document.createElement('input');
                        otherInput.type = 'text';
                        otherInput.id = groupId + '_other';
                        otherInput.name = 'ranked_factors_other';
                        otherInput.className = 'other-input';
                        otherInput.placeholder = 'Please specify...';
                        otherInput.style.display = 'none';
                        checkboxDiv.appendChild(otherInput);

                        checkbox.addEventListener('change', function() {
                            otherInput.style.display = this.checked ? 'block' : 'none';
                        });
                    }

                    container.appendChild(checkboxDiv);
                });

                updateRankedList();
                
                if (DEBUG_MODE) {
                    console.log('âœ… Rendered ranking checkbox group:', groupId, 'with', options.length, 'options');
                }
            } catch (error) {
                console.error('âŒ Error rendering ranking checkbox group:', groupId, error);
            }
        }

        /**
         * å¤„ç†æ’åå˜åŒ–
         */
        function handleRankingChange(factor, isChecked) {
            if (isChecked) {
                if (rankedFactors.length >= 3) {
                    // å¦‚æœå·²ç»æœ‰3ä¸ªï¼Œç§»é™¤æœ€åä¸€ä¸ª
                    var lastFactor = rankedFactors.pop();
                    var checkbox = Array.from(document.querySelectorAll('input[name="ranked_factors"]'))
                        .find(cb => cb.value === lastFactor);
                    if (checkbox) checkbox.checked = false;
                }
                rankedFactors.push(factor);
            } else {
                rankedFactors = rankedFactors.filter(f => f !== factor);
            }
            updateRankedList();
            enforceRankingLimits();
        }

        /**
         * æ›´æ–°æ’ååˆ—è¡¨æ˜¾ç¤º
         */
        function updateRankedList() {
            var rankedList = document.getElementById('ranked_list');
            rankedList.innerHTML = '';

            if (rankedFactors.length === 0) {
                rankedList.innerHTML = '<div class="ranked-placeholder">Select factors above to rank them</div>';
                return;
            }

            rankedFactors.forEach((factor, index) => {
                var rankedItem = document.createElement('div');
                rankedItem.className = 'ranked-item';
                rankedItem.draggable = true;
                rankedItem.dataset.factor = factor;
                rankedItem.dataset.index = index;

                var rankNumber = document.createElement('div');
                rankNumber.className = 'rank-number';
                rankNumber.textContent = index + 1;

                var itemText = document.createElement('div');
                itemText.className = 'ranked-item-text';
                itemText.textContent = factor;

                var removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.className = 'rank-remove-btn';
                removeBtn.innerHTML = 'Ã—';
                removeBtn.addEventListener('click', function() {
                    removeFromRanking(factor);
                });

                rankedItem.appendChild(rankNumber);
                rankedItem.appendChild(itemText);
                rankedItem.appendChild(removeBtn);

                // æ‹–æ‹½äº‹ä»¶ï¼ˆæ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸ï¼‰
                rankedItem.addEventListener('dragstart', handleDragStart);
                rankedItem.addEventListener('dragover', handleDragOver);
                rankedItem.addEventListener('drop', handleDrop);
                rankedItem.addEventListener('dragend', handleDragEnd);
                
                // è§¦æ‘¸äº‹ä»¶æ”¯æŒï¼ˆå¹³æ¿å’Œç§»åŠ¨è®¾å¤‡ï¼‰
                var touchStartY = 0;
                var touchStartElement = null;
                
                rankedItem.addEventListener('touchstart', function(e) {
                    touchStartY = e.touches[0].clientY;
                    touchStartElement = this;
                    this.classList.add('dragging');
                    e.preventDefault();
                }, { passive: false });
                
                rankedItem.addEventListener('touchmove', function(e) {
                    if (!touchStartElement) return;
                    e.preventDefault();
                    
                    var touchY = e.touches[0].clientY;
                    var allItems = Array.from(document.querySelectorAll('.ranked-item'));
                    var currentIndex = allItems.indexOf(this);
                    
                    // æ‰¾åˆ°è§¦æ‘¸ç‚¹ä¸‹æ–¹çš„å…ƒç´ 
                    var targetElement = null;
                    for (var item of allItems) {
                        var rect = item.getBoundingClientRect();
                        if (touchY >= rect.top && touchY <= rect.bottom && item !== this) {
                            targetElement = item;
                            break;
                        }
                    }
                    
                    if (targetElement && targetElement !== touchStartElement) {
                        var targetIndex = allItems.indexOf(targetElement);
                        var startIndex = allItems.indexOf(touchStartElement);
                        
                        if (startIndex < targetIndex) {
                            targetElement.parentNode.insertBefore(touchStartElement, targetElement.nextSibling);
                        } else {
                            targetElement.parentNode.insertBefore(touchStartElement, targetElement);
                        }
                    }
                }, { passive: false });
                
                rankedItem.addEventListener('touchend', function(e) {
                    if (touchStartElement) {
                        touchStartElement.classList.remove('dragging');
                        
                        // æ›´æ–°æ’åæ•°ç»„
                        var rankedItems = Array.from(document.querySelectorAll('.ranked-item'));
                        rankedFactors = rankedItems.map(item => item.dataset.factor);
                        updateRankNumbers();
                        
                        touchStartElement = null;
                    }
                });

                rankedList.appendChild(rankedItem);
            });

            // æ›´æ–°æ’åæ•°å­—
            updateRankNumbers();
        }

        /**
         * æ‹–æ‹½å¼€å§‹
         */
        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        /**
         * æ‹–æ‹½æ‚¬åœ
         */
        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            if (this !== draggedElement) {
                var allItems = Array.from(document.querySelectorAll('.ranked-item'));
                var draggedIndex = allItems.indexOf(draggedElement);
                var targetIndex = allItems.indexOf(this);

                if (draggedIndex < targetIndex) {
                    this.parentNode.insertBefore(draggedElement, this.nextSibling);
                } else {
                    this.parentNode.insertBefore(draggedElement, this);
                }
            }
            return false;
        }

        /**
         * æ‹–æ‹½æ”¾ç½®
         */
        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            return false;
        }

        /**
         * æ‹–æ‹½ç»“æŸ
         */
        function handleDragEnd(e) {
            this.classList.remove('dragging');
            
            // æ›´æ–°æ’åæ•°ç»„
            var rankedItems = Array.from(document.querySelectorAll('.ranked-item'));
            rankedFactors = rankedItems.map(item => item.dataset.factor);
            
            updateRankNumbers();
        }

        /**
         * æ›´æ–°æ’åæ•°å­—
         */
        function updateRankNumbers() {
            var rankedItems = document.querySelectorAll('.ranked-item');
            rankedItems.forEach((item, index) => {
                var rankNumber = item.querySelector('.rank-number');
                if (rankNumber) {
                    rankNumber.textContent = index + 1;
                }
            });
        }

        /**
         * ä»æ’åä¸­ç§»é™¤
         */
        function removeFromRanking(factor) {
            rankedFactors = rankedFactors.filter(f => f !== factor);
            var checkbox = Array.from(document.querySelectorAll('input[name="ranked_factors"]'))
                .find(cb => cb.value === factor);
            if (checkbox) checkbox.checked = false;
            updateRankedList();
            enforceRankingLimits();
        }

        /**
         * å¼ºåˆ¶æ‰§è¡Œæ’åé™åˆ¶
         */
        function enforceRankingLimits() {
            var checkboxes = document.querySelectorAll('input[name="ranked_factors"]');
            var checkedCount = rankedFactors.length;

            checkboxes.forEach(cb => {
                var optionDiv = cb.closest('.checkbox-option');
                if (checkedCount >= 3 && !cb.checked) {
                    optionDiv.classList.add('disabled');
                } else {
                    optionDiv.classList.remove('disabled');
                }
            });
        }

        /**
         * æ¸²æŸ“èˆ’é€‚åŒºè®¾æ–½æ’åå¤é€‰æ¡†ç»„ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
         */
        function renderComfortZoneRankingCheckboxGroup(groupId, options, maxSelections, listId, containerId) {
            try {
                var container = document.getElementById(groupId);
                if (!container) {
                    if (DEBUG_MODE) {
                        console.error('âŒ Container not found:', groupId);
                    }
                    return;
                }
                
                if (!options || !Array.isArray(options) || options.length === 0) {
                    if (DEBUG_MODE) {
                        console.warn('âš ï¸ No options provided for:', groupId);
                    }
                    return;
                }
                
                container.innerHTML = '';

                options.forEach((option, index) => {
                    var checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'checkbox-option';
                    checkboxDiv.setAttribute('data-value', option);

                    var checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = groupId + '_' + index;
                    checkbox.name = 'comfort_zone_amenities_ranked';
                    checkbox.value = option;
                    checkbox.setAttribute('aria-label', option);
                    checkbox.addEventListener('change', function() {
                        handleComfortZoneRankingChange(option, this.checked, listId, containerId);
                    });

                    var label = document.createElement('label');
                    label.htmlFor = groupId + '_' + index;
                    label.textContent = option;
                    label.setAttribute('aria-label', option);

                    // ç¡®ä¿æ•´ä¸ª div å¯ç‚¹å‡»
                    checkboxDiv.addEventListener('click', function(e) {
                        if (e.target !== checkbox) {
                            checkbox.click();
                        }
                    });

                    checkboxDiv.appendChild(checkbox);
                    checkboxDiv.appendChild(label);

                    // å¤„ç† "Other" é€‰é¡¹
                    if (option === 'Other' || option.includes('Other')) {
                        var otherInput = document.createElement('input');
                        otherInput.type = 'text';
                        otherInput.id = groupId + '_other';
                        otherInput.name = 'comfort_zone_amenities_ranked_other';
                        otherInput.className = 'other-input';
                        otherInput.placeholder = 'Please specify...';
                        otherInput.style.display = 'none';
                        checkboxDiv.appendChild(otherInput);

                        checkbox.addEventListener('change', function() {
                            otherInput.style.display = this.checked ? 'block' : 'none';
                        });
                    }

                    container.appendChild(checkboxDiv);
                });

                updateComfortZoneRankedList(listId);
                
                if (DEBUG_MODE) {
                    console.log('âœ… Rendered comfort zone ranking checkbox group:', groupId, 'with', options.length, 'options');
                }
            } catch (error) {
                console.error('âŒ Error rendering comfort zone ranking checkbox group:', groupId, error);
            }
        }

        /**
         * å¤„ç†èˆ’é€‚åŒºè®¾æ–½æ’åå˜åŒ–
         */
        function handleComfortZoneRankingChange(amenity, isChecked, listId, containerId) {
            if (isChecked) {
                if (rankedComfortZoneAmenities.length >= 3) {
                    var lastAmenity = rankedComfortZoneAmenities.pop();
                    var checkbox = Array.from(document.querySelectorAll('input[name="comfort_zone_amenities_ranked"]'))
                        .find(cb => cb.value === lastAmenity);
                    if (checkbox) checkbox.checked = false;
                }
                rankedComfortZoneAmenities.push(amenity);
            } else {
                rankedComfortZoneAmenities = rankedComfortZoneAmenities.filter(a => a !== amenity);
            }
            updateComfortZoneRankedList(listId);
            enforceComfortZoneRankingLimits(containerId);
        }

        /**
         * æ›´æ–°èˆ’é€‚åŒºè®¾æ–½æ’ååˆ—è¡¨æ˜¾ç¤º
         */
        function updateComfortZoneRankedList(listId) {
            var rankedList = document.getElementById(listId);
            if (!rankedList) return;
            
            rankedList.innerHTML = '';

            if (rankedComfortZoneAmenities.length === 0) {
                rankedList.innerHTML = '<div class="ranked-placeholder">Select elements above to rank them</div>';
                return;
            }

            rankedComfortZoneAmenities.forEach((amenity, index) => {
                var rankedItem = document.createElement('div');
                rankedItem.className = 'ranked-item';
                rankedItem.draggable = true;
                rankedItem.dataset.amenity = amenity;
                rankedItem.dataset.index = index;

                var rankNumber = document.createElement('div');
                rankNumber.className = 'rank-number';
                rankNumber.textContent = index + 1;

                var itemText = document.createElement('div');
                itemText.className = 'ranked-item-text';
                itemText.textContent = amenity;

                var removeBtn = document.createElement('button');
                removeBtn.type = 'button';
                removeBtn.className = 'rank-remove-btn';
                removeBtn.innerHTML = 'Ã—';
                removeBtn.addEventListener('click', () => {
                    removeFromComfortZoneRanking(amenity, listId);
                });

                rankedItem.appendChild(rankNumber);
                rankedItem.appendChild(itemText);
                rankedItem.appendChild(removeBtn);

                // æ‹–æ‹½äº‹ä»¶ï¼ˆæ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸ï¼‰
                rankedItem.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.innerHTML);
                });

                rankedItem.addEventListener('dragover', function(e) {
                    if (e.preventDefault) e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    if (this !== draggedElement) {
                        var allItems = Array.from(document.querySelectorAll('#' + listId + ' .ranked-item'));
                        var draggedIndex = allItems.indexOf(draggedElement);
                        var targetIndex = allItems.indexOf(this);
                        if (draggedIndex < targetIndex) {
                            this.parentNode.insertBefore(draggedElement, this.nextSibling);
                        } else {
                            this.parentNode.insertBefore(draggedElement, this);
                        }
                    }
                    return false;
                });

                rankedItem.addEventListener('drop', function(e) {
                    if (e.stopPropagation) e.stopPropagation();
                    return false;
                });

                rankedItem.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    var rankedItems = Array.from(document.querySelectorAll('#' + listId + ' .ranked-item'));
                    rankedComfortZoneAmenities = rankedItems.map(item => item.dataset.amenity);
                    updateComfortZoneRankNumbers(listId);
                });
                
                // è§¦æ‘¸äº‹ä»¶æ”¯æŒï¼ˆå¹³æ¿å’Œç§»åŠ¨è®¾å¤‡ï¼‰
                var touchStartY = 0;
                var touchStartElement = null;
                
                rankedItem.addEventListener('touchstart', function(e) {
                    touchStartY = e.touches[0].clientY;
                    touchStartElement = this;
                    this.classList.add('dragging');
                    e.preventDefault();
                }, { passive: false });
                
                rankedItem.addEventListener('touchmove', function(e) {
                    if (!touchStartElement) return;
                    e.preventDefault();
                    
                    var touchY = e.touches[0].clientY;
                    var allItems = Array.from(document.querySelectorAll('#' + listId + ' .ranked-item'));
                    var currentIndex = allItems.indexOf(this);
                    
                    // æ‰¾åˆ°è§¦æ‘¸ç‚¹ä¸‹æ–¹çš„å…ƒç´ 
                    var targetElement = null;
                    for (var item of allItems) {
                        var rect = item.getBoundingClientRect();
                        if (touchY >= rect.top && touchY <= rect.bottom && item !== this) {
                            targetElement = item;
                            break;
                        }
                    }
                    
                    if (targetElement && targetElement !== touchStartElement) {
                        var targetIndex = allItems.indexOf(targetElement);
                        var startIndex = allItems.indexOf(touchStartElement);
                        
                        if (startIndex < targetIndex) {
                            targetElement.parentNode.insertBefore(touchStartElement, targetElement.nextSibling);
                        } else {
                            targetElement.parentNode.insertBefore(touchStartElement, targetElement);
                        }
                    }
                }, { passive: false });
                
                rankedItem.addEventListener('touchend', function(e) {
                    if (touchStartElement) {
                        touchStartElement.classList.remove('dragging');
                        
                        // æ›´æ–°æ’åæ•°ç»„
                        var rankedItems = Array.from(document.querySelectorAll('#' + listId + ' .ranked-item'));
                        rankedComfortZoneAmenities = rankedItems.map(item => item.dataset.amenity);
                        updateComfortZoneRankNumbers(listId);
                        
                        touchStartElement = null;
                    }
                });

                rankedList.appendChild(rankedItem);
            });

            updateComfortZoneRankNumbers(listId);
        }

        /**
         * æ›´æ–°èˆ’é€‚åŒºè®¾æ–½æ’åæ•°å­—
         */
        function updateComfortZoneRankNumbers(listId) {
            var rankedItems = document.querySelectorAll('#' + listId + ' .ranked-item');
            rankedItems.forEach((item, index) => {
                var rankNumber = item.querySelector('.rank-number');
                if (rankNumber) {
                    rankNumber.textContent = index + 1;
                }
            });
        }

        /**
         * ä»èˆ’é€‚åŒºè®¾æ–½æ’åä¸­ç§»é™¤
         */
        function removeFromComfortZoneRanking(amenity, listId) {
            rankedComfortZoneAmenities = rankedComfortZoneAmenities.filter(a => a !== amenity);
            var checkbox = Array.from(document.querySelectorAll('input[name="comfort_zone_amenities_ranked"]'))
                .find(cb => cb.value === amenity);
            if (checkbox) checkbox.checked = false;
            updateComfortZoneRankedList(listId);
            enforceComfortZoneRankingLimits(listId.replace('_list', '_container'));
        }

        /**
         * å¼ºåˆ¶æ‰§è¡Œèˆ’é€‚åŒºè®¾æ–½æ’åé™åˆ¶
         */
        function enforceComfortZoneRankingLimits(containerId) {
            var checkboxes = document.querySelectorAll('input[name="comfort_zone_amenities_ranked"]');
            var checkedCount = rankedComfortZoneAmenities.length;

            checkboxes.forEach(cb => {
                var optionDiv = cb.closest('.checkbox-option');
                if (checkedCount >= 3 && !cb.checked) {
                    optionDiv.classList.add('disabled');
                } else {
                    optionDiv.classList.remove('disabled');
                }
            });
        }

        /**
         * æ¸²æŸ“æ‰€æœ‰é—®é¢˜ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
         */
        function renderAllQuestions() {
            try {
                if (DEBUG_MODE) {
                    console.log('ğŸ“ Starting to render questions...');
                }
                
                // Section 1
                renderRadioGroup('overall_satisfaction_group', surveyConfig.overallSatisfaction);
                renderRankingCheckboxGroup('ranked_factors_group', surveyConfig.topValuedFactors, 3);

                // Section 3
                renderComfortZoneRankingCheckboxGroup('comfort_zone_amenities_ranked_group', surveyConfig.comfortZoneAmenities, 3, 'comfort_zone_amenities_ranked_list', 'comfort_zone_amenities_ranked_container');
                renderRadioGroup('usage_frequency_group', surveyConfig.usageFrequency);
                renderRadioGroup('membership_type_group', surveyConfig.membershipTypes);
                renderRadioGroup('membership_duration_group', surveyConfig.membershipDurations);
                renderRadioGroup('membership_impact_renewal_group', surveyConfig.membershipImpactRenewal);
                renderRadioGroup('membership_impact_join_group', surveyConfig.membershipImpactJoin);

                // Section 4
                surveyConfig.wellnessStatements.forEach((statement, index) => {
                    renderLikertScale('wellness_q' + (index + 1), statement);
                });

                // Section 5 (é‡å¤ï¼Œå¯èƒ½æ˜¯é”™è¯¯ï¼Œä½†ä¿ç•™ä»¥ä¿æŒå…¼å®¹æ€§)
                renderRadioGroup('membership_type_group', surveyConfig.membershipTypes);
                renderRadioGroup('membership_duration_group', surveyConfig.membershipDurations);

                // Section 6 (é‡å¤ï¼Œå¯èƒ½æ˜¯é”™è¯¯ï¼Œä½†ä¿ç•™ä»¥ä¿æŒå…¼å®¹æ€§)
                renderRadioGroup('membership_impact_renewal_group', surveyConfig.membershipImpactRenewal);
                renderRadioGroup('membership_impact_join_group', surveyConfig.membershipImpactJoin);

                // Section 7
                renderRadioGroup('age_group_group', surveyConfig.ageGroups);
                renderRadioGroup('gender_group', surveyConfig.genderOptions);

                // ç›‘å¬å˜åŒ–ä»¥æ›´æ–°æ¡ä»¶æ€§é—®é¢˜
                var membershipTypeRadios = document.querySelectorAll('input[name="membership_type"]');
                if (membershipTypeRadios.length > 0) {
                    membershipTypeRadios.forEach(radio => {
                        radio.addEventListener('change', showHideConditional);
                    });
                } else {
                    if (DEBUG_MODE) {
                        console.warn('âš ï¸ No membership_type radio buttons found');
                    }
                }
                
                if (DEBUG_MODE) {
                    console.log('âœ… All questions rendered successfully');
                }
            } catch (error) {
                console.error('âŒ Error rendering questions:', error);
                // å³ä½¿å‡ºé”™ï¼Œä¹Ÿå°è¯•æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                var sections = document.querySelectorAll('.section');
                sections.forEach(section => {
                    var errorDiv = document.createElement('div');
                    errorDiv.style.cssText = 'background: #f8d7da; color: #721c24; padding: 15px; margin: 10px; border-radius: 4px;';
                    errorDiv.textContent = 'Error loading questions. Please refresh the page.';
                    section.appendChild(errorDiv);
                });
            }
        }

        /**
         * è®¡ç®—è¿›åº¦
         */
        function calculateProgress() {
            var totalQuestions = document.querySelectorAll('.question-container').length;
            var answeredQuestions = 0;

            document.querySelectorAll('.question-container').forEach(container => {
                var questionId = container.getAttribute('data-question-id');
                var isAnswered = false;

                if (questionId === 'ranked_factors') {
                    // æ£€æŸ¥æ’åï¼šå¿…é¡»æ­£å¥½æœ‰3ä¸ª
                    isAnswered = rankedFactors.length === 3;
                } else if (questionId === 'comfort_zone_amenities_ranked') {
                    // éªŒè¯æ’åï¼šå¿…é¡»æ­£å¥½æœ‰3ä¸ªæ’åè®¾æ–½
                    isAnswered = rankedComfortZoneAmenities.length === 3;
                }

                // æ¡ä»¶æ€§é—®é¢˜åªæœ‰åœ¨æ˜¾ç¤ºæ—¶æ‰è®¡ç®—
                if (container.closest('.conditional-section')) {
                    if (container.closest('.conditional-section').classList.contains('show')) {
                        if (isAnswered) answeredQuestions++;
                    }
                } else {
                    if (isAnswered) answeredQuestions++;
                }
            });

            var progress = Math.round((answeredQuestions / totalQuestions) * 100);
            document.getElementById('progressBar').style.width = progress + '%';
            return progress;
        }

        /**
         * æ»šåŠ¨åŠ¨ç”»ï¼ˆå¸¦é™çº§æ–¹æ¡ˆï¼‰
         */
        function setupScrollAnimation() {
            var sections = document.querySelectorAll('.section');
            
            // æ£€æŸ¥ IntersectionObserver æ˜¯å¦æ”¯æŒ
            if ('IntersectionObserver' in window) {
                try {
                    var observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('visible');
                            }
                        });
                    }, {
                        threshold: 0.1
                    });

                    sections.forEach(section => {
                        observer.observe(section);
                    });
                    
                    if (DEBUG_MODE) {
                        console.log('âœ… IntersectionObserver initialized');
                    }
                } catch (error) {
                    if (DEBUG_MODE) {
                        console.warn('âš ï¸ IntersectionObserver error, using fallback:', error);
                    }
                    // é™çº§ï¼šç›´æ¥æ˜¾ç¤ºæ‰€æœ‰å†…å®¹
                    sections.forEach(section => {
                        section.classList.add('visible');
                    });
                }
            } else {
                // é™çº§ï¼šæµè§ˆå™¨ä¸æ”¯æŒ IntersectionObserverï¼Œç›´æ¥æ˜¾ç¤ºæ‰€æœ‰å†…å®¹
                if (DEBUG_MODE) {
                    console.warn('âš ï¸ IntersectionObserver not supported, showing all sections immediately');
                }
                sections.forEach(section => {
                    section.classList.add('visible');
                });
            }
            
            // ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–ï¼šå»¶è¿Ÿåç¡®ä¿æ‰€æœ‰å†…å®¹å¯è§
            // æŸäº›ç§»åŠ¨æµè§ˆå™¨å¯èƒ½éœ€è¦é¢å¤–æ—¶é—´
            setTimeout(() => {
                sections.forEach(section => {
                    if (!section.classList.contains('visible')) {
                        section.classList.add('visible');
                    }
                });
            }, 500);
        }

        /**
         * éªŒè¯è¡¨å•
         */
        function validateForm() {
            var isValid = true;
            var questions = document.querySelectorAll('.question-container');

            questions.forEach(questionDiv => {
                var questionId = questionDiv.getAttribute('data-question-id');
                var errorMsg = questionDiv.querySelector('.error-message');
                var isFieldValid = false;

                // è·³è¿‡éšè—çš„æ¡ä»¶æ€§é—®é¢˜
                if (questionDiv.closest('.conditional-section') && 
                    !questionDiv.closest('.conditional-section').classList.contains('show')) {
                    return;
                }

                if (questionId === 'ranked_factors') {
                    // éªŒè¯æ’åï¼šå¿…é¡»æ­£å¥½æœ‰3ä¸ªæ’åå› ç´ 
                    isFieldValid = rankedFactors.length === 3;
                } else if (questionId === 'comfort_zone_amenities_ranked') {
                    // éªŒè¯æ’åï¼šå¿…é¡»æ­£å¥½æœ‰3ä¸ªæ’åè®¾æ–½
                    isFieldValid = rankedComfortZoneAmenities.length === 3;
                } else if (questionId.startsWith('wellness_')) {
                    var checked = questionDiv.querySelector('input[name="' + questionId + '"]:checked');
                    isFieldValid = checked !== null;
                } else {
                    var checked = questionDiv.querySelector('input[name="' + questionId + '"]:checked');
                    isFieldValid = checked !== null;
                }

                if (!isFieldValid) {
                    questionDiv.classList.add('error');
                    if (errorMsg) errorMsg.classList.add('show');
                    isValid = false;
                } else {
                    questionDiv.classList.remove('error');
                    if (errorMsg) errorMsg.classList.remove('show');
                }
            });

            return isValid;
        }

        /**
         * æ”¶é›†è¡¨å•æ•°æ®
         */
        function collectFormData() {
            var responses = {};
            var timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19);

            // å›¾ç‰‡ç‰ˆæœ¬
            responses['image_version_shown'] = selectedImageVersion || 'unknown';

            // Section 1: Satisfaction
            var overallSatisfaction = document.querySelector('input[name="overall_satisfaction"]:checked');
            responses['overall_satisfaction'] = overallSatisfaction ? overallSatisfaction.value : '';

            // Section 1: Ranked Factors (æ’åå‰3çš„å› ç´ )
            responses['ranked_factor_1'] = rankedFactors[0] || '';
            responses['ranked_factor_2'] = rankedFactors[1] || '';
            responses['ranked_factor_3'] = rankedFactors[2] || '';
            var rankedOther = document.querySelector('input[name="ranked_factors_other"]')?.value || '';
            if (rankedOther) responses['ranked_factors_other'] = rankedOther;

            // Section 3: Comfort Zone (æ’åå‰3çš„è®¾æ–½)
            responses['comfort_zone_amenity_1'] = rankedComfortZoneAmenities[0] || '';
            responses['comfort_zone_amenity_2'] = rankedComfortZoneAmenities[1] || '';
            responses['comfort_zone_amenity_3'] = rankedComfortZoneAmenities[2] || '';
            var comfortZoneOther = document.querySelector('input[name="comfort_zone_amenities_ranked_other"]')?.value || '';
            if (comfortZoneOther) responses['comfort_zone_other'] = comfortZoneOther;

            var usageFrequency = document.querySelector('input[name="usage_frequency"]:checked');
            responses['usage_frequency'] = usageFrequency ? usageFrequency.value : '';

            // Section 3: Membership (ç§»åˆ°Section 3)
            var membershipType = document.querySelector('input[name="membership_type"]:checked');
            responses['membership_type'] = membershipType ? membershipType.value : '';
            var membershipTypeOther = document.querySelector('input[name="membership_type_other"]')?.value || '';
            if (membershipTypeOther) responses['membership_type_other'] = membershipTypeOther;

            var membershipDuration = document.querySelector('input[name="membership_duration"]:checked');
            responses['membership_duration'] = membershipDuration ? membershipDuration.value : '';

            // Section 3: Membership Impact (ç§»åˆ°Section 3)
            var membershipImpactRenewal = document.querySelector('input[name="membership_impact_renewal"]:checked');
            responses['membership_impact_renewal'] = membershipImpactRenewal ? membershipImpactRenewal.value : '';

            var membershipImpactJoin = document.querySelector('input[name="membership_impact_join"]:checked');
            responses['membership_impact_join'] = membershipImpactJoin ? membershipImpactJoin.value : '';

            // Section 4: Wellness
            surveyConfig.wellnessStatements.forEach((_, index) => {
                var checked = document.querySelector('input[name="wellness_q' + (index + 1) + '"]:checked');
                responses['wellness_q' + (index + 1)] = checked ? checked.value : '';
            });

            // Section 5: Demographics
            var ageGroup = document.querySelector('input[name="age_group"]:checked');
            responses['age_group'] = ageGroup ? ageGroup.value : '';

            var gender = document.querySelector('input[name="gender"]:checked');
            responses['gender'] = gender ? gender.value : '';
            var genderSelfDescribe = document.querySelector('input[name="gender_other"]')?.value || '';
            if (genderSelfDescribe) responses['gender_self_describe'] = genderSelfDescribe;

            return { responses, timestamp };
        }

        /**
         * æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
         */
        function showSuccess(message) {
            var successMsg = document.getElementById('successMessage');
            successMsg.textContent = message;
            successMsg.classList.add('show');
            
            setTimeout(() => {
                successMsg.classList.remove('show');
            }, 5000);
        }

        /**
         * æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
         */
        function showError(message) {
            var errorMsg = document.getElementById('errorMessageBox');
            errorMsg.textContent = message;
            errorMsg.classList.add('show');
            
            setTimeout(() => {
                errorMsg.classList.remove('show');
            }, 5000);
        }

        /**
         * CSVåˆ—å®šä¹‰ï¼ˆä¸æœåŠ¡å™¨ç«¯ä¿æŒä¸€è‡´ï¼‰
         */
        var CSV_COLUMNS = [
            'Timestamp',
            'Overall_Satisfaction',
            'Ranked_Factor_1',
            'Ranked_Factor_2',
            'Ranked_Factor_3',
            'Ranked_Factors_Other',
            'Image_Version_Shown',
            'Comfort_Zone_Amenity_1',
            'Comfort_Zone_Amenity_2',
            'Comfort_Zone_Amenity_3',
            'Comfort_Zone_Other',
            'Usage_Frequency',
            'Membership_Type',
            'Membership_Type_Other',
            'Membership_Duration',
            'Membership_Impact_Renewal',
            'Membership_Impact_Join',
            'Wellness_Q1',
            'Wellness_Q2',
            'Wellness_Q3',
            'Wellness_Q4',
            'Wellness_Q5',
            'Wellness_Q6',
            'Age_Group',
            'Gender',
            'Gender_Self_Describe'
        ];

        /**
         * è½¬ä¹‰CSVå­—æ®µä¸­çš„ç‰¹æ®Šå­—ç¬¦
         */
        function escapeCSVField(field) {
            if (field === null || field === undefined || field === '') {
                return '';
            }
            var stringField = String(field);
            if (stringField.includes(',') || stringField.includes('"') || stringField.includes('\n')) {
                return '"' + stringField.replace(/"/g, '""') + '"';
            }
            return stringField;
        }

        /**
         * å°†å“åº”è½¬æ¢ä¸ºCSVè¡Œ
         */
        function convertToCSVRow(responses, timestamp) {
            var row = [];
            
            CSV_COLUMNS.forEach(column => {
                var value = '';
                
                switch (column) {
                    case 'Timestamp':
                        value = timestamp || new Date().toISOString().replace('T', ' ').substring(0, 19);
                        break;
                    case 'Overall_Satisfaction':
                        value = responses.overall_satisfaction || '';
                        break;
                    case 'Ranked_Factor_1':
                        value = responses.ranked_factor_1 || '';
                        break;
                    case 'Ranked_Factor_2':
                        value = responses.ranked_factor_2 || '';
                        break;
                    case 'Ranked_Factor_3':
                        value = responses.ranked_factor_3 || '';
                        break;
                    case 'Ranked_Factors_Other':
                        value = responses.ranked_factors_other || '';
                        break;
                    case 'Image_Version_Shown':
                        value = responses.image_version_shown || '';
                        break;
                    case 'Comfort_Zone_Amenity_1':
                        value = responses.comfort_zone_amenity_1 || '';
                        break;
                    case 'Comfort_Zone_Amenity_2':
                        value = responses.comfort_zone_amenity_2 || '';
                        break;
                    case 'Comfort_Zone_Amenity_3':
                        value = responses.comfort_zone_amenity_3 || '';
                        break;
                    case 'Comfort_Zone_Other':
                        value = responses.comfort_zone_other || '';
                        break;
                    case 'Usage_Frequency':
                        value = responses.usage_frequency || '';
                        break;
                    case 'Membership_Type':
                        value = responses.membership_type || '';
                        break;
                    case 'Membership_Type_Other':
                        value = responses.membership_type_other || '';
                        break;
                    case 'Membership_Duration':
                        value = responses.membership_duration || '';
                        break;
                    case 'Membership_Impact_Renewal':
                        value = responses.membership_impact_renewal || '';
                        break;
                    case 'Membership_Impact_Join':
                        value = responses.membership_impact_join || '';
                        break;
                    case 'Wellness_Q1':
                    case 'Wellness_Q2':
                    case 'Wellness_Q3':
                    case 'Wellness_Q4':
                    case 'Wellness_Q5':
                    case 'Wellness_Q6':
                        var wellnessNum = column.match(/\d+/)[0];
                        value = responses['wellness_q' + wellnessNum] || '';
                        break;
                    case 'Age_Group':
                        value = responses.age_group || '';
                        break;
                    case 'Gender':
                        value = responses.gender || '';
                        break;
                    case 'Gender_Self_Describe':
                        value = responses.gender_self_describe || '';
                        break;
                    default:
                        value = '';
                }
                
                row.push(escapeCSVField(value));
            });
            
            return row.join(',');
        }

        /**
         * ä¿å­˜å“åº”åˆ° localStorage
         */
        function saveResponseToLocalStorage(responses, timestamp) {
            try {
                var storageKey = 'survey_responses';
                var allResponses = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                var responseData = {
                    timestamp: timestamp || new Date().toISOString().replace('T', ' ').substring(0, 19),
                    responses: responses
                };
                
                allResponses.push(responseData);
                localStorage.setItem(storageKey, JSON.stringify(allResponses));
                
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                return false;
            }
        }

        /**
         * å¯¼å‡ºæ‰€æœ‰å“åº”ä¸º CSV
         */
        function exportToCSV() {
            try {
                var storageKey = 'survey_responses';
                var allResponses = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                if (allResponses.length === 0) {
                    alert('No responses to export.');
                    return;
                }
                
                // åˆ›å»º CSV å†…å®¹
                var csvContent = CSV_COLUMNS.join(',') + '\n';
                
                allResponses.forEach(responseData => {
                    var csvRow = convertToCSVRow(responseData.responses, responseData.timestamp);
                    csvContent += csvRow + '\n';
                });
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                var link = document.createElement('a');
                var url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                var dateStr = new Date().toISOString().split('T')[0];
                link.setAttribute('download', 'survey_responses_' + dateStr + '.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                console.error('Error exporting CSV:', error);
                alert('Error exporting CSV. Please try again.');
            }
        }

        /**
         * æäº¤æ•°æ®åˆ° Google Sheets
         * ä½¿ç”¨ no-cors æ¨¡å¼é¿å… CORS é¢„æ£€è¯·æ±‚é—®é¢˜
         * @param {Object} data - è¦æäº¤çš„æ•°æ®å¯¹è±¡
         * @returns {Promise<Object>} - è¿”å›æäº¤ç»“æœ
         */
        function submitToGoogleSheets(data) {
            return new Promise(function(resolve, reject) {
                if (!ENABLE_GOOGLE_SHEETS || !GOOGLE_APPS_SCRIPT_URL) {
                    reject(new Error('Google Sheets integration is not configured'));
                    return;
                }

                if (DEBUG_MODE) {
                    console.log('ğŸ“¤ Submitting to Google Sheets:', {
                        url: GOOGLE_APPS_SCRIPT_URL,
                        data: data,
                        timestamp: new Date().toISOString()
                    });
                }

                // éªŒè¯ URL æ ¼å¼
                if (GOOGLE_APPS_SCRIPT_URL.indexOf('https://script.google.com/') !== 0) {
                    reject(new Error('Invalid Google Apps Script URL format'));
                    return;
                }

                // ä½¿ç”¨ no-cors æ¨¡å¼é¿å… CORS é¢„æ£€è¯·æ±‚ï¼ˆOPTIONSï¼‰é—®é¢˜
                // æ³¨æ„ï¼šno-cors æ¨¡å¼ä¸‹æ— æ³•è¯»å–å“åº”ï¼Œä½†è¯·æ±‚ä¼šæˆåŠŸå‘é€
                fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // ä½¿ç”¨ no-cors é¿å… CORS é¢„æ£€è¯·æ±‚
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                }).then(function(response) {
                    if (DEBUG_MODE) {
                        console.log('ğŸ“¥ Request sent (no-cors mode, cannot read response):', {
                            type: response.type,
                            url: response.url || GOOGLE_APPS_SCRIPT_URL
                        });
                    }

                    // åœ¨ no-cors æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬æ— æ³•è¯»å–å“åº”
                    // ä½†å¦‚æœæ²¡æœ‰æŠ›å‡ºé”™è¯¯ï¼Œè¯´æ˜è¯·æ±‚å·²ç»å‘é€
                    // å‡è®¾æäº¤æˆåŠŸï¼ˆå¦‚æœ Google Apps Script é…ç½®æ­£ç¡®ï¼Œæ•°æ®åº”è¯¥å·²ç»å†™å…¥ï¼‰
                    resolve({
                        success: true,
                        message: 'Data submitted successfully (no-cors mode - response not readable)',
                        note: 'Request sent. Please verify data in Google Sheets.'
                    });
                }).catch(function(error) {
                    if (DEBUG_MODE) {
                        console.error('âŒ Google Sheets submission error:', error);
                        console.error('Error details:', {
                            name: error.name,
                            message: error.message,
                            stack: error.stack,
                            url: GOOGLE_APPS_SCRIPT_URL
                        });
                    }

                    // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                    var errorMessage = 'Failed to submit to Google Sheets';
                    if (error.message && error.message.indexOf('404') !== -1) {
                        errorMessage += ': URL not found (404). Please check if the Google Apps Script Web App is deployed correctly.';
                    } else if (error.message && (error.message.indexOf('Failed to fetch') !== -1 || error.message.indexOf('Load failed') !== -1)) {
                        errorMessage += ': Network error or CORS issue. Please check: 1) Your internet connection, 2) The Google Apps Script URL is correct, 3) The Web App is deployed with "Who has access: Anyone".';
                    } else {
                        errorMessage += ': ' + error.message;
                    }

                    reject(new Error(errorMessage));
                });
            });
        }

        /**
         * æäº¤è¡¨å•ï¼ˆæ”¯æŒ Google Sheets å’Œ localStorageï¼‰
         */
        function submitForm(event) {
            event.preventDefault();

            if (!validateForm()) {
                showError('Please complete all required fields');
                return;
            }

            var submitBtn = document.getElementById('submitBtn');
            var originalText = submitBtn.textContent;
            
            // è®¾ç½®åŠ è½½çŠ¶æ€
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            submitBtn.textContent = 'Submitting...';

            try {
                var formData = collectFormData();
                var responses = formData.responses;
                var timestamp = formData.timestamp;
                
                if (DEBUG_MODE) {
                    console.log('ğŸ“‹ Form data collected:', { responses: responses, timestamp: timestamp });
                }
                
                // å‡†å¤‡æäº¤æ•°æ®ï¼ˆä½¿ç”¨Object.assignæ›¿ä»£æ‰©å±•è¿ç®—ç¬¦ï¼‰
                var submitData = Object.assign({}, { timestamp: timestamp }, responses);

                var googleSheetsSuccess = false;
                var localStorageSuccess = false;
                var googleSheetsError = null;

                // å¦‚æœå¯ç”¨äº† Google Sheetsï¼Œå…ˆæäº¤åˆ° Google Sheets
                if (ENABLE_GOOGLE_SHEETS) {
                    submitToGoogleSheets(submitData).then(function(result) {
                        // åªæœ‰çœŸæ­£æˆåŠŸæ—¶æ‰è®¾ç½®ä¸º true
                        googleSheetsSuccess = result && result.success === true;
                        if (DEBUG_MODE) {
                            if (googleSheetsSuccess) {
                                console.log('âœ… Successfully submitted to Google Sheets:', result);
                            } else {
                                console.warn('âš ï¸ Google Sheets submission returned unsuccessful result:', result);
                            }
                        }
                        
                        // ä¿å­˜åˆ° localStorageï¼ˆä½œä¸ºå¤‡ä»½ï¼‰
                        try {
                            if (DEBUG_MODE) {
                                console.log('ğŸ’¾ Saving to localStorage...');
                            }
                            localStorageSuccess = saveResponseToLocalStorage(responses, timestamp);
                            if (DEBUG_MODE && localStorageSuccess) {
                                console.log('âœ… Successfully saved to localStorage');
                            }
                        } catch (error) {
                            if (DEBUG_MODE) {
                                console.error('âŒ localStorage save failed:', error);
                            }
                        }

                        // æ˜¾ç¤ºç»“æœæ¶ˆæ¯ï¼ˆåŸºäºçœŸå®çš„æäº¤ç»“æœï¼‰
                        if (googleSheetsSuccess) {
                            // Google Sheets æäº¤æˆåŠŸï¼ˆè¯·æ±‚å·²å‘é€ï¼Œä½†éœ€è¦éªŒè¯æ•°æ®æ˜¯å¦å†™å…¥ï¼‰
                            showSuccess('Thank you! Your response has been submitted. Please verify the data appears in your Google Sheets.');
                            
                            if (DEBUG_MODE) {
                                console.log('âœ… Request sent successfully. Please check Google Sheets to verify data was written.');
                            }
                            
                            // é‡ç½®è¡¨å•
                            document.getElementById('surveyForm').reset();
                            rankedFactors = [];
                            rankedComfortZoneAmenities = [];
                            updateRankedList();
                            updateComfortZoneRankedList('comfort_zone_amenities_ranked_list');
                            enforceRankingLimits();
                            enforceComfortZoneRankingLimits('comfort_zone_amenities_ranked_container');
                            selectRandomImage();
                            showHideConditional();
                            calculateProgress();
                        } else if (localStorageSuccess) {
                            // åªæœ‰ localStorage æˆåŠŸï¼ˆGoogle Sheets å¤±è´¥ï¼‰
                            var errorMessage = 'Your response has been saved locally, but failed to submit to Google Sheets. ';
                            if (googleSheetsError) {
                                errorMessage += 'Error: ' + googleSheetsError.message;
                            } else {
                                errorMessage += 'Please check your Google Apps Script configuration.';
                            }
                            showError(errorMessage);
                            
                            if (DEBUG_MODE) {
                                console.warn('âš ï¸ Data saved locally but Google Sheets submission failed');
                                if (googleSheetsError) {
                                    console.warn('âš ï¸ Google Sheets error:', googleSheetsError.message);
                                }
                            }
                        } else {
                            // å®Œå…¨å¤±è´¥
                            showError('Failed to save response. Please check the console for details and try again.');
                            if (DEBUG_MODE) {
                                console.error('âŒ Both Google Sheets and localStorage save failed');
                            }
                        }
                        
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('loading');
                        submitBtn.textContent = originalText;
                    }).catch(function(error) {
                        googleSheetsError = error;
                        googleSheetsSuccess = false;
                        if (DEBUG_MODE) {
                            console.error('âŒ Google Sheets submission failed:', error);
                            console.error('Error details:', {
                                message: error.message,
                                name: error.name,
                                stack: error.stack
                            });
                        }
                        // å³ä½¿ Google Sheets å¤±è´¥ï¼Œä¹Ÿç»§ç»­ä¿å­˜åˆ° localStorage
                        
                        // ä¿å­˜åˆ° localStorageï¼ˆä½œä¸ºå¤‡ä»½ï¼‰
                        try {
                            if (DEBUG_MODE) {
                                console.log('ğŸ’¾ Saving to localStorage...');
                            }
                            localStorageSuccess = saveResponseToLocalStorage(responses, timestamp);
                            if (DEBUG_MODE && localStorageSuccess) {
                                console.log('âœ… Successfully saved to localStorage');
                            }
                        } catch (localError) {
                            if (DEBUG_MODE) {
                                console.error('âŒ localStorage save failed:', localError);
                            }
                        }

                        // æ˜¾ç¤ºç»“æœæ¶ˆæ¯
                        if (localStorageSuccess) {
                            // åªæœ‰ localStorage æˆåŠŸï¼ˆGoogle Sheets å¤±è´¥ï¼‰
                            var errorMessage = 'Your response has been saved locally, but failed to submit to Google Sheets. ';
                            if (googleSheetsError) {
                                errorMessage += 'Error: ' + googleSheetsError.message;
                            } else {
                                errorMessage += 'Please check your Google Apps Script configuration.';
                            }
                            showError(errorMessage);
                            
                            if (DEBUG_MODE) {
                                console.warn('âš ï¸ Data saved locally but Google Sheets submission failed');
                                if (googleSheetsError) {
                                    console.warn('âš ï¸ Google Sheets error:', googleSheetsError.message);
                                }
                            }
                        } else {
                            // å®Œå…¨å¤±è´¥
                            showError('Failed to save response. Please check the console for details and try again.');
                            if (DEBUG_MODE) {
                                console.error('âŒ Both Google Sheets and localStorage save failed');
                            }
                        }
                        
                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        submitBtn.disabled = false;
                        submitBtn.classList.remove('loading');
                        submitBtn.textContent = originalText;
                    });
                } else {
                    // æ²¡æœ‰å¯ç”¨ Google Sheetsï¼Œåªä¿å­˜åˆ° localStorage
                    try {
                        if (DEBUG_MODE) {
                            console.log('ğŸ’¾ Saving to localStorage...');
                        }
                        localStorageSuccess = saveResponseToLocalStorage(responses, timestamp);
                        if (DEBUG_MODE && localStorageSuccess) {
                            console.log('âœ… Successfully saved to localStorage');
                        }
                        
                        if (localStorageSuccess) {
                            showSuccess('Thank you! Your response has been saved.');
                            document.getElementById('surveyForm').reset();
                            rankedFactors = [];
                            rankedComfortZoneAmenities = [];
                            updateRankedList();
                            updateComfortZoneRankedList('comfort_zone_amenities_ranked_list');
                            enforceRankingLimits();
                            enforceComfortZoneRankingLimits('comfort_zone_amenities_ranked_container');
                            selectRandomImage();
                            showHideConditional();
                            calculateProgress();
                        } else {
                            showError('Failed to save response. Please try again.');
                        }
                    } catch (error) {
                        if (DEBUG_MODE) {
                            console.error('âŒ localStorage save failed:', error);
                        }
                        showError('An error occurred. Please try again.');
                    }
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('loading');
                    submitBtn.textContent = originalText;
                }
            } catch (error) {
                if (DEBUG_MODE) {
                    console.error('âŒ Submission error:', error);
                    console.error('Error stack:', error.stack);
                }
                showError('An error occurred. Please try again. Check the console for details.');
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                submitBtn.textContent = originalText;
            }
        }

        /**
         * æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ï¼ˆå…¼å®¹ Android 7.0ï¼‰
         */
        function showDebugInfo() {
            var debugInfo, debugContent, errorMsg = '';
            
            try {
                debugInfo = document.getElementById('debugInfo');
                debugContent = document.getElementById('debugContent');
                
                if (!debugInfo) {
                    errorMsg = 'Debug info element not found';
                    console.error('âŒ ' + errorMsg);
                    return;
                }
                
                if (!debugContent) {
                    errorMsg = 'Debug content element not found';
                    console.error('âŒ ' + errorMsg);
                    return;
                }
                
                // è°ƒè¯•ä¿¡æ¯æ¡†å·²éšè—ï¼Œä¸æ˜¾ç¤º
                debugInfo.style.display = 'none';
                debugInfo.style.visibility = 'hidden';
                debugInfo.style.opacity = '0';
                
                // è·å–åŸºæœ¬ä¿¡æ¯ï¼ˆä½¿ç”¨å…¼å®¹æ€§æ›´å¥½çš„æ–¹æ³•ï¼‰
                var isTouchDevice = false;
                try {
                    isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                } catch (e) {
                    isTouchDevice = false;
                }
                
                var screenWidth = window.screen.width || window.innerWidth || 0;
                var screenHeight = window.screen.height || window.innerHeight || 0;
                var viewportWidth = window.innerWidth || 0;
                var viewportHeight = window.innerHeight || 0;
                var userAgent = navigator.userAgent || 'Unknown';
                var platform = navigator.platform || 'Unknown';
                
                // æ£€æµ‹æµè§ˆå™¨ï¼ˆå…¼å®¹æ—§ç‰ˆ Androidï¼‰
                var browser = 'Unknown';
                if (userAgent.indexOf('Chrome') > -1) {
                    browser = 'Chrome';
                } else if (userAgent.indexOf('Safari') > -1) {
                    browser = 'Safari';
                } else if (userAgent.indexOf('Firefox') > -1) {
                    browser = 'Firefox';
                } else if (userAgent.indexOf('Edge') > -1) {
                    browser = 'Edge';
                }
                
                // æ£€æµ‹è®¾å¤‡ç±»å‹
                var deviceType = 'Desktop';
                if (isTouchDevice) {
                    if (screenWidth < 768) {
                        deviceType = 'Mobile';
                    } else {
                        deviceType = 'Tablet';
                    }
                }
                
                // æ£€æŸ¥å…³é”®å…ƒç´ ï¼ˆä½¿ç”¨å…¼å®¹æ€§æ›´å¥½çš„æ–¹æ³•ï¼‰
                var overallSatisfactionGroup = null;
                var rankedFactorsGroup = null;
                var radioCount = 0;
                var checkboxCount = 0;
                var radioGroups = [];
                var checkboxGroups = [];
                
                try {
                    overallSatisfactionGroup = document.getElementById('overall_satisfaction_group');
                    rankedFactorsGroup = document.getElementById('ranked_factors_group');
                    radioCount = document.querySelectorAll('input[type="radio"]').length;
                    checkboxCount = document.querySelectorAll('input[type="checkbox"]').length;
                    radioGroups = document.querySelectorAll('.radio-group');
                    checkboxGroups = document.querySelectorAll('.checkbox-group');
                } catch (e) {
                    errorMsg = 'Error querying elements: ' + e.message;
                    console.error('âŒ ' + errorMsg);
                }
                
                // æ£€æŸ¥å®¹å™¨çŠ¶æ€
                var overallStatus = 'NOT FOUND';
                var rankedStatus = 'NOT FOUND';
                
                if (overallSatisfactionGroup) {
                    try {
                        var computedStyle = window.getComputedStyle(overallSatisfactionGroup);
                        var childrenCount = overallSatisfactionGroup.children ? overallSatisfactionGroup.children.length : 0;
                        overallStatus = 'Found | Display: ' + computedStyle.display + ' | Visibility: ' + computedStyle.visibility + ' | Opacity: ' + computedStyle.opacity + ' | Children: ' + childrenCount;
                    } catch (e) {
                        overallStatus = 'Found but error reading style: ' + e.message;
                    }
                }
                
                if (rankedFactorsGroup) {
                    try {
                        var computedStyle2 = window.getComputedStyle(rankedFactorsGroup);
                        var childrenCount2 = rankedFactorsGroup.children ? rankedFactorsGroup.children.length : 0;
                        rankedStatus = 'Found | Display: ' + computedStyle2.display + ' | Visibility: ' + computedStyle2.visibility + ' | Opacity: ' + computedStyle2.opacity + ' | Children: ' + childrenCount2;
                    } catch (e) {
                        rankedStatus = 'Found but error reading style: ' + e.message;
                    }
                }
                
                // æ£€æŸ¥ surveyConfig
                var configLoaded = false;
                try {
                    configLoaded = (typeof surveyConfig !== 'undefined');
                } catch (e) {
                    configLoaded = false;
                }
                
                // æ„å»º HTML å†…å®¹ï¼ˆä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé¿å…æ¨¡æ¿å­—ç¬¦ä¸²å…¼å®¹æ€§é—®é¢˜ï¼‰
                var html = '';
                html += '<div style="margin-bottom: 8px;"><strong>ğŸŒ æµè§ˆå™¨:</strong> ' + browser + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>ğŸ’» å¹³å°:</strong> ' + platform + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>ğŸ“± è®¾å¤‡ç±»å‹:</strong> ' + deviceType + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>ğŸ‘† è§¦æ‘¸è®¾å¤‡:</strong> ' + (isTouchDevice ? 'âœ… æ˜¯' : 'âŒ å¦') + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>ğŸ“ å±å¹•å°ºå¯¸:</strong> ' + screenWidth + ' x ' + screenHeight + 'px</div>';
                html += '<div style="margin-bottom: 8px;"><strong>ğŸ‘ï¸ è§†å£å°ºå¯¸:</strong> ' + viewportWidth + ' x ' + viewportHeight + 'px</div>';
                
                var pixelRatio = 1;
                try {
                    pixelRatio = window.devicePixelRatio || 1;
                } catch (e) {
                    pixelRatio = 1;
                }
                html += '<div style="margin-bottom: 8px;"><strong>ğŸ” è®¾å¤‡åƒç´ æ¯”:</strong> ' + pixelRatio + '</div>';
                
                var radioBg = radioCount > 0 ? '#0f0' : '#f00';
                html += '<div style="margin-bottom: 8px; padding: 5px; background: ' + radioBg + '; border-radius: 3px;"><strong>ğŸ“Š è¡¨å•å…ƒç´ æ•°é‡:</strong> Radio: ' + radioCount + ', Checkbox: ' + checkboxCount + '</div>';
                html += '<div style="margin-bottom: 8px;"><strong>ğŸ“¦ é€‰é¡¹å®¹å™¨:</strong> Radio Groups: ' + radioGroups.length + ', Checkbox Groups: ' + checkboxGroups.length + '</div>';
                
                var overallBg = (overallSatisfactionGroup && overallSatisfactionGroup.children && overallSatisfactionGroup.children.length > 0) ? '#0f0' : '#f00';
                html += '<div style="margin-bottom: 8px; padding: 5px; background: ' + overallBg + '; border-radius: 3px;"><strong>â“ é—®é¢˜1å®¹å™¨:</strong> ' + overallStatus + '</div>';
                
                var rankedBg = (rankedFactorsGroup && rankedFactorsGroup.children && rankedFactorsGroup.children.length > 0) ? '#0f0' : '#f00';
                html += '<div style="margin-bottom: 8px; padding: 5px; background: ' + rankedBg + '; border-radius: 3px;"><strong>â“ é—®é¢˜2å®¹å™¨:</strong> ' + rankedStatus + '</div>';
                
                var configBg = configLoaded ? '#0f0' : '#f00';
                html += '<div style="margin-bottom: 8px; padding: 5px; background: ' + configBg + '; border-radius: 3px;"><strong>âš™ï¸ Survey Config:</strong> ' + (configLoaded ? 'âœ… Loaded' : 'âŒ NOT LOADED') + '</div>';
                
                if (errorMsg) {
                    html += '<div style="margin-top: 10px; padding: 5px; background: #f00; border-radius: 3px; color: yellow;"><strong>âš ï¸ é”™è¯¯:</strong> ' + errorMsg + '</div>';
                }
                
                debugContent.innerHTML = html;
                
                console.log('âœ… Debug info displayed');
            } catch (error) {
                console.error('Error showing debug info:', error);
                if (debugContent) {
                    debugContent.innerHTML = '<div style="color: yellow; padding: 10px; background: #f00; border-radius: 3px;"><strong>âŒ é”™è¯¯:</strong> ' + error.message + '</div>';
                }
            }
        }

        // åˆå§‹åŒ–ï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
        function initializeApp() {
            try {
                if (DEBUG_MODE) {
                    console.log('ğŸš€ Initializing application...');
                    console.log('ğŸ“ Document ready state:', document.readyState);
                    console.log('ğŸ“ User agent:', navigator.userAgent);
                }
                
                // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
                showDebugInfo();
                
                // æ£€æŸ¥å¿…è¦çš„å…ƒç´ æ˜¯å¦å­˜åœ¨
                var form = document.getElementById('surveyForm');
                if (!form) {
                    console.error('âŒ Form element not found!');
                    return;
                }
                
                // é€‰æ‹©éšæœºå›¾ç‰‡
                if (DEBUG_MODE) {
                    console.log('ğŸ–¼ï¸ Selecting random image...');
                }
                selectRandomImage();
                
                // æ¸²æŸ“æ‰€æœ‰é—®é¢˜
                console.log('ğŸ“ Rendering questions...');
                console.log('ğŸ“ Survey config available:', typeof surveyConfig !== 'undefined');
                
                if (typeof surveyConfig === 'undefined') {
                    console.error('âŒ Survey config is not defined!');
                    alert('Error: Survey configuration not loaded. Please refresh the page.');
                    return;
                }
                
                // ç¡®ä¿æ‰€æœ‰ section å¯è§ï¼ˆåœ¨æ¸²æŸ“å‰ï¼‰
                var allSections = document.querySelectorAll('.section');
                for (var i = 0; i < allSections.length; i++) {
                    allSections[i].style.opacity = '1';
                    allSections[i].style.visibility = 'visible';
                    allSections[i].style.display = 'block';
                    allSections[i].classList.add('visible');
                }
                
                // ç¡®ä¿å®¹å™¨å¯è§
                var overallGroup = document.getElementById('overall_satisfaction_group');
                var rankedGroup = document.getElementById('ranked_factors_group');
                if (overallGroup) {
                    overallGroup.style.display = 'flex';
                    overallGroup.style.visibility = 'visible';
                    overallGroup.style.opacity = '1';
                }
                if (rankedGroup) {
                    rankedGroup.style.display = 'flex';
                    rankedGroup.style.visibility = 'visible';
                    rankedGroup.style.opacity = '1';
                }
                
                renderAllQuestions();
                
                // éªŒè¯æ¸²æŸ“ç»“æœ
                setTimeout(() => {
                    var firstRadioGroup = document.getElementById('overall_satisfaction_group');
                    var firstCheckboxGroup = document.getElementById('ranked_factors_group');
                    
                    if (firstRadioGroup) {
                        var options = firstRadioGroup.querySelectorAll('.radio-option');
                        console.log('âœ… First radio group rendered with', options.length, 'options');
                        if (options.length === 0) {
                            console.error('âŒ Radio group is empty!');
                            // å¼ºåˆ¶æ˜¾ç¤ºå®¹å™¨
                            firstRadioGroup.style.display = 'flex';
                            firstRadioGroup.style.visibility = 'visible';
                            firstRadioGroup.style.opacity = '1';
                            firstRadioGroup.style.border = '2px solid red'; // è°ƒè¯•ç”¨
                        }
                    } else {
                        console.error('âŒ First radio group not found after rendering!');
                    }
                    
                    if (firstCheckboxGroup) {
                        var options = firstCheckboxGroup.querySelectorAll('.checkbox-option');
                        console.log('âœ… First checkbox group rendered with', options.length, 'options');
                        if (options.length === 0) {
                            console.error('âŒ Checkbox group is empty!');
                            // å¼ºåˆ¶æ˜¾ç¤ºå®¹å™¨
                            firstCheckboxGroup.style.display = 'flex';
                            firstCheckboxGroup.style.visibility = 'visible';
                            firstCheckboxGroup.style.opacity = '1';
                            firstCheckboxGroup.style.border = '2px solid red'; // è°ƒè¯•ç”¨
                        }
                    } else {
                        console.error('âŒ First checkbox group not found after rendering!');
                    }
                    
                    // æ›´æ–°è°ƒè¯•ä¿¡æ¯
                    showDebugInfo();
                }, 500);
                
                // è®¾ç½®æ»šåŠ¨åŠ¨ç”»
                setupScrollAnimation();
                
                // æ˜¾ç¤º/éšè—æ¡ä»¶æ€§é—®é¢˜
                showHideConditional();
                
                // è®¡ç®—è¿›åº¦
                calculateProgress();

                // ç›‘å¬è¾“å…¥å˜åŒ–ä»¥æ›´æ–°è¿›åº¦
                document.addEventListener('change', () => {
                    calculateProgress();
                });

                // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
                if (form) {
                    form.addEventListener('submit', submitForm);
                    if (DEBUG_MODE) {
                        console.log('âœ… Form submit event listener attached');
                    }
                } else {
                    console.error('âŒ Form element not found!');
                }
                
                // æ£€æŸ¥ URL å‚æ•°ï¼Œå¦‚æœæ˜¯ç®¡ç†å‘˜æ¨¡å¼ï¼Œæ˜¾ç¤ºå¯¼å‡ºæŒ‰é’®
                var urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('admin') === '1') {
                    var exportBtn = document.getElementById('exportBtn');
                    if (exportBtn) {
                        exportBtn.style.display = 'block';
                    }
                }
                
                // ç¡®ä¿æ‰€æœ‰ section åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¯è§ï¼ˆé¢å¤–ä¿é™©ï¼‰
                setTimeout(() => {
                    var sections = document.querySelectorAll('.section');
                    sections.forEach(section => {
                        section.classList.add('visible');
                    });
                    if (DEBUG_MODE) {
                        console.log('âœ… All sections made visible (backup)');
                    }
                }, 1000);
                
                if (DEBUG_MODE) {
                    console.log('âœ… Application initialized successfully');
                }
            } catch (error) {
                console.error('âŒ Initialization error:', error);
                console.error('Error stack:', error.stack);
                // å³ä½¿å‡ºé”™ï¼Œä¹Ÿå°è¯•æ˜¾ç¤ºå†…å®¹
                var sections = document.querySelectorAll('.section');
                sections.forEach(section => {
                    section.classList.add('visible');
                });
            }
        }

        // ç«‹å³æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯ï¼ˆä¸ç­‰å¾…é¡µé¢åŠ è½½ï¼Œå…¼å®¹ Android 7.0ï¼‰
        (function() {
            try {
                // ç­‰å¾… DOM å…ƒç´ å­˜åœ¨
                function tryShowDebug() {
                    var debugInfo = document.getElementById('debugInfo');
                    if (debugInfo) {
                        // ç«‹å³è°ƒç”¨ä¸€æ¬¡
                        if (typeof showDebugInfo === 'function') {
                            showDebugInfo();
                            // æ¯2ç§’æ›´æ–°ä¸€æ¬¡è°ƒè¯•ä¿¡æ¯
                            setInterval(showDebugInfo, 2000);
                        } else {
                            // å¦‚æœå‡½æ•°ä¸å­˜åœ¨ï¼Œä½¿ç”¨ç®€å•ç‰ˆæœ¬
                            var debugContent = document.getElementById('debugContent');
                            if (debugContent) {
                                debugContent.innerHTML = '<div style="color: #f00;">âŒ showDebugInfo å‡½æ•°æœªå®šä¹‰</div>';
                            }
                        }
                    } else {
                        // å¦‚æœå…ƒç´ è¿˜ä¸å­˜åœ¨ï¼Œ100ms åå†è¯•
                        setTimeout(tryShowDebug, 100);
                    }
                }
                tryShowDebug();
            } catch (e) {
                console.error('Error in immediate debug info:', e);
                var debugContent = document.getElementById('debugContent');
                if (debugContent) {
                    debugContent.innerHTML = '<div style="color: #f00;">âŒ åˆå§‹åŒ–é”™è¯¯: ' + e.message + '</div>';
                }
            }
        })();

        // ä½¿ç”¨å¤šç§æ–¹å¼ç¡®ä¿åˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initializeApp();
                showDebugInfo();
            });
        } else {
            // DOM å·²ç»åŠ è½½å®Œæˆ
            initializeApp();
            showDebugInfo();
        }
        
        // é¢å¤–çš„ä¿é™©ï¼šå¦‚æœä¸Šé¢çš„éƒ½æ²¡æ‰§è¡Œï¼Œåœ¨ window.onload æ—¶å†è¯•ä¸€æ¬¡
        window.addEventListener('load', () => {
            var sections = document.querySelectorAll('.section');
            if (sections.length > 0 && !sections[0].classList.contains('visible')) {
                if (DEBUG_MODE) {
                    console.warn('âš ï¸ Sections not visible on load, forcing visibility');
                }
                sections.forEach(section => {
                    section.classList.add('visible');
                });
            }
            showDebugInfo();
        });
    </script>
</body>
</html>
